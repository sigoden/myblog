<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Sigoden | Blog]]></title><description><![CDATA[Blogger and Programer]]></description><link>https://blog.sigoden.com</link><generator>RSS for Node</generator><lastBuildDate>Thu, 04 Apr 2019 01:30:20 GMT</lastBuildDate><atom:link href="https://blog.sigoden.com/rss.xml" rel="self" type="application/rss+xml"/><item><title><![CDATA[基于 Htte 的 API 自动化测试]]></title><description><![CDATA[本文将以一款超简单的博客应用为例子，介绍如何使用 Htte 进行 API 接口的自动化测试]]></description><link>https://blog.sigoden.com/how-to-automate-testing-api-with-htte/</link><guid isPermaLink="false">https://blog.sigoden.com/how-to-automate-testing-api-with-htte/</guid><content:encoded>&lt;p&gt;本文将以一款超简单的博客应用为例子，介绍如何使用 Htte 进行 API 接口的自动化测试。&lt;/p&gt;
&lt;h2 id=&quot;htte-介绍&quot;&gt;&lt;a href=&quot;#htte-%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;htte 介绍 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Htte 介绍&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/sigoden/htte&quot;&gt;Htte&lt;/a&gt; 是一款自动化测试框架。它允许你使用 YAML 编写测试，不需要编写代码。 难度低，上手快。&lt;/p&gt;
&lt;p&gt;编写一个测试就是罗列出请求数据以及预期的响应数据。htte 会自动为你生成请求，并验证响应数据是否匹配预期。&lt;/p&gt;
&lt;p&gt;它提供插件，没有什么数据是生成和表示不了的，没有什么数据是无法校验和比对的，没有什么场景是测试不了。&lt;/p&gt;
&lt;p&gt;接口自动化测试中，测试中使用来自其它测试的数据一直是难言的痛。Postman 通过环境变量处理这个问题，繁琐又容易出错，Htte 创新独到
地采用会话和路径引用数据处理这个问题，安全而简便。&lt;/p&gt;
&lt;p&gt;Htte 是一款优秀的接口自动化测试工具，值得大家一试。&lt;/p&gt;
&lt;h2 id=&quot;安装&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85&quot; aria-label=&quot;安装 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装&lt;/h2&gt;
&lt;p&gt;使用 npm 安装 htte 命令行:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm i -g htte&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;接口详情&quot;&gt;&lt;a href=&quot;#%E6%8E%A5%E5%8F%A3%E8%AF%A6%E6%83%85&quot; aria-label=&quot;接口详情 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;接口详情&lt;/h2&gt;
&lt;p&gt;有这样一款超简单的博客应用。它只有四个接口。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;登录接口&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;功能: 用户登录
请求路径: localhost:3000/login
请求方法: POST
请求头: { &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot; }
请求数据: {&amp;quot;username&amp;quot;: &amp;quot;john&amp;quot;, &amp;quot;password&amp;quot;: &amp;quot;johnsblog&amp;quot;}
响应:
  - 状况: 用户名和密码正确
    响应状态码： 200
    响应数据: {&amp;quot;name&amp;quot;: &amp;quot;john&amp;quot;, &amp;quot;token&amp;quot;: &amp;quot;...&amp;quot;}
  - 状况: 用户名或密码不正确
    响应状态码： 401
    响应数据: {&amp;quot;errcode&amp;quot;: 11001, &amp;quot;message&amp;quot;: &amp;quot;invalid username or password&amp;quot;}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;添加博文&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;功能: 添加博文
请求路径: localhost:3000/articles
请求方法: POST
请求头: { &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;, &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer ...&amp;quot; }
请求数据: &amp;gt;
  {
    &amp;quot;title&amp;quot;: &amp;quot;How to use htte&amp;quot;,
    &amp;quot;content&amp;quot;: &amp;quot;htte is ....&amp;quot;,
    &amp;quot;tags&amp;quot;: [&amp;quot;howto&amp;quot;, &amp;quot;htte&amp;quot;]
  }
响应:
  - 状况: 添加成功
    响应状态码： 200
    响应数据: &amp;gt;
      {
        &amp;quot;title&amp;quot;: &amp;quot;How to use htte&amp;quot;,
        &amp;quot;slug&amp;quot;: &amp;quot;how-to-use-htte-A43bcF&amp;quot;,
        &amp;quot;content&amp;quot;: &amp;quot;htte is ....&amp;quot;,
        &amp;quot;tags&amp;quot;: [&amp;quot;howto&amp;quot;, &amp;quot;htte&amp;quot;],
        &amp;quot;createdAt&amp;quot;: &amp;quot;2018-04-28T07:35:08.471Z&amp;quot;
      }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;编辑博文&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;功能: 编辑博文
请求路径: localhost:3000/article/how-to-use-htte-A43b
请求方法: PUT
请求头: { &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;, &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer ...&amp;quot; }
请求数据: &amp;gt;
  {
    &amp;quot;title&amp;quot;: &amp;quot;How to create htte plugin&amp;quot;,
    &amp;quot;content&amp;quot;: &amp;quot;htte plugin is ....&amp;quot;,
    &amp;quot;tags&amp;quot;: [&amp;quot;howto&amp;quot;, &amp;quot;htte&amp;quot;, &amp;quot;plugin&amp;quot;]
  }
响应:
  - 状况: 编辑成功
    响应状态码： 200
    响应数据: &amp;gt;
      {
        &amp;quot;title&amp;quot;: &amp;quot;How to use htte plugin&amp;quot;,
        &amp;quot;slug&amp;quot;: &amp;quot;how-to-use-htte-A43b&amp;quot;,
        &amp;quot;content&amp;quot;: &amp;quot;htte plugin is ....&amp;quot;,
        &amp;quot;tags&amp;quot;: [&amp;quot;howto&amp;quot;, &amp;quot;htte&amp;quot;, &amp;quot;plugin&amp;quot;],
        &amp;quot;createdAt&amp;quot;: &amp;quot;2018-04-28T07:35:08.471Z&amp;quot;
      }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;获取博文列表&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;功能: 获取所有博文
请求路径: localhost:3000/articles
请求方法: GET
请求头: { &amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;, &amp;quot;Authorization&amp;quot;: &amp;quot;Bearer ...&amp;quot; }
querystring: tag=howto
响应:
  - 状况: 成功
    响应状态码： 200
    响应数据: 
      {
        &amp;quot;articlesCount&amp;quot;: 1,
        &amp;quot;articles&amp;quot;: [
          {
            &amp;quot;title&amp;quot;: &amp;quot;How to use htte plugin&amp;quot;,
            &amp;quot;slug&amp;quot;: &amp;quot;how-to-use-htte-A43b&amp;quot;,
            &amp;quot;content&amp;quot;: &amp;quot;htte plugin is ....&amp;quot;,
            &amp;quot;tags&amp;quot;: [&amp;quot;howto&amp;quot;, &amp;quot;htte&amp;quot;, &amp;quot;plugin&amp;quot;],
            &amp;quot;createdAt&amp;quot;: &amp;quot;2018-04-28T07:35:08.471Z&amp;quot;
          }
        ]
      }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;测试接口&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E6%8E%A5%E5%8F%A3&quot; aria-label=&quot;测试接口 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试接口&lt;/h2&gt;
&lt;p&gt;添加配置文件 &lt;code class=&quot;language-text&quot;&gt;.htte.yaml&lt;/code&gt;，描述接口&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;url&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; http&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;//localhost&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token number&quot;&gt;3000&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; json &lt;span class=&quot;token comment&quot;&gt;# 使用 json 解压缩请求响应数据&lt;/span&gt;
&lt;span class=&quot;token key atrule&quot;&gt;apis&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;login&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; post
    &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /login
  &lt;span class=&quot;token key atrule&quot;&gt;createArticle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; post
    &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /articles
  &lt;span class=&quot;token key atrule&quot;&gt;updateArticle&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;method&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; put
    &lt;span class=&quot;token key atrule&quot;&gt;uri&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /article/&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;slug&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token key atrule&quot;&gt;listArticles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; /articles&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;添加测试文件 &lt;code class=&quot;language-text&quot;&gt;blog.yaml&lt;/code&gt;，编写测试。&lt;/p&gt;
&lt;h3 id=&quot;测试登录失败&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E7%99%BB%E5%BD%95%E5%A4%B1%E8%B4%A5&quot; aria-label=&quot;测试登录失败 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试登录失败&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;&lt;span class=&quot;token key atrule&quot;&gt;units&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 登录失败
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; login
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; john
        &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; johnblog
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;401&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;errcode&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;11001&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;describe&lt;/code&gt; 描述测试的目的，该字段会在最好的测试报告中呈现。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;api&lt;/code&gt; 描述被测试的接口，该字段关联配置文件中的接口定义。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;req&lt;/code&gt; 定义请求数据, &lt;code class=&quot;language-text&quot;&gt;body&lt;/code&gt;下的数据会封装到请求体 &lt;code class=&quot;language-text&quot;&gt;{&amp;quot;username&amp;quot;: &amp;quot;john&amp;quot;, &amp;quot;password&amp;quot;: &amp;quot;johnblog&amp;quot;}&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;res&lt;/code&gt; 期望响应数据。如果与实际响应数据不匹配，会导致测试不通过。&lt;/p&gt;
&lt;p&gt;当 htte 载入这段测试代码，会构造请求，也就是会往 &lt;code class=&quot;language-text&quot;&gt;http://localhost:3000/login&lt;/code&gt; 发送 &lt;code class=&quot;language-text&quot;&gt;post&lt;/code&gt; 请求，
有请求头 &lt;code class=&quot;language-text&quot;&gt;{&amp;quot;Content-Type&amp;quot;: &amp;quot;application/json&amp;quot;}&lt;/code&gt;, 及请求体 &lt;code class=&quot;language-text&quot;&gt;{&amp;quot;username&amp;quot;: &amp;quot;john&amp;quot;, &amp;quot;password&amp;quot;: &amp;quot;johnblog&amp;quot;}&lt;/code&gt;。
当服务端响应后，会对响应的数据作如下断言&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;响应状态码为 401&lt;/li&gt;
&lt;li&gt;响应体是一个对象&lt;/li&gt;
&lt;li&gt;响应体对象有且仅有两个属性 &lt;code class=&quot;language-text&quot;&gt;errcode&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;message&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;响应体对象的 &lt;code class=&quot;language-text&quot;&gt;errcode&lt;/code&gt; 属性值为 11001&lt;/li&gt;
&lt;li&gt;响应体对象的 &lt;code class=&quot;language-text&quot;&gt;message&lt;/code&gt; 属性值为 &lt;code class=&quot;language-text&quot;&gt;invalid username or password&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;所以断言全部通过，测试才会通过。如响应状态码不为 401 或者响应体中多了其它其它字段，都是不完全匹配，会导致测试失败。&lt;/p&gt;
&lt;h3 id=&quot;测试登录成功&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E7%99%BB%E5%BD%95%E6%88%90%E5%8A%9F&quot; aria-label=&quot;测试登录成功 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试登录成功&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 登录成功
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; login
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; johnLogin
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; john
        &lt;span class=&quot;token key atrule&quot;&gt;password&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; johnsblog
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;username&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; john
        &lt;span class=&quot;token key atrule&quot;&gt;token&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;name&lt;/code&gt; 定义测试名称，后续测试可以通过该名称访问该 测试数据，比如响应的 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 值。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;res&lt;/code&gt; 中省略了 &lt;code class=&quot;language-text&quot;&gt;status&lt;/code&gt;，并不代表不检查状态码了。对于这种情况 htte 会检查是否状态码在 200-299 范围内。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 的值是变动的，我们检查其具体值。所以使用 YAML 标签 &lt;code class=&quot;language-text&quot;&gt;!@exist&lt;/code&gt; 进行一种特殊的检查。其验证 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 字段存在，不校验其具体值。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;!@exist&lt;/code&gt; 由 htte 插件提供。在只关注字段有无而不在意值的情况下使用。&lt;/p&gt;
&lt;h3 id=&quot;测试添加博文&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E6%B7%BB%E5%8A%A0%E5%8D%9A%E6%96%87&quot; aria-label=&quot;测试添加博文 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试添加博文&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 添加博文成功
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; createArticle
    &lt;span class=&quot;token key atrule&quot;&gt;name&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; articleUsehtte
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token key atrule&quot;&gt;Authorization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$concat&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bearer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$query&lt;/span&gt; $$johnLogin.res.body.token&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; How to use htte
        &lt;span class=&quot;token key atrule&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; htte is http automation testing tool
        &lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; howto
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; htte
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; How to use htte
        &lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@regexp&lt;/span&gt; /^how&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;use&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;htte/
        &lt;span class=&quot;token key atrule&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; htte is http automation testing tool
        &lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; howto
          &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; htte
        &lt;span class=&quot;token key atrule&quot;&gt;createdAt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;headers&lt;/code&gt; 描述请求头。它将向发送的请求头中追加 &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 头。&lt;/p&gt;
&lt;p&gt;添加博文接口会进行 JWT 权限校验，因此我们需要添加 &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 头，提供登录 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;这个 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 可以从测试 &lt;code class=&quot;language-text&quot;&gt;johnLogin&lt;/code&gt; 中获取。我们通过标签 &lt;code class=&quot;language-text&quot;&gt;!$query&lt;/code&gt; 引用这个 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 值。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;htte 会通过会话记录运行过的测试的请求和响应数据，你可以这种方式获取位于你前面的测试的数据。不需要预先定义，只需要定位（访问路径）。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;然后使用标签 &lt;code class=&quot;language-text&quot;&gt;!$concat&lt;/code&gt; 拼接 &lt;code class=&quot;language-text&quot;&gt;Bearer&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;token&lt;/code&gt; 值得到 &lt;code class=&quot;language-text&quot;&gt;Authorization&lt;/code&gt; 的具体值。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;slug&lt;/code&gt; 表示博文的访问链接，通过 title 拼接一个 4 个字符的随机字符串生成。它也不是一个具体值，所以我们使用 &lt;code class=&quot;language-text&quot;&gt;!@regexp&lt;/code&gt; 进行正这而匹配验证。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;大多情况下，测试的请求数据及预期响应数据是可以给定的，但总免不了会碰到一些特殊状况，这是就需要使用插件了。htte 许多内置插件，它们
应该足够应对绝大多数常见了。如果碰到无法处理的情况，可以发 issue 或编写插件。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h3 id=&quot;测试编辑博文&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E7%BC%96%E8%BE%91%E5%8D%9A%E6%96%87&quot; aria-label=&quot;测试编辑博文 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试编辑博文&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 编辑博文成功
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; updateArticle
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token key atrule&quot;&gt;Authorization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$concat&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bearer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$query&lt;/span&gt; $$johnLogin.res.body.token&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;params&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$query&lt;/span&gt; $$articleUsehtte.res.body.slug
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; How to use htte plugin
        &lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@query&lt;/span&gt; $$$req.params.slug
        &lt;span class=&quot;token key atrule&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; htte plugin is flexiabe
        &lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
         &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; howto
         &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; htte
         &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; plugin
        &lt;span class=&quot;token key atrule&quot;&gt;createdAt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token datetime number&quot;&gt;2018-04-28T07:35:08.471Z&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;params&lt;/code&gt; 描述路径参数，该测试的请求路径是 &lt;code class=&quot;language-text&quot;&gt;/article/{slug}&lt;/code&gt;，带有路径参数 slug,
发送请求前 htte 会将替换成 &lt;code class=&quot;language-text&quot;&gt;params&lt;/code&gt; 中对应的值，最终的请求路径是 &lt;code class=&quot;language-text&quot;&gt;/article/how-to-use-htte-A43bcF&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;!@query&lt;/code&gt; 标签检验响应值是否某个引用值相等，用来判断更新文章或 slug 是否改变。&lt;/p&gt;
&lt;h3 id=&quot;测试获取博文列表&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E8%8E%B7%E5%8F%96%E5%8D%9A%E6%96%87%E5%88%97%E8%A1%A8&quot; aria-label=&quot;测试获取博文列表 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试获取博文列表&lt;/h3&gt;
&lt;h4 id=&quot;获取我的所有博文&quot;&gt;&lt;a href=&quot;#%E8%8E%B7%E5%8F%96%E6%88%91%E7%9A%84%E6%89%80%E6%9C%89%E5%8D%9A%E6%96%87&quot; aria-label=&quot;获取我的所有博文 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;获取我的所有博文&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 获取我的所有博文
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; listArticles
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token key atrule&quot;&gt;Authorization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$concat&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bearer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$query&lt;/span&gt; $$johnLogin.res.body.token&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;articlesCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;articles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@array&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
            &lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; How to use htte plugin
            &lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@regexp&lt;/span&gt; /^how&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;use&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;htte/
            &lt;span class=&quot;token key atrule&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; htte plugin is flexiabe
            &lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; howto
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; htte
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; plugin
            &lt;span class=&quot;token key atrule&quot;&gt;createdAt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;!@array&lt;/code&gt; 要特别注意。Htte 常规状态下比对数组时，会先比对元素个数，在逐一比对个元素。
而 &lt;code class=&quot;language-text&quot;&gt;articles&lt;/code&gt; 可能是一个长度不固定的数组，，这种状况下进行常规比对没有意义。
使用 &lt;code class=&quot;language-text&quot;&gt;!@array&lt;/code&gt; 自定义数组比对行为，使其仅比对特定的元素，比如该测试中，就表示仅对第一个元素进行比对，忽略其它元素。
如果该元素匹配，则测试通过。&lt;/p&gt;
&lt;h4 id=&quot;通过标签筛选我的博文&quot;&gt;&lt;a href=&quot;#%E9%80%9A%E8%BF%87%E6%A0%87%E7%AD%BE%E7%AD%9B%E9%80%89%E6%88%91%E7%9A%84%E5%8D%9A%E6%96%87&quot; aria-label=&quot;通过标签筛选我的博文 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;通过标签筛选我的博文&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;yaml&quot;&gt;&lt;pre class=&quot;language-yaml&quot;&gt;&lt;code class=&quot;language-yaml&quot;&gt;  &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;token key atrule&quot;&gt;describe&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 通过标签赛选我的博文
    &lt;span class=&quot;token key atrule&quot;&gt;api&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; listArticles
    &lt;span class=&quot;token key atrule&quot;&gt;req&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
        &lt;span class=&quot;token key atrule&quot;&gt;Authorization&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$concat&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;Bearer&apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&apos; &apos;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!$query&lt;/span&gt; $$johnLogin.res.body.token&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;query&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;tag&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; howto
    &lt;span class=&quot;token key atrule&quot;&gt;res&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token key atrule&quot;&gt;body&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;articlesCount&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;
        &lt;span class=&quot;token key atrule&quot;&gt;articles&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@array&lt;/span&gt;
          &lt;span class=&quot;token key atrule&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
            &lt;span class=&quot;token key atrule&quot;&gt;title&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; How to use htte plugin
            &lt;span class=&quot;token key atrule&quot;&gt;slug&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@regexp&lt;/span&gt; /^how&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;use&lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt;htte/
            &lt;span class=&quot;token key atrule&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; htte plugin is flexiabe
            &lt;span class=&quot;token key atrule&quot;&gt;tags&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; 
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; howto
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; htte
              &lt;span class=&quot;token punctuation&quot;&gt;-&lt;/span&gt; plugin
            &lt;span class=&quot;token key atrule&quot;&gt;createdAt&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token tag&quot;&gt;!@exist&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;query&lt;/code&gt; 描述 querystring, 测时的 url 将变成 &lt;code class=&quot;language-text&quot;&gt;http://localhost:3000/articles?tag=howto&lt;/code&gt;。&lt;/p&gt;
&lt;h2 id=&quot;命令行&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E4%BB%A4%E8%A1%8C&quot; aria-label=&quot;命令行 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命令行&lt;/h2&gt;
&lt;p&gt;保证 Web 可用的情况下，在文件 &lt;code class=&quot;language-text&quot;&gt;.htte.yaml&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;blog.yaml&lt;/code&gt; 所在的目录，执行命令 &lt;code class=&quot;language-text&quot;&gt;htte&lt;/code&gt;, htte 会逐一执行测试。
并打印测试执行的结果。&lt;/p&gt;
&lt;p&gt;一些 htte 命令行有些实用技巧：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;某个测试失败时暂停执行&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;htte --bail &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;从上次失败的地方开始执行, 适合接口调试&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;htte --bail --amend&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;仅运行指定测试&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;htte --unit blog-articleUsehtte --shot&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;显示调试信息，将同步打印请求响应数据&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;htte --debug&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;通过这个仅仅 4 接口的博客应用接口测试案例，你应该很很熟悉 Htte 了，就是这么简单。
Htte 自动生成数据，发送请求，比对响应数据，编排测试用例并逐一执行，打印报告。&lt;/p&gt;
&lt;p&gt;所谓测试就是使用 YAML 描述接口的请求和响应。对于描述不了的极少部分场景提供了插件。
即享有描述性策略编写测试的优越性，又持有插件带来的灵活性。&lt;/p&gt;
&lt;p&gt;项目地址: &lt;a href=&quot;https://github.com/sigoden/htte&quot;&gt;https://github.com/sigoden/htte&lt;/a&gt;&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用 Gatsby 创建静态站点]]></title><description><![CDATA[Gatsby 是一款超赞的基于 React 和 GraphQL 静态文档生成器，本文将以从零搭建一个博客系统的形式演示如何使用 Gatsby 生成静态站点。]]></description><link>https://blog.sigoden.com/how-to-use-gatsby/</link><guid isPermaLink="false">https://blog.sigoden.com/how-to-use-gatsby/</guid><content:encoded>&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;介绍 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;介绍&lt;/h2&gt;
&lt;p&gt;Gatsby 是一款基于 React 和 GraphQL 的静态文档生成器。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6ed291ccd6b43d4f75d7660f0fa47c34/bfdc0/diagram.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 75.37254901960785%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABjElEQVQ4y42T20rDQBCG+/43Cl7UV1AQ7AsoCFrwVipeFGwxWAgNTdPsbvaU35mNW5I0PQwMu9md+TKnHU3GU7A461HXddjH1XsPKWVQpVRY+zZxZXkcv2HUB7ZVCIHFYkH6jST5IU2gte7A2sDJMSBLnufIsgz5dotNIZGTbmmfpinKsrwcSGZ7Y+/JwRnU2Sf8Zh5K0M/iJJBFVxay1PDOEwCQRQkxf4VLP4KNojtrXNg7687XUFcGxUbCaAtHUCU1hAYM+VljUeZqD7X/wAi9v34+BIY0fR3SCynyZblELVPQMd117drAuz6wGZW6+XtIy4Uz8TuHWq9AAcNS5FyOdlNORhig5MApcz1ZZu8rLL/W+xqbAWiI8Orp+NhwuuzIddJUR1NVnZ9FaNvn4eblENiJlKDcpErZoDGqCOWydMbmdjoAdL5j5LkBWsBphdZx07Se7eBgMzDOGCv3hedQJrPQFEej09xdCIwdrqSBogGUuwpFrrEj5W9WrUxnDs++5bbRMRmy5ZfyB904go1q47BOAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;原理图&quot;
        title=&quot;&quot;
        src=&quot;/static/6ed291ccd6b43d4f75d7660f0fa47c34/73d01/diagram.png&quot;
        srcset=&quot;/static/6ed291ccd6b43d4f75d7660f0fa47c34/a3b1f/diagram.png 197w,
/static/6ed291ccd6b43d4f75d7660f0fa47c34/07137/diagram.png 393w,
/static/6ed291ccd6b43d4f75d7660f0fa47c34/73d01/diagram.png 786w,
/static/6ed291ccd6b43d4f75d7660f0fa47c34/a5918/diagram.png 1179w,
/static/6ed291ccd6b43d4f75d7660f0fa47c34/bfdc0/diagram.png 1275w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;Gatsby 从各种媒介收集数据源，通过 GraphQL 暴露给前端，前端使用 React 生成界面。Gatsby 静态化整个链路，生成纯静态资源，以保证加载和渲染速度，同时也方便部署。&lt;/p&gt;
&lt;p&gt;Gatsby 不同于传统的诸如 jekyll, hugo, hexo, ghost 静态站点生成器。这儿从零开始使用 Gatsby 搭建一个博客站点作为入门。&lt;/p&gt;
&lt;h2 id=&quot;准备&quot;&gt;&lt;a href=&quot;#%E5%87%86%E5%A4%87&quot; aria-label=&quot;准备 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;准备&lt;/h2&gt;
&lt;p&gt;安装 Gatsby 命令行工具&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm i -g gatsby-cli&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;使用模板初始化项目&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby new blog https://github.com/gatsbyjs/gatsby-starter-hello-world&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该命令克隆 starter 仓储并安装 npm 包。&lt;/p&gt;
&lt;p&gt;Gatsby 提供了开发模式，类似 webpack-dev-server。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cd blog
gatsby develop&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Gatsby 会编译运行项目，终端最底部会有 &lt;code class=&quot;language-text&quot;&gt;the development server is listening at:&lt;/code&gt; &lt;a href=&quot;http://localhost:8000&quot;&gt;http://localhost:8000&lt;/a&gt;. 浏览器打开该地址&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/a273c8965ea8138ecda407d435619be4/bde20/hello-world.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 68.96162528216703%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABiklEQVQ4y9WSzUvCYBzHVxH0B3TrHHSQTl0jiLr0IP0TQXSLUFBvXYI6VdBFzKueugUFaR16g5So3HKbijSDOefLnOna3H7teZx5CdE69YUPz563z7PDl6LspG8v55LPsdV7OrPi2ntE0zsJ5NpNoqntB7R4mEBMikb0K4sYG5pJo5cUQ775TA5xfBbjZrns8vXN3QT2UdxT8kJtFoHPFyCaFOE0rcAZV4cTWoFztgaqqoJcrkBJLkOlWoO62iDzN6EAQuEdxKIEfCbbiESiM9g3znKZuNbSodFQDQDL6gEEnHa7TTBN05mb1qeuW7qu4wX8qBIMBmeJsCiKcfsi2DuGaYHVtk/gU90RK7vyHzDxXU3T6qFQqCMslUpE6DhgSIiw1Wr1hJIkfQudEQbNQMJh8v+FhjV8OsJmsyeUZTnmPGj0qUff2tidVI7D4Y5QEIQrp0tgGMZQ2MUmfyLlcx9HB/tEOOb1et2BQMDj8/k2f4Pf79/ybKyvLS3MT1KVSpVyMmIz+gdIvgANa3AgFcwClQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;screenshot&quot;
        title=&quot;&quot;
        src=&quot;/static/a273c8965ea8138ecda407d435619be4/73d01/hello-world.png&quot;
        srcset=&quot;/static/a273c8965ea8138ecda407d435619be4/a3b1f/hello-world.png 197w,
/static/a273c8965ea8138ecda407d435619be4/07137/hello-world.png 393w,
/static/a273c8965ea8138ecda407d435619be4/73d01/hello-world.png 786w,
/static/a273c8965ea8138ecda407d435619be4/a5918/hello-world.png 1179w,
/static/a273c8965ea8138ecda407d435619be4/03181/hello-world.png 1572w,
/static/a273c8965ea8138ecda407d435619be4/bde20/hello-world.png 1772w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2 id=&quot;体验&quot;&gt;&lt;a href=&quot;#%E4%BD%93%E9%AA%8C&quot; aria-label=&quot;体验 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;体验&lt;/h2&gt;
&lt;p&gt;访问　&lt;a href=&quot;http://localhost:8000&quot;&gt;http://localhost:8000&lt;/a&gt; 时，Gatsby 会加载 &lt;code class=&quot;language-text&quot;&gt;src/pages/index.js&lt;/code&gt; 并渲染。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;src/pages 下的文件会映射成页面，如 src/pages/about.js 对应地址为 &lt;a href=&quot;http://localhost:8000/about/&quot;&gt;http://localhost:8000/about/&lt;/a&gt; 页面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;src/pages 下的 js 文件是普通的 jsx 文件，你可以调用 React 函数，你可以安装并使用 npm 包，你可以应用包括 css, css-in-js, css modules 在内的各种 css 风格。&lt;/p&gt;
&lt;p&gt;现在我们再建一个页面 src/pages/about.js, 并让页面支持导航，可以在 home 和 about 之间跳转。&lt;/p&gt;
&lt;p&gt;index.js 和 about.js 代码如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./src/pages/about.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Link &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-link&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ListLink&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline-block`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; marginRight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`0 auto`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxWidth&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;650&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; padding&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.25rem 1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;header&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; marginBottom&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.5rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; textShadow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; backgroundImage&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h3&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;MyBlog&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; listStyle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; float&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`right`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Home&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/about/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;About&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      Home Page
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./src/pages/about.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Link &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-link&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ListLink&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline-block`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; marginRight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`0 auto`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxWidth&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;650&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; padding&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.25rem 1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;header&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; marginBottom&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.5rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; textShadow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; backgroundImage&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h3&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;MyBlog&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; listStyle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; float&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`right`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Home&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/about/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;About&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      About Page
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/09765a676c00921b36e4ba9849d79b2a/89f99/home-01.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 629px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 16.534181240063592%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsSAAALEgHS3X78AAAAWUlEQVQI152MSwqAMBBDe/8TuhVXVp2W6ccPdGJb1GULBsIkTHhq9yf0ZFFukYhUt/T+U0pwJuKIF5yNuQuUz2EcZpDmH0ABU6hApgcYggeZDcuqv2EP2NrcAtHsbuKHZDAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;index-demo&quot;
        title=&quot;&quot;
        src=&quot;/static/09765a676c00921b36e4ba9849d79b2a/89f99/home-01.png&quot;
        srcset=&quot;/static/09765a676c00921b36e4ba9849d79b2a/a3b1f/home-01.png 197w,
/static/09765a676c00921b36e4ba9849d79b2a/07137/home-01.png 393w,
/static/09765a676c00921b36e4ba9849d79b2a/89f99/home-01.png 629w&quot;
        sizes=&quot;(max-width: 629px) 100vw, 629px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;一个只有两个页面的站点就完成了，可以试试点击链接，是能够正常跳转的。&lt;/p&gt;
&lt;h2 id=&quot;布局&quot;&gt;&lt;a href=&quot;#%E5%B8%83%E5%B1%80&quot; aria-label=&quot;布局 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;布局&lt;/h2&gt;
&lt;p&gt;上面的站点中，导航部分明显是通用的，它是属于布局页面的。我们这就将它抽离出来，放入合适的位置。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;src/layouts 存放布局，src/layouts/index.js 是默认布局。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./src/layouts/index.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; Link &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-link&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;token function-variable function&quot;&gt;ListLink&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token parameter&quot;&gt;props&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;li&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline-block`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; marginRight&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;to&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;props&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;children&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;li&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; children &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`0 auto`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; maxWidth&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;650&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; padding&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.25rem 1rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;header&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; marginBottom&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`1.5rem`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; textShadow&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; backgroundImage&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;h3&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; display&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`inline`&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;MyBlog&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;h3&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;Link&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;ul&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;token script language-javascript&quot;&gt;&lt;span class=&quot;token script-punctuation punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; listStyle&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`none`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; float&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`right`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt; margin&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;0&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;Home&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
        &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt; &lt;span class=&quot;token attr-name&quot;&gt;to&lt;/span&gt;&lt;span class=&quot;token attr-value&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;/about/&lt;span class=&quot;token punctuation&quot;&gt;&quot;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;About&lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token class-name&quot;&gt;ListLink&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;ul&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;header&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token function&quot;&gt;children&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;src/layouts 下的页面组件有一个 children 属性&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;抽出布局元素后，src/pages 下的 index.js  和 about.js 变得很简单了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./src/pages/index.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    Home Page
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./src/pages/about.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    About Page
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;graphql&quot;&gt;&lt;a href=&quot;#graphql&quot; aria-label=&quot;graphql permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;GraphQL&lt;/h2&gt;
&lt;p&gt;Gatsby 基于 React 和 GraphQL。React 负责显示层，GraphQL 负责数据层。&lt;/p&gt;
&lt;p&gt;现在我们需要在 about 页面显示邮件信息，这个信息可能变动，可能还要显示在其它页面，直接在 about 页面中写死是没发接受的，如何将数据提供给 about 页面中的 React 呢？&lt;/p&gt;
&lt;p&gt;答案是 GraphQL。页面中需要的数据统统需要走 GraphQL 获取。&lt;/p&gt;
&lt;p&gt;Gatsby 为我们提供了 GraphQL IDE, 访问地址是 &lt;a href=&quot;http://localhost:8000/___graphql%E3%80%82&quot;&gt;http://localhost:8000/___graphql。&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/9a2ddd6c04a1c127b074e42b6afa826b/031e8/graphql-01.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 55.59748427672956%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABd0lEQVQoz3WSy07DMBBF8/8LBCz4HrZQltAlLTR90ITEbzsm8WVs17RQaulo3LHm6NpptVgs8Pwyx6peY7F8Q73e4H1VY73ZprpvWjRNg7Ztf2ja3PuPqu97OKOA0SF4C3z9gfp+cHDDACklus8OkgsIIcGFAOcn0O9qdBr3rx53T8TM4/pxws2MoHpL9ephwpIFxBWloueot5/YdgLGOhg3wEboLO4rZy32dDh/rbFjBr0N6Mz0C+fHLKQBpQ1arlDveyihoIXOUE8bi8qS0GgNzhgurWnKwoFSKEXDJGXyIGIqy5gsQgetBLp2i9EbDM78DEml6FqWhNNRGPvEruNQSZSFxrn0BJWjjRQMkjUYBw1nNT2+StL4EYwxZ0JBZ12UKZOhXkx3SEgDIRDxaiHtgYAQ8oeIteyLMPJB7y57umbE5nRJGBOUgUurnHvvU3pJCe1BUkSRdOVTYUnzHyUhp/9flhxFRXaW8FLSo9CndGX4tBa+AR4iUZGB73qjAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/9a2ddd6c04a1c127b074e42b6afa826b/73d01/graphql-01.png&quot;
        srcset=&quot;/static/9a2ddd6c04a1c127b074e42b6afa826b/a3b1f/graphql-01.png 197w,
/static/9a2ddd6c04a1c127b074e42b6afa826b/07137/graphql-01.png 393w,
/static/9a2ddd6c04a1c127b074e42b6afa826b/73d01/graphql-01.png 786w,
/static/9a2ddd6c04a1c127b074e42b6afa826b/031e8/graphql-01.png 795w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;sitePage 可供访问的页面; sitePlugin 加载的插件; site 站点配置&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;邮件信息应该在站点配置中。看看里面有什么?&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/4b5432e52ea7c3b10a6f8894ffa1e4f9/f4471/graphql-02.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 438px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 88.58447488584476%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAYAAABb0P4QAAAACXBIWXMAAAsSAAALEgHS3X78AAABnElEQVQ4y62TW07DMBBFszT4gT2wFzYDEnyyAzbQAn8I2jRN2zzbpokTN7ETO5exAQnxkPpgpKt4lPj4xjPjpEmCsetiNHbx8vKK1WqFLMvguhPkeYE15fP5DFEcoygKhGFotdlsbP5dznTq4eHxkfSEwXAI358RYI7BYIggCEkLjEYjeJ6HmKCTyYQOG2OxCBBF0Q85VVWhrmtorYC+h5QthJDoug6NEHbdtq2VoPxzLaW0+Xc5TdNYqw2BatGCqDgmnO12C845OqUxyxpEpULCeySVRkxacg1NzvsdZYGsLAFZ4/K+wcmVwNlNi/PbFqfXLS7uJLhU9nSzYSeHJQG11giXOZ49qmLGwQRQiB5Fo6DUHkBTEHOP5mNeMWqTJXjJ6JV+/6LXhwNN/+Ws/NgMe3dKHQFkVO0oTmBaybSLCQM7GGi63zRsTNMj5D8A8zy3I5akqW3eo4GMMRqfGGm6tBPTU0HMxBwENLFeZzTLUyyCAFOaad/3Lfyd0+/v0PTipyPzNL/dfXG3N/Cv2AX0K/AvHeVwHze/xRs/T3khD1DdUwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/4b5432e52ea7c3b10a6f8894ffa1e4f9/f4471/graphql-02.png&quot;
        srcset=&quot;/static/4b5432e52ea7c3b10a6f8894ffa1e4f9/a3b1f/graphql-02.png 197w,
/static/4b5432e52ea7c3b10a6f8894ffa1e4f9/07137/graphql-02.png 393w,
/static/4b5432e52ea7c3b10a6f8894ffa1e4f9/f4471/graphql-02.png 438w&quot;
        sizes=&quot;(max-width: 438px) 100vw, 438px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;没有我们所需要的。怎样将邮件信息放入 GraphQL &gt; site 中呢？&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Gatsby 启动时会读取项目下的 gatsby-config.js 文件，并将 siteMetadata 放入 GraphQL &gt; site 下。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;javascript&quot;&gt;&lt;pre class=&quot;language-javascript&quot;&gt;&lt;code class=&quot;language-javascript&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;// ./gatsby-config.js&lt;/span&gt;

module&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;exports &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  siteMetadata&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    mail&lt;span class=&quot;token punctuation&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`gatsby@example.com`&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重新运行 &lt;code class=&quot;language-text&quot;&gt;gatsby develop&lt;/code&gt;,  发现 GraphQL &gt; site 下多了 &lt;code class=&quot;language-text&quot;&gt;siteMetadata&lt;/code&gt; 字段。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/cb0cc920fd1a6e89811a214c6b3b19a8/1d25d/graphql-03.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 43.76498800959232%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAAA5klEQVQoz8WQUW+DIBRG/f8/b5367MQuQzuswAW0+u1ipyO22R5HcsINyT05ISuKAnUtUFUVzk0DIcRKw3PXdWjbdkdKeeD+Vosz3sQ7yrJERs7BhxGBmabpgRAClOpx7QcYY2GshTYJ2mBgjCW8nE7INAW0A0vHG56deZ5heEF+KNRS4aI0rLYg40DkQe5OjMrzHFmsWJaFV5f1TtmFXHXlmq7nmk8uvTBRbAiWZZYcnB/xGoXbYnofhYPmZSJ4zzUp37JILHwQriTzXsh16XLK9v5UmJ6j0NJP0fZvfxb+KnT/JPwCiRe5CrCaZLUAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/cb0cc920fd1a6e89811a214c6b3b19a8/73d01/graphql-03.png&quot;
        srcset=&quot;/static/cb0cc920fd1a6e89811a214c6b3b19a8/a3b1f/graphql-03.png 197w,
/static/cb0cc920fd1a6e89811a214c6b3b19a8/07137/graphql-03.png 393w,
/static/cb0cc920fd1a6e89811a214c6b3b19a8/73d01/graphql-03.png 786w,
/static/cb0cc920fd1a6e89811a214c6b3b19a8/1d25d/graphql-03.png 834w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;现在已经成功的将邮件信息成功的放入到 GraphQL 了，接下来我们需要在 src/pages/about.js 中获取并使用这一信息。 &lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;jsx&quot;&gt;&lt;pre class=&quot;language-jsx&quot;&gt;&lt;code class=&quot;language-jsx&quot;&gt;&lt;span class=&quot;token comment&quot;&gt;//./src/pages/about.js&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;import&lt;/span&gt; React &lt;span class=&quot;token keyword&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;react&quot;&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;default&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token parameter&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt; data &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token operator&quot;&gt;=&gt;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;(&lt;/span&gt;
  &lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    About Page
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
      mail: &lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;data&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;site&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;siteMetadata&lt;span class=&quot;token punctuation&quot;&gt;.&lt;/span&gt;mail&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
    &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;token plain-text&quot;&gt;
  &lt;/span&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token tag&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;&amp;lt;/&lt;/span&gt;div&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;&gt;&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;export&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;const&lt;/span&gt; query &lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt; graphql&lt;span class=&quot;token template-string&quot;&gt;&lt;span class=&quot;token string&quot;&gt;`
  query AboutQuery {
    site {
      siteMetadata {
        mail
      }
    }
  }
`&lt;/span&gt;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如上，在 about.js 中添加 &lt;code class=&quot;language-text&quot;&gt;graphql&lt;/code&gt; 标签模板，并调用属性 data 即可。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;Gatsby 内部会通过 AST 读取 &lt;code class=&quot;language-text&quot;&gt;graphql&lt;/code&gt; 标签模板，请求获取并获取数据，之后将数据绑定到组件的 data 属性中。页面只需要负责解答获取哪些数据，怎样使用数据即可。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;数据&quot;&gt;&lt;a href=&quot;#%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;数据 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;数据&lt;/h2&gt;
&lt;p&gt;就博客系统来说，原始数据是一批 Markdown 文件，我们需要将这批数据导入到 Gatsby 系统，使其能被页面组件以 GraphQL 查询访问。&lt;/p&gt;
&lt;p&gt;我们使用插件 &lt;code class=&quot;language-text&quot;&gt;gatsby-source-filesystem&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;gatsby-transformer-remark&lt;/code&gt; 完成这项工作。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby-source-filesystem&lt;/code&gt; 读取文件系统，并将文件和目录信息导入 GraphQL 中。 &lt;code class=&quot;language-text&quot;&gt;gatsby-transformer-remark&lt;/code&gt; 从文件系统信息中获取 markdown 文件信息，提取转化后导入 GraphQL 中。&lt;/p&gt;
&lt;p&gt;准备两篇博客文章　&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;// ./blogs/pandas-and-bananas.md

&lt;span class=&quot;token hr punctuation&quot;&gt;---&lt;/span&gt;
title: Pandas and Bananas
&lt;span class=&quot;token title important&quot;&gt;date: &quot;2017-08-21&quot;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;&lt;/span&gt;

Do Pandas eat bananas? Check out this short video that shows that yes! pandas do
seem to really enjoy bananas!&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;markdown&quot;&gt;&lt;pre class=&quot;language-markdown&quot;&gt;&lt;code class=&quot;language-markdown&quot;&gt;// ./blogs/sweet-pandas-eating-sweets.md

&lt;span class=&quot;token hr punctuation&quot;&gt;---&lt;/span&gt;
title: &quot;Sweet Pandas Eating Sweets&quot;
&lt;span class=&quot;token title important&quot;&gt;date: &quot;2017-08-10&quot;
&lt;span class=&quot;token punctuation&quot;&gt;---&lt;/span&gt;&lt;/span&gt;

Pandas are really sweet.

Here&apos;s a video of a panda eating sweets.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其次我们需要安装插件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm i -S gatsby-source-filesystem gatsby-transformer-remark&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;并在 &lt;code class=&quot;language-text&quot;&gt;gatsby-config.js&lt;/code&gt; 配置插件及其选项&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./gatsby-config.js

module.exports = {
  siteMetadata: {
    mail: `gatsby@example.com`,
  },
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `src`,
        path: `${__dirname}/blogs/`,
      },
    },
  ],
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;访问 GraphQL, 发现多了一些 Query。访问 allFile，可以获取到刚添加的博客文件信息。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/624cb86c7aa09e639b8d0e3232981a5b/981f8/graphql-04.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.90276110444178%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABEklEQVQoz62S627DIAyF8/6PuT9tWkICtiGQLGd2em9abZVm6cgYyZ+PEU0YBpAkjOOIUgpqrVdZPU0TRATe9wghIhKfFOl6DnomErSHI5qcBL0UuJjwLorC4xDxtevgtTHroPSkooM7HdrY9O95Rp1mLMuy0QrUBjYnA2PXetChB7cD+HAStT2SJ7hWHTIzZgVa3EMutYWtT0HX6iN4IEjgB9ldlgznOl055zPoBnjOpVRwNIeEvblzYaPV4f54A/7q0Bp7c0lrZq9u/TlrnYLoym4LvI97YNSnoZSQ9DeksTxI9G6sE5z3fwfa10hZYSlDXigr2HUfAFn/qgGt+TmvQH3nz4AsD4DV7X8BL7BXwB/7x1pecBHz4gAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/624cb86c7aa09e639b8d0e3232981a5b/73d01/graphql-04.png&quot;
        srcset=&quot;/static/624cb86c7aa09e639b8d0e3232981a5b/a3b1f/graphql-04.png 197w,
/static/624cb86c7aa09e639b8d0e3232981a5b/07137/graphql-04.png 393w,
/static/624cb86c7aa09e639b8d0e3232981a5b/73d01/graphql-04.png 786w,
/static/624cb86c7aa09e639b8d0e3232981a5b/981f8/graphql-04.png 833w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;添加 &lt;code class=&quot;language-text&quot;&gt;gatsby-transformer-remark&lt;/code&gt;， 从文件中提取并解析 markdown 文件。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./gatsby-config.js

module.exports = {
  siteMetadata: {
    mail: `gatsby@example.com`,
  },
  plugins: [
    {
      resolve: `gatsby-source-filesystem`,
      options: {
        name: `src`,
        path: `${__dirname}/blogs/`,
      },
    },
    `gatsby-transformer-remark`,
  ],
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;访问 allMarkdownRemark&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/31e9e915a9b989a08548ffed8d91884e/d181f/graphql-05.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 76.89530685920577%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAAAsSAAALEgHS3X78AAABxElEQVQ4y5VU27KiMBD0///wbLkProhAEkKuBLTs7QlHj+X6sKaqawaK6fSkJ+z2+z2+vn7hdDqhOTY1tm2LpmnQ9z201lBKQUm85y/o+N3heEZzarGbpgkxZcQ8V6zr+sCyLLhcLkgpYTQWznlMPmByAZ7Rh1jhap4wDAq7LB/HgrONKOsV75YQe+twaA1OxmNkcS4FM99nQVlQuPFoLXayu6zOJsR5qfntdntAVmFBpJJpiugUO9IOcZgeCHyXuJHuqDDGWItcKkjl8pZwWVb43iKeRwz7DvYwIDT6h1QINQkHjV0IAdfr9VF8j8+5EAbjkGygaWz7TsbnSGVCmMcArczW8ivZW4WDRVIOhkpHkkYi/FEI7ViRSGg0CQsP95XoX4U8w7xNgpc4F2RORkrzZsqymWLElFfC5/VMGDxNYYtKS+tsk4pqyxJHj+zS1vJ/Ea5iCls7crB/93DSLnMxJnznaXAfEMoZVicdOhYPnMeHOhkhQhQaM35AeDZI/QRFA3qOTRQzROFxU1nHptcfKuRZWbrtSVyJOJcp5oo5F5jxA4Xicvh2OLEmzz9I88xruH5GKD+AxLGpBIyvmHk9hfAvBtyJcDHOVgEAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/31e9e915a9b989a08548ffed8d91884e/73d01/graphql-05.png&quot;
        srcset=&quot;/static/31e9e915a9b989a08548ffed8d91884e/a3b1f/graphql-05.png 197w,
/static/31e9e915a9b989a08548ffed8d91884e/07137/graphql-05.png 393w,
/static/31e9e915a9b989a08548ffed8d91884e/73d01/graphql-05.png 786w,
/static/31e9e915a9b989a08548ffed8d91884e/d181f/graphql-05.png 831w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;这样我们就能以 GraphQL 形式获取博客的 Markdown 文件数据。&lt;/p&gt;
&lt;h2 id=&quot;节点&quot;&gt;&lt;a href=&quot;#%E8%8A%82%E7%82%B9&quot; aria-label=&quot;节点 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;节点&lt;/h2&gt;
&lt;p&gt;节点是 Gatsby 数据的基本单元，Markdown 文件在 GraphQL 中对应的节点内容如下:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/home/sigoden/blog-codes/2018-03-13-how-to-use-gatsby/blogs/sweet-pandas-eating-sweets.md absPath of file &gt;&gt;&gt; MarkdownRemark&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;parent&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/home/sigoden/blog-codes/2018-03-13-how-to-use-gatsby/blogs/sweet-pandas-eating-sweets.md absPath of file&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;children&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;internal&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;content&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;---\ntitle: \&quot;Sweet Pandas Eating Sweets\&quot;\ndate: \&quot;2017-08-10\&quot;\n---\n\nPandas are really sweet.\n\nHere&apos;s a video of a panda eating sweets.\n&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;MarkdownRemark&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;contentDigest&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;599beb9abf7899c2ea0aa891810a95b6&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;owner&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;gatsby-transformer-remark&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;frontmatter&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;title&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Sweet Pandas Eating Sweets&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;date&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;2017-08-10&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;_PARENT&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/home/sigoden/blog-codes/2018-03-13-how-to-use-gatsby/blogs/sweet-pandas-eating-sweets.md absPath of file&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;parent&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/home/sigoden/blog-codes/2018-03-13-how-to-use-gatsby/blogs/sweet-pandas-eating-sweets.md absPath of file&quot;&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;excerpt&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pandas are really sweet. Here&apos;s a video of a panda eating sweets.&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;fileAbsolutePath&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/home/sigoden/blog-codes/2018-03-13-how-to-use-gatsby/blogs/sweet-pandas-eating-sweets.md&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;html&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&amp;lt;p&gt;Pandas are really sweet.&amp;lt;/p&gt;\n&amp;lt;p&gt;Here&apos;s a video of a panda eating sweets.&amp;lt;/p&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;htmlAst&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;root&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;children&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;element&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;tagName&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;p&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;children&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Pandas are really sweet.&quot;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;\n&quot;&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;element&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;tagName&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;p&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;properties&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token property&quot;&gt;&quot;children&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;text&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Here&apos;s a video of a panda eating sweets.&quot;&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;data&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;quirksMode&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;false&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;headings&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;timeToRead&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;tableOfContents&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
  &lt;span class=&quot;token property&quot;&gt;&quot;wordCount&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;paragraphs&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;sentences&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;words&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token number&quot;&gt;19&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;数据还是蛮丰富的，但是我们还缺少一个字段 &lt;code class=&quot;language-text&quot;&gt;slug&lt;/code&gt;(对应文章链接)，我们需要一种机制，能够修改 GraphQL 的数据。&lt;/p&gt;
&lt;p&gt;为了保证数据安全, Gatsby 的 GraphQL 只提供了查询，没有提供修改。Gatsby 提供了 Hook API 让我们可以在存储前进行修改数据。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;在启动时，Gatsby 会加载 &lt;code class=&quot;language-text&quot;&gt;gatsby-node.js&lt;/code&gt; 文件，并注册或执行里面的 Hook 函数。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./gatsby-node.js

const { createFilePath } = require(`gatsby-source-filesystem`)

exports.onCreateNode = ({ node, getNode, boundActionCreators }) =&amp;gt; {
  const { createNodeField } = boundActionCreators
  if (node.internal.type === `MarkdownRemark`) {
    const slug = createFilePath({ node, getNode, basePath: `blogs` })
    createNodeField({
      node,
      name: `slug`,
      value: slug,
    })
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;onCreateNode&lt;/code&gt; 在添加节点后被调用，我们检测类型为 &lt;code class=&quot;language-text&quot;&gt;MarkdownRemark&lt;/code&gt; 的的节点，为它们添加一个 &lt;code class=&quot;language-text&quot;&gt;slug&lt;/code&gt; 字段，&lt;code class=&quot;language-text&quot;&gt;slug&lt;/code&gt; 的值通过 Markdown 文件路径生成。这样就完成了 GraphQL 数据的修改。&lt;/p&gt;
&lt;p&gt;在 GraphiQL 中，发现节点下多了一个 &lt;code class=&quot;language-text&quot;&gt;fileds&lt;/code&gt; 字段，该字段下有一个 &lt;code class=&quot;language-text&quot;&gt;slug&lt;/code&gt; 字段。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8ebd7081d74166bb3375ee17cac2c299/d181f/graphql-06.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 49.939831528279186%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsSAAALEgHS3X78AAABM0lEQVQoz52S246DMAxE+f8v7Fu1QKEttyTODRDM2hS6gNqXjTQaJ0qOxlaS6/WKy+WCPM+RZRmKosDtViz7sixR1zWqqkIlvtUnPR5PpHmJnzRDopUCWQcXIpwP6PsBw/CncRzhvUfbdtDKQBmC0gTDbsgu0lwL487gxDk+cBFpbWDjgGmecV4DQ0kbZEWNvFLozCtAiD28iOt+GNE0rQAdwBDje0Q+lDXzftMC5KTE9yx3kD46VK2GJ4aaVS4gcmd10yAhoiUB1sfzzrda2rbckmegZpAWiLKwLPED0FqLaZqOsBNQEgqQrMezMzDsPsa3ZPZvYAjhkAo70D6hDF1mdW80nizfEWzDc29fHnxkYPsBuFtnIK1th/VH7PU94RegfA156FeY+KZ/AbeWP0H3wF8bYQge9ys2ZwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/8ebd7081d74166bb3375ee17cac2c299/73d01/graphql-06.png&quot;
        srcset=&quot;/static/8ebd7081d74166bb3375ee17cac2c299/a3b1f/graphql-06.png 197w,
/static/8ebd7081d74166bb3375ee17cac2c299/07137/graphql-06.png 393w,
/static/8ebd7081d74166bb3375ee17cac2c299/73d01/graphql-06.png 786w,
/static/8ebd7081d74166bb3375ee17cac2c299/d181f/graphql-06.png 831w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2 id=&quot;页面&quot;&gt;&lt;a href=&quot;#%E9%A1%B5%E9%9D%A2&quot; aria-label=&quot;页面 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;页面&lt;/h2&gt;
&lt;p&gt;在 Gatsby 中，节点是没有路由的，我们无法通过浏览器直接访问。我们能访问的只用页面。查询一些系统中现有的页面。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/b03644859068723eef0d3eb3a6f0cf86/2b385/graphql-07.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 78.80239520958084%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAAB20lEQVQ4y51U2W7jMBDz/39hHorWSXzFp6TR4RwNS8kxNu2mwHoFDMaXKJIz4yzPc+x2OxRFgcPhiLqqUJZlirqu0fc9uq5b8uP6VRzLGseiQqaUgoiF9QE+BJzP529xuVwQ+HwcJ2iloY2kMD+yNhYDv8mcszD+jHK0+G3dbjeIFpTVgKJTcDw88DA/zwzmMCMwi3XIrCXQ/Y5GObjzNQHceb9GXNfrFeIchBuLXkENGm40sJrKJoFzIQEbKs1EJDGw4QL/C2BiSEkzN+7rkV71sPsO5tBBWgWrCKodzKQXhpHBulaQ5+vb5ydkJKveoK8I+HFCXw6QjxbmrYEUQ3qnW3oYDV/Y/AF4yZByIksV2YhPMp1jFpfuo49J8gr4DPQXwwhID2MRCvo30kcfpdJDlwqzFMfYF4DP65tktkawHgdW+j0/QeUt5NhDmgm2W+zQ3bQBkMwsWSkCnFiQgV7KA9QOBk5Z6EH9I+DaNvRsoo/RrxQPuS5slRw9ZNMGbt6TZduM8GQaG/z/AKNkZRDYayXb5e29wZDa5gRD+cLetDxAN8MGhpOB9Jxljt7EzSpWORaE2bHangUzPHSDZJs8jBLjHId1jhnuMcubPIx/leSZn1P+GWtjfwFLLtl7oV1BHgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/b03644859068723eef0d3eb3a6f0cf86/73d01/graphql-07.png&quot;
        srcset=&quot;/static/b03644859068723eef0d3eb3a6f0cf86/a3b1f/graphql-07.png 197w,
/static/b03644859068723eef0d3eb3a6f0cf86/07137/graphql-07.png 393w,
/static/b03644859068723eef0d3eb3a6f0cf86/73d01/graphql-07.png 786w,
/static/b03644859068723eef0d3eb3a6f0cf86/2b385/graphql-07.png 835w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;只有我们先前创建的 home 和 about，以及一个开发模式下的 404 页面。&lt;/p&gt;
&lt;p&gt;我们需要将 MarkdownRemark 节点转换为 SitePage，以便访问。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;GraphQL 提供了 &lt;code class=&quot;language-text&quot;&gt;createPages&lt;/code&gt; 函数，它会在节点创建和变换完成之后调用，在该函数中我们使用 GraphQL 获取数据，再从这些数据中生成页面。&lt;/p&gt;
&lt;/blockquote&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./gatsby-node.js

const path = require(`path`)
const { createFilePath } = require(`gatsby-source-filesystem`)

exports.onCreateNode = ({ node, getNode, boundActionCreators }) =&amp;gt; {
  const { createNodeField } = boundActionCreators
  if (node.internal.type === `MarkdownRemark`) {
    const slug = createFilePath({ node, getNode, basePath: `blogs` })
    createNodeField({
      node,
      name: `slug`,
      value: slug,
    })
  }
}

exports.createPages = ({ graphql, boundActionCreators }) =&amp;gt; {
  const { createPage } = boundActionCreators
  return new Promise((resolve, reject) =&amp;gt; {
    graphql(`
      {
        allMarkdownRemark {
          edges {
            node {
              fields {
                slug
              }
            }
          }
        }
      }
    `
    ).then(result =&amp;gt; {
      result.data.allMarkdownRemark.edges.forEach(({ node }) =&amp;gt; {
        createPage({
          path: node.fields.slug,
          component: path.resolve(`./src/templates/blog-post.js`),
          context: {
            // Data passed to context is available in page queries as GraphQL variables.
            slug: node.fields.slug,
          },
        })
      })
      resolve()
    })
  })
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;createPage&lt;/code&gt; 函数用来创建页面。其参数&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;path: 页面的相对访问路径，以 / 开头&lt;/li&gt;
&lt;li&gt;component: 模板组件绝对路径。同 pages 下的 js 一样是一个 React 组件&lt;/li&gt;
&lt;li&gt;layout: 布局，默认为 &lt;code class=&quot;language-text&quot;&gt;index&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;context: 页面的上下文数据对象。会以 &lt;code class=&quot;language-text&quot;&gt;props.pathContext&lt;/code&gt; 的方式传递给 React 组件，也会以参数形式传递给 graphql 查询。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;新建博客页面的模板 &lt;code class=&quot;language-text&quot;&gt;src/templates/blog-post.js&lt;/code&gt;，其内容如下:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./src/templates/blog-post.js

import React from &amp;quot;react&amp;quot;

export default ({ data }) =&amp;gt; {
  const post = data.markdownRemark
  return (
    &amp;lt;div&amp;gt;
      &amp;lt;h1&amp;gt;{post.frontmatter.title}&amp;lt;/h1&amp;gt;
      &amp;lt;div dangerouslySetInnerHTML={{ __html: post.html }} /&amp;gt;
    &amp;lt;/div&amp;gt;
  )
}

export const query = graphql`
  query BlogPostQuery($slug: String!) {
    markdownRemark(fields: { slug: { eq: $slug } }) {
      html
      frontmatter {
        title
      }
    }
  }
`&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;再查询一下 SitePage, 发现已生成了 Markdown 对应页面。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/8e2d84be2b8928f2a6fc9f574a03dc1c/1d25d/graphql-08.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 61.15107913669065%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAAsSAAALEgHS3X78AAABfklEQVQoz5VSa2+DMAzk///DTZsqlUcI5O08gK7cTBlTt/ZLLZ3sBPnwnVOdTie8vb2jbVs0TQPRdRBC3M5SSmitoZSC0mrPTyDlgKaVOJ9rVMYYeB8QU4aniFLKH8zzjBgjjDYIziMEgg/h1nPA8b0PEXXdoCo5w+UZrWGy5QsrHmNZFpALOAuNRnsYSsjTjDIvjPlWL9cr5DCgSinhygefJnxx3mJd119sMXNjjAnWRXTSgpRH1Kxq5Mw1jQ7FRoi6Q0VEuFwudwTrA+HC34M0iJ3B+NHDfPag8wjq7Q7+SVG0E2aWfDQeZEf8Em6SfQSxT94R54TE51QmZPY5ZfZ6uaDnJVab8Ufj/YT/CTfJgUlG9jAxaWL50dKtjiZgogLRimeEeDIhSx4sYqMxsFxbK9ABvgv1iDx4iOYFQlIONDhY9tHzMpLdJvsBT11ChujlC4Qsmfit5ml6wOblzIt7idDzg855X8AzTPy0XiDcl5J5kq35Ph/1tOwTfgPa5KFEXT9AugAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;graphql&quot;
        title=&quot;&quot;
        src=&quot;/static/8e2d84be2b8928f2a6fc9f574a03dc1c/73d01/graphql-08.png&quot;
        srcset=&quot;/static/8e2d84be2b8928f2a6fc9f574a03dc1c/a3b1f/graphql-08.png 197w,
/static/8e2d84be2b8928f2a6fc9f574a03dc1c/07137/graphql-08.png 393w,
/static/8e2d84be2b8928f2a6fc9f574a03dc1c/73d01/graphql-08.png 786w,
/static/8e2d84be2b8928f2a6fc9f574a03dc1c/1d25d/graphql-08.png 834w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;浏览器访问 &lt;a href=&quot;http://localhost:8000/pandas-and-bananas/&quot;&gt;http://localhost:8000/pandas-and-bananas/&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/f8daba413f341cc86968600e3a07aba2/04cb1/pandas-and-bananas.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 725px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 35.86206896551724%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAAx0lEQVQoz62Q2Q6CMBBF+f8/AxdcXvQFDSGAKZTERu3KtVOFSEyMJt7mpJ3p9LadyFoHfhK4CglS32Oi3ideGXIkrUw4R9CaFBltUB0bdEyMxVJKONe/mU3wg0wug6F8Gip5w2qdYr6YY7/bY7PZIoljJMkMyzTFIcvwreiiSGuNPM+R+YNFUaAsSzRNE2airmu0bTvCOQ8wX0Nxx7sQO+ceLyRDxhjqqsJZiLBhjIG1NkBrqnlFKeWZ5oa+Rvijwpc/Nv5HSHeaESGpELvadQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;blog page&quot;
        title=&quot;&quot;
        src=&quot;/static/f8daba413f341cc86968600e3a07aba2/04cb1/pandas-and-bananas.png&quot;
        srcset=&quot;/static/f8daba413f341cc86968600e3a07aba2/a3b1f/pandas-and-bananas.png 197w,
/static/f8daba413f341cc86968600e3a07aba2/07137/pandas-and-bananas.png 393w,
/static/f8daba413f341cc86968600e3a07aba2/04cb1/pandas-and-bananas.png 725w&quot;
        sizes=&quot;(max-width: 725px) 100vw, 725px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;可以正确的访问博客页面了。&lt;/p&gt;
&lt;p&gt;修改一下首页，使其显示文章列表。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./src/pages/index.js

import React from &amp;quot;react&amp;quot;
import Link from &amp;quot;gatsby-link&amp;quot;

export default ({ data }) =&amp;gt; {
  return (
    &amp;lt;div&amp;gt;
      &amp;lt;h2&amp;gt;
        Amazing Pandas Eating Things
      &amp;lt;/h2&amp;gt;
      &amp;lt;h4&amp;gt;
        {data.allMarkdownRemark.totalCount} Posts
      &amp;lt;/h4&amp;gt;
      {data.allMarkdownRemark.edges.map(({ node }) =&amp;gt;
        &amp;lt;div key={node.id}&amp;gt;
          &amp;lt;Link
            to={node.fields.slug}
          &amp;gt;
            &amp;lt;h3&amp;gt;
              {node.frontmatter.title}{&amp;quot; &amp;quot;}
              &amp;lt;span&amp;gt;— {node.frontmatter.date}&amp;lt;/span&amp;gt;
            &amp;lt;/h3&amp;gt;
            &amp;lt;p&amp;gt;
              {node.excerpt}
            &amp;lt;/p&amp;gt;
          &amp;lt;/Link&amp;gt;
        &amp;lt;/div&amp;gt;
      )}
    &amp;lt;/div&amp;gt;
  )
}

export const query = graphql`
  query IndexQuery {
    allMarkdownRemark(sort: { fields: [frontmatter___date], order: DESC }) {
      totalCount
      edges {
        node {
          id
          frontmatter {
            title
            date(formatString: &amp;quot;DD MMMM, YYYY&amp;quot;)
          }
          fields {
            slug
          }
          excerpt
        }
      }
    }
  }
`&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;博客系统到此完成了。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1522ec71c97304c8e8458c31365dd535/f84ea/home.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 632px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.0126582278481%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAAsSAAALEgHS3X78AAABcElEQVQoz42S63KCMBCFef8nq3/s1FbtWKnKWAGBAAkJN+F0N0iH2uvOnDnZEJZ8yzqVaSBCiVLX6PseXddZn65H5xifcXSXzr7X1C15Y/cdnVfwniMUaYW/YlqU49J2EIGEURXEWQ0FExHjde/i8WmB1XKFxeIBy9Uam80G9/M5XrZbzGZ35O6nG45Fb8NRSsLzPGRZBikltNZWxhibK6U+/BZ5WnyUowsN3w+uTFO+Sd5zv/pvC3wpKBNDPYzh7xIc1iF2ywAnWudxgeNLhD3tvbkxomOG/4SjUo2jGyHwBClFSC5ChfQ8iJueRso2ndcJiZ3z2M+RsCjPEz3cUKUGx22M4CDII/h7YUehLGrwSNVlA1MM+bjX1he0zcWOS8Pra24LFpmxRUK6HaOx8wcYm78shbHo/o4I6FxGrfgVWcvSFsmighCkxbVI7OGAyIpPA1pCZ4q8/Pkv83AyRlO1qK9qpiIsxp6K8W5HaIx32NxShqRxfX0AAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;home page&quot;
        title=&quot;&quot;
        src=&quot;/static/1522ec71c97304c8e8458c31365dd535/f84ea/home.png&quot;
        srcset=&quot;/static/1522ec71c97304c8e8458c31365dd535/a3b1f/home.png 197w,
/static/1522ec71c97304c8e8458c31365dd535/07137/home.png 393w,
/static/1522ec71c97304c8e8458c31365dd535/f84ea/home.png 632w&quot;
        sizes=&quot;(max-width: 632px) 100vw, 632px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;为了方便演示，这里只实现了基本功能，css，标签，翻页等就此略去。&lt;/p&gt;
&lt;h2 id=&quot;发布&quot;&gt;&lt;a href=&quot;#%E5%8F%91%E5%B8%83&quot; aria-label=&quot;发布 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;发布&lt;/h2&gt;
&lt;p&gt;Gatsby 是静态站点生成器，现在这种前后台的交互只存在开发模式下，在部署到生产环境前，我们可以就整个站点编译成一批静态资源，方便部署到静态站点伺服器上。&lt;/p&gt;
&lt;p&gt;这个操作只需要运行一个命令即可完成&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gatsby build&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;生成的数据位于项目的 &lt;code class=&quot;language-text&quot;&gt;public&lt;/code&gt; 文件夹下。&lt;/p&gt;
&lt;h2 id=&quot;结语&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AF%AD&quot; aria-label=&quot;结语 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结语&lt;/h2&gt;
&lt;p&gt;从整个博客的创建过程可以看到，Gatsby 在功能上是很强大灵活的，而使用上又不失简单方便。数据源方面可以接入 redis, mongo, mysql 等数据库系统，可以接入 medium, wordpress 等现成的博客和 CMS 系统，具体有哪些可以看看官方提供的插件，如果没有，你也可以自己贡献插件。不管是何种数据，只要能导入到 GraphQL 节点，Gatsby 就能使用。界面方面使用 React，功能和灵活性上的强大不言而喻。以 GraphQL 作为这两者的桥接简直是画龙点睛。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[对比分析 Dockerfile 中的 ENTRYPOINT 和 CMD]]></title><description><![CDATA[Dockerfile 中的 ENTRYPOINT 指令和 CMD 指令都可以设置容器启动时要执行的命令，但用途是有略微不同的，本文将通过实验分析它们的不同之处，给出最佳实践。]]></description><link>https://blog.sigoden.com/dockerfile-entrypoint-vs-cmd/</link><guid isPermaLink="false">https://blog.sigoden.com/dockerfile-entrypoint-vs-cmd/</guid><content:encoded>&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#%E6%A6%82%E8%BF%B0&quot; aria-label=&quot;概述 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;概述&lt;/h2&gt;
&lt;p&gt;Dockerfile 中的 ENTRYPOINT 指令和 CMD 指令都可以设置容器启动时要执行的命令。&lt;/p&gt;
&lt;p&gt;ENTRYPOINT 有两种形式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;exec 模式，如 &lt;code class=&quot;language-text&quot;&gt;ENTRYPOINT [&amp;quot;executable&amp;quot;, &amp;quot;param1&amp;quot;, &amp;quot;param2&amp;quot;]&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;shell 模式, 如 &lt;code class=&quot;language-text&quot;&gt;ENTRYPOINT command param1 param2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;而 CMD 也有两种形式:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;exec 模式，如 &lt;code class=&quot;language-text&quot;&gt;CMD [&amp;quot;executable&amp;quot;,&amp;quot;param1&amp;quot;,&amp;quot;param2&amp;quot;]&lt;/code&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当有 entrypoint 时，executable 等价于 param, 官方手册将其也作为了一种模式，严格来讲这仍是 exec 模式。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;shell 模式，&lt;code class=&quot;language-text&quot;&gt;CMD command param1 param2&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;实验过程&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E9%AA%8C%E8%BF%87%E7%A8%8B&quot; aria-label=&quot;实验过程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实验过程&lt;/h2&gt;
&lt;p&gt;为了研究它们的不同之处，我们通过实验，任意组合各种情形，分析其执行结果。&lt;/p&gt;
&lt;p&gt;ENTRYPOINT 和 CMD 分别有好多种情形，彼此间的组合情况更多，为了简化描述，我们引入代号。&lt;/p&gt;
&lt;p&gt;规则如下:&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;e -&gt; 表示 ENTRYPOINT&lt;/li&gt;
&lt;li&gt;c -&gt; 表示 CMD&lt;/li&gt;
&lt;li&gt;0 -&gt; 表示 Dockerfile 中没有指令。&lt;/li&gt;
&lt;li&gt;1 -&gt; 表示 Dockerfile 中指令采用 exec 形式，且仅有一个参数。&lt;/li&gt;
&lt;li&gt;2 -&gt; 表示 Dockerfile 中指令采用 shell 形式，且仅由一个参数。&lt;/li&gt;
&lt;li&gt;3 -&gt; 表示 Dockerfile 中指令采用 exec 形式, 有多个参数。&lt;/li&gt;
&lt;li&gt;4 -&gt; 表示 Dockerfile 中指令采用 shell 形式, 有多个参数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;举例说明，e1c1 表示 Dockerfile 中同时存在 ENTRYPOINT 和 CMD，且是 exec 形式，仅用一个参数。
其 Dockerfile 如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// ./Dockerfile.e1c1

FROM alpine

COPY ./mycmd /usr/bin/

ENTRYPOINT [&amp;quot;/usr/bin/mycmd&amp;quot;]

CMD [&amp;quot;arg&amp;quot;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;mycmd 命令用来打印命令行参数，其内容如下：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;#!/bin/sh

echo $@&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;实验中任意组合各种情况下的 ENTRYPOINT 和 CMD, 生成 Dockerfile。&lt;/p&gt;
&lt;p&gt;创建和执行过程：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker build -t e1c1 -f Dockerfile.e1c1 .
docker run -rm e1c1 
docker run -rm e1c1 a&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;收集 &lt;code class=&quot;language-text&quot;&gt;docker run&lt;/code&gt; 的输出，可以得到下表：&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;N.O.&lt;/th&gt;
&lt;th&gt;ENTRYPOINT&lt;/th&gt;
&lt;th&gt;CMD&lt;/th&gt;
&lt;th&gt;RUN&lt;/th&gt;
&lt;th&gt;OUPUT&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;e1c1&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;[&quot;arg&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;arg&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;[&quot;arg&quot;]&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e1c0&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e1c2&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;arg&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/bin/sh -c &quot;arg&quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;]&lt;/td&gt;
&lt;td&gt;arg&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e2c0&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e2c1&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;[&quot;arg&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;[&quot;arg&quot;]&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e2c2&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;arg&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd&lt;/td&gt;
&lt;td&gt;arg&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e0c0&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;docker: Error...&quot;exec: &quot;a&quot;: executable file not found...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;mycmd  a&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e0c1&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;mycmd&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;mycmd&quot;]&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;docker: Error...&quot;exec: &quot;a&quot;: executable file not found...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e0c2&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;mycmd&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;mycmd&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;docker: Error...&quot;exec: &quot;a&quot;: executable file not found...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e0c3&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;docker: Error...&quot;exec: &quot;a&quot;: executable file not found...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e0c4&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;mycmd a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;mycmd a&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;td&gt;docker: Error...&quot;exec: &quot;a&quot;: executable file not found...&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e3c0&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;a b&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e3c1&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;[&quot;b&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a b&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;[&quot;b&quot;]&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;a c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e3c2&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a /bin/sh -c &quot;b&quot;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;[&quot;/usr/bin/mycmd&quot;, &quot;a&quot;]&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;a c&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e4c0&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;a&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e4c1&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;[&quot;b&quot;]&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;b: line 1: /usr/bin/mycmd a: not found&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;[&quot;b&quot;]&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;c: line 1: /usr/bin/mycmd a: not found&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;e4c2&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/bin/sh: line 1: /usr/bin/mycmd a: not found&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;&lt;/td&gt;
&lt;td&gt;/usr/bin/mycmd a&lt;/td&gt;
&lt;td&gt;b&lt;/td&gt;
&lt;td&gt;c&lt;/td&gt;
&lt;td&gt;c: line 1: /usr/bin/mycmd a: not found&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;ul&gt;
&lt;li&gt;N.O. -&gt; 组合情形编号。&lt;/li&gt;
&lt;li&gt;ENTRYPOINT -&gt; Dockerfile 中指令 ENTRYPOINT 的值。&lt;/li&gt;
&lt;li&gt;CMD -&gt;  Dockerfile 中指令 CMD 的值。&lt;/li&gt;
&lt;li&gt;RUN 表示执行时传递给容器的值。&lt;/li&gt;
&lt;li&gt;OUTPUT 时执行后打印的结果。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;e2 时 cmd 值全部无效，可以得出 &lt;strong&gt;ENTRYPOINT 采用 shell 模式且没有参数时会忽略 cmd&lt;/strong&gt; 。&lt;/li&gt;
&lt;li&gt;e4 有 cmd 值全部报错，可以得出 &lt;strong&gt;ENTRYPOINT 采用 shell 模式有参数时传入 cmd 会报错&lt;/strong&gt; 。&lt;/li&gt;
&lt;li&gt;从 e2 和 e4 可以看出， &lt;strong&gt;推荐使用 exec 模式配置 ENTRYPOINT&lt;/strong&gt; ，它接受 cmd 且更安全。&lt;/li&gt;
&lt;li&gt;docker run 中 &lt;strong&gt;命令行传入的 cmd 会覆盖 Dockerfile 中的 CMD&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;根据 e1c2 和 e3c2， &lt;strong&gt;Dockerfile 中 CMD 在 shell 模式下内部会被转换为前部拼接 [&quot;/bin/sh&quot;, &quot;-c&quot;] 的 exec 模式&lt;/strong&gt;。&lt;/li&gt;
&lt;li&gt;结合 e1c2 和 e3c2,  &lt;strong&gt;推荐使用 exec 模式配置 CMD&lt;/strong&gt; 。&lt;/li&gt;
&lt;li&gt;从 e3 可以得出： &lt;strong&gt;Dockerfile 中的 ENTRYPOINT 在 exec 模式下自带的参数会与 cmd 参数拼接&lt;/strong&gt;&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Docker 一问一答]]></title><description><![CDATA[介绍并汇总 Docker 使用一些注意事项，技巧，心得]]></description><link>https://blog.sigoden.com/docker-faq/</link><guid isPermaLink="false">https://blog.sigoden.com/docker-faq/</guid><content:encoded>&lt;h2 id=&quot;最小的镜像是？&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%B0%8F%E7%9A%84%E9%95%9C%E5%83%8F%E6%98%AF%EF%BC%9F&quot; aria-label=&quot;最小的镜像是？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最小的镜像是？&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://hub.docker.com/_/scratch/&quot;&gt;scratch&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;scratch 镜像很赞，它简洁、小巧而且快速， 它没有 bug、安全漏洞、延缓的代码或技术债务。这是因为它基本上是空的。
scratch 镜像不能执行一些常规的 &lt;code class=&quot;language-text&quot;&gt;pull&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;run&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;tag&lt;/code&gt; 等 docker 命令，只能通过 Dockerfile 执行 &lt;code class=&quot;language-text&quot;&gt;FROM scratch&lt;/code&gt; 间接引用。
而且该指令并不生成新的数据层，相当于 metadata。&lt;/p&gt;
&lt;p&gt;它适用于直接包装单个命令，类似于:&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;dockerfile&quot;&gt;&lt;pre class=&quot;language-dockerfile&quot;&gt;&lt;code class=&quot;language-dockerfile&quot;&gt;FROM scratch
COPY hello /
CMD [&amp;quot;/hello&amp;quot;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;最小的操作系统镜像？&quot;&gt;&lt;a href=&quot;#%E6%9C%80%E5%B0%8F%E7%9A%84%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E9%95%9C%E5%83%8F%EF%BC%9F&quot; aria-label=&quot;最小的操作系统镜像？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;最小的操作系统镜像？&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://hub.docker.com/_/alpine/&quot;&gt;alpine&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;alpine 镜像封装了最小的操作系统 &lt;a href=&quot;https://www.alpinelinux.org&quot;&gt;alpine&lt;/a&gt;, 体积只用 5M，有包管理器 apk。很适合作为基础镜像，特别适合生产环境，够小又够用。&lt;/p&gt;
&lt;h2 id=&quot;多阶段构建-？&quot;&gt;&lt;a href=&quot;#%E5%A4%9A%E9%98%B6%E6%AE%B5%E6%9E%84%E5%BB%BA-%EF%BC%9F&quot; aria-label=&quot;多阶段构建 ？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;多阶段构建 ？&lt;/h2&gt;
&lt;p&gt;&lt;a href=&quot;https://docs.docker.com/develop/develop-images/multistage-build/#use-multi-stage-builds&quot;&gt;多阶段构建&lt;/a&gt;可以用来优化 Dockerfile，减小镜像体积。&lt;/p&gt;
&lt;p&gt;在生产环境中，我们通常只需要用到可执行文件，但为了生成构建该可执行文件，我们常常需要安装一些额外编译工具、库，这造成最后生成的镜像很脏很大。如果能把构建方面的工作和打包应用的工作分开，单一职责，我们就能优雅的得到干净的生产环境镜像了。多阶段构建就是用来完成这项工作。&lt;/p&gt;
&lt;p&gt;以 Go 应用举例&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM golang:1.7.3 as builder
WORKDIR /go/src/github.com/alexellis/href-counter/
RUN go get -d -v golang.org/x/net/html  
COPY app.go    .
RUN CGO_ENABLED=0 GOOS=linux go build -a -installsuffix cgo -o app .

FROM alpine:latest  
RUN apk --no-cache add ca-certificates
WORKDIR /root/
COPY --from=builder /go/src/github.com/alexellis/href-counter/app .
CMD [&amp;quot;./app&amp;quot;]  &lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;构建阶段生成可执行文件，封装阶段直接复制前面构建的可执行文件打包成镜像，这样我们就得到干净的小很多的使用生产环境下的应用镜像了。&lt;/p&gt;
&lt;h2 id=&quot;调整指令顺序会优化构建吗？&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E6%95%B4%E6%8C%87%E4%BB%A4%E9%A1%BA%E5%BA%8F%E4%BC%9A%E4%BC%98%E5%8C%96%E6%9E%84%E5%BB%BA%E5%90%97%EF%BC%9F&quot; aria-label=&quot;调整指令顺序会优化构建吗？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调整指令顺序会优化构建吗？&lt;/h2&gt;
&lt;p&gt;会，Docker 会缓存每部指令执行的数据层，如果检测到没有变动，会优先使用缓存，这能减少构建时间和资源消耗了。&lt;/p&gt;
&lt;p&gt;缓存是有顺序的，如果前面的缓存失效了，后面指令的缓存会被全部抛弃。所以应尽量将 &lt;strong&gt;不容易变动的指令前置，容易变动的指令后置&lt;/strong&gt; 。 &lt;/p&gt;
&lt;h2 id=&quot;构建缓存有哪些注意事项？&quot;&gt;&lt;a href=&quot;#%E6%9E%84%E5%BB%BA%E7%BC%93%E5%AD%98%E6%9C%89%E5%93%AA%E4%BA%9B%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9%EF%BC%9F&quot; aria-label=&quot;构建缓存有哪些注意事项？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;构建缓存有哪些注意事项？&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;会实际产生缓存的命令只有 &lt;code class=&quot;language-text&quot;&gt;RUN&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;COPY&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;ADD&lt;/code&gt;，其它指令只会产生临时数据层。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;Dockerfile 如果有变动，会从变动起始地方抛弃之后所有的缓存。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;RUN&lt;/code&gt; 是靠 Dockerfile 中该指令的内容来判断缓存失效的。&lt;code class=&quot;language-text&quot;&gt;RUN apt-get -y update&lt;/code&gt; 会使用缓存，不管源是否有更新。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;COPY&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;ADD&lt;/code&gt; 会校验文件是否变动判断缓存失效。&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;构建时如何忽略文件？&quot;&gt;&lt;a href=&quot;#%E6%9E%84%E5%BB%BA%E6%97%B6%E5%A6%82%E4%BD%95%E5%BF%BD%E7%95%A5%E6%96%87%E4%BB%B6%EF%BC%9F&quot; aria-label=&quot;构建时如何忽略文件？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;构建时如何忽略文件？&lt;/h2&gt;
&lt;p&gt;使用 &lt;a href=&quot;https://docs.docker.com/engine/reference/builder/#dockerignore-file&quot;&gt;.dockerignore &lt;/a&gt;&lt;/p&gt;
&lt;p&gt;默认情况下，docker 会将 Dockerfile 所在的目录的所有文件（递归）全部包含到镜像编译上下文中，里面的一些无用的文件会增加编译时间，如果包含到最终镜像文件中，还会造成镜像不必要臃肿。
可以在 Dockerfile 所在目录创建 .dockerignore 文件，用以忽略不必要的文件。&lt;/p&gt;
&lt;h2 id=&quot;dockerfile-如何嵌入文件？&quot;&gt;&lt;a href=&quot;#dockerfile-%E5%A6%82%E4%BD%95%E5%B5%8C%E5%85%A5%E6%96%87%E4%BB%B6%EF%BC%9F&quot; aria-label=&quot;dockerfile 如何嵌入文件？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dockerfile 如何嵌入文件？&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;docekerfile&quot;&gt;&lt;pre class=&quot;language-docekerfile&quot;&gt;&lt;code class=&quot;language-docekerfile&quot;&gt;RUN echo $&amp;#39;server {\n\
    listen          80;\n\
    server_name     example.com;\n\
    location / {\n\
      proxy_pass      http://localhost:8080;\n\
    }\n\
}&amp;#39;\
&amp;gt;&amp;gt; /etc/nginx/conf.d/server.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;add-和-copy-的区别？&quot;&gt;&lt;a href=&quot;#add-%E5%92%8C-copy-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F&quot; aria-label=&quot;add 和 copy 的区别？ permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ADD 和 COPY 的区别？&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;COPY 从文件系统复制文件到镜像&lt;/li&gt;
&lt;li&gt;COPY 优先使用&lt;/li&gt;
&lt;li&gt;ADD 包含了 COPY 的功能&lt;/li&gt;
&lt;li&gt;ADD 复制并解压压缩文件，如 &lt;code class=&quot;language-text&quot;&gt;ADD rootfs.tar.xz /&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;ADD 可以从 URL 下载文件到镜像，到并不会解压下载的压缩文件&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;命令行&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E4%BB%A4%E8%A1%8C&quot; aria-label=&quot;命令行 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命令行&lt;/h2&gt;
&lt;h3 id=&quot;一键清理&quot;&gt;&lt;a href=&quot;#%E4%B8%80%E9%94%AE%E6%B8%85%E7%90%86&quot; aria-label=&quot;一键清理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;一键清理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker system prune&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;会清理所以没有使用的资源，包括 &lt;code class=&quot;language-text&quot;&gt;image&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;volume&lt;/code&gt;，&lt;code class=&quot;language-text&quot;&gt;network&lt;/code&gt;。&lt;/p&gt;
&lt;h3 id=&quot;清除无用数据卷&quot;&gt;&lt;a href=&quot;#%E6%B8%85%E9%99%A4%E6%97%A0%E7%94%A8%E6%95%B0%E6%8D%AE%E5%8D%B7&quot; aria-label=&quot;清除无用数据卷 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;清除无用数据卷&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker volume rm $(docker volume ls -q -f &amp;quot;dangling=true&amp;quot;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;清除退出的容器&quot;&gt;&lt;a href=&quot;#%E6%B8%85%E9%99%A4%E9%80%80%E5%87%BA%E7%9A%84%E5%AE%B9%E5%99%A8&quot; aria-label=&quot;清除退出的容器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;清除退出的容器&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker rm $(docker ps -q -f &amp;quot;status=exited&amp;quot;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;清除无标示镜像&quot;&gt;&lt;a href=&quot;#%E6%B8%85%E9%99%A4%E6%97%A0%E6%A0%87%E7%A4%BA%E9%95%9C%E5%83%8F&quot; aria-label=&quot;清除无标示镜像 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;清除无标示镜像&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker rmi $(docker images -q -f &amp;quot;dangling=true&amp;quot;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;自动移除交互容器&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%8A%A8%E7%A7%BB%E9%99%A4%E4%BA%A4%E4%BA%92%E5%AE%B9%E5%99%A8&quot; aria-label=&quot;自动移除交互容器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自动移除交互容器&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker run -it --rm alpine&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--rm&lt;/code&gt; 标志在容器退出时自动删除&lt;/p&gt;
&lt;h3 id=&quot;表格形式显示时自定义栏目&quot;&gt;&lt;a href=&quot;#%E8%A1%A8%E6%A0%BC%E5%BD%A2%E5%BC%8F%E6%98%BE%E7%A4%BA%E6%97%B6%E8%87%AA%E5%AE%9A%E4%B9%89%E6%A0%8F%E7%9B%AE&quot; aria-label=&quot;表格形式显示时自定义栏目 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;表格形式显示时自定义栏目&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker ps --format &amp;quot;table {{.ID}}\t {{.Image}}\t {{.Status}}&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;使用-json-筛选和打印特定内容&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-json-%E7%AD%9B%E9%80%89%E5%92%8C%E6%89%93%E5%8D%B0%E7%89%B9%E5%AE%9A%E5%86%85%E5%AE%B9&quot; aria-label=&quot;使用 json 筛选和打印特定内容 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 JSON 筛选和打印特定内容&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker info --format &amp;quot;{{json .Plugins}}&amp;quot; | jq .&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[在 Bash 中使用 getopt 解析命令行参数]]></title><description><![CDATA[有时我们需要自动化一些作业，这就需要编写 BashScript。为了控制脚本的行为，我们有两种选择: 环境变量和命令行参数。BashScript 中解析命令行参数常常会用到 getopt。]]></description><link>https://blog.sigoden.com/how-to-use-getopt-to-build-cli/</link><guid isPermaLink="false">https://blog.sigoden.com/how-to-use-getopt-to-build-cli/</guid><content:encoded>&lt;h2 id=&quot;getopt-是什么&quot;&gt;&lt;a href=&quot;#getopt-%E6%98%AF%E4%BB%80%E4%B9%88&quot; aria-label=&quot;getopt 是什么 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;getopt 是什么&lt;/h2&gt;
&lt;p&gt;getopt 是一个 c 编写的程序，提供参数解析功能。它是为了替换 bash 内置的老的 getopts 函数。如果设置了 &lt;code class=&quot;language-text&quot;&gt;GETOPT_COMPATIBLE&lt;/code&gt; 环境变量，可以像使用 getopts 函数一样使用 getopt 命令。&lt;/p&gt;
&lt;p&gt;getopt vs getopts&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;getopts 是 bash 内建命令的， 而 getopt 是外部命令(所以发行版都有装)。&lt;/li&gt;
&lt;li&gt;getopts 不支持长选项， 比如： &lt;code class=&quot;language-text&quot;&gt;--date&lt;/code&gt;。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;getopt 支持选项重排。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;选项重排指可以将带 &lt;code class=&quot;language-text&quot;&gt;-&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;-–&lt;/code&gt; 的参数写在其他参数的前面，也可以写在后面。如 &lt;code class=&quot;language-text&quot;&gt;mycmd -a abc edf -d&lt;/code&gt; 进重排变为 &lt;code class=&quot;language-text&quot;&gt;mycmd -a abc -d -- edf&lt;/code&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;选项约束不满足时，如必选参数缺失，getopt 会报警，而 getopts 需要自己实现。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;命令行概述&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E4%BB%A4%E8%A1%8C%E6%A6%82%E8%BF%B0&quot; aria-label=&quot;命令行概述 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命令行概述&lt;/h2&gt;
&lt;p&gt;结合一个常见的命令进行分析&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -X POST --data &amp;#39;a=3&amp;#39; httpbin.org/post&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;getopt 将命令行参数划分为三类: 短选项(&lt;code class=&quot;language-text&quot;&gt;-x&lt;/code&gt;), 长选项(&lt;code class=&quot;language-text&quot;&gt;--data&lt;/code&gt;), 位置参数 (&lt;code class=&quot;language-text&quot;&gt;httpbin.org/post&lt;/code&gt;)。其中选项可以接或不接参数。&lt;/p&gt;
&lt;h3 id=&quot;短选项&quot;&gt;&lt;a href=&quot;#%E7%9F%AD%E9%80%89%E9%A1%B9&quot; aria-label=&quot;短选项 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;短选项&lt;/h3&gt;
&lt;p&gt;短选项由 &lt;code class=&quot;language-text&quot;&gt;-&lt;/code&gt;(单个破折号) 接单字母组成，字母区分大小写如 &lt;code class=&quot;language-text&quot;&gt;-X&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-a&lt;/code&gt; ，可以接0到1个参数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不带参数如 &lt;code class=&quot;language-text&quot;&gt;-I&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-f&lt;/code&gt;，作为标志位。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;带参数&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;空格形式 &lt;code class=&quot;language-text&quot;&gt;-X POST&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;-f @demo.txt&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;略去空格形式 &lt;code class=&quot;language-text&quot;&gt;-XPOST&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;长选项&quot;&gt;&lt;a href=&quot;#%E9%95%BF%E9%80%89%E9%A1%B9&quot; aria-label=&quot;长选项 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;长选项&lt;/h3&gt;
&lt;p&gt;长选项由 &lt;code class=&quot;language-text&quot;&gt;--&lt;/code&gt;(两个连续的破折号)和任意长度的字母数字组成，如 &lt;code class=&quot;language-text&quot;&gt;-cookie-jar&lt;/code&gt;，同样可接或不接参数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;不带参数如 &lt;code class=&quot;language-text&quot;&gt;--crlf&lt;/code&gt;，作为标志位。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;带参数&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;以空格隔开选项和参数，&lt;code class=&quot;language-text&quot;&gt;--data &amp;#39;a=3&amp;#39;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;以 &lt;code class=&quot;language-text&quot;&gt;=&lt;/code&gt; 连接选项和参数，&lt;code class=&quot;language-text&quot;&gt;--data=&amp;#39;a=3&amp;#39;&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;选项字符串&quot;&gt;&lt;a href=&quot;#%E9%80%89%E9%A1%B9%E5%AD%97%E7%AC%A6%E4%B8%B2&quot; aria-label=&quot;选项字符串 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;选项字符串&lt;/h2&gt;
&lt;p&gt;如何告知 getopt 使其能以我们期望的方式解析选项和参数呢？需要先将选项编码为选项字符串。&lt;/p&gt;
&lt;p&gt;getopt 识别两种选项字符串 ，一种用来配置短选项解析，另一种则是用来解析长选项。&lt;/p&gt;
&lt;h3 id=&quot;短选项-1&quot;&gt;&lt;a href=&quot;#%E7%9F%AD%E9%80%89%E9%A1%B9-1&quot; aria-label=&quot;短选项 1 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;短选项&lt;/h3&gt;
&lt;p&gt;getopt 也是一个命令行程序，它也是接受选项的。短选项字符串通过选项 &lt;code class=&quot;language-text&quot;&gt;-o&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;--options&lt;/code&gt; 传递。&lt;/p&gt;
&lt;p&gt;编码规则如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;每个字母均代表一个短选项。&lt;/li&gt;
&lt;li&gt;字母后如果接 &lt;code class=&quot;language-text&quot;&gt;:&lt;/code&gt;(单个冒号), 代表这个选项必须接一个参数。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;字母后如果接 &lt;code class=&quot;language-text&quot;&gt;::&lt;/code&gt;(两个冒号), 代表这个选项可接或不接参数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;带参数时，选项与参数采用空格形式，&lt;code class=&quot;language-text&quot;&gt;-a3&lt;/code&gt; 合法，而 &lt;code class=&quot;language-text&quot;&gt;-a 3&lt;/code&gt;非法。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字母后没有冒号，代表这个选项不接参数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;举例分析:&lt;/p&gt;
&lt;p&gt;选项字符串 &lt;code class=&quot;language-text&quot;&gt;a:bc::&lt;/code&gt;，表示有三个短选项，&lt;code class=&quot;language-text&quot;&gt;-a&lt;/code&gt; 必须接一个参数，&lt;code class=&quot;language-text&quot;&gt;-b&lt;/code&gt; 不接参数，&lt;code class=&quot;language-text&quot;&gt;-c&lt;/code&gt; 接可选参数。&lt;/p&gt;
&lt;h3 id=&quot;长选项-1&quot;&gt;&lt;a href=&quot;#%E9%95%BF%E9%80%89%E9%A1%B9-1&quot; aria-label=&quot;长选项 1 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;长选项&lt;/h3&gt;
&lt;p&gt;长选项字符串通过选项 &lt;code class=&quot;language-text&quot;&gt;-l&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;--longoptions&lt;/code&gt; 传递。&lt;/p&gt;
&lt;p&gt;编码规则如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;多个选项用 &lt;code class=&quot;language-text&quot;&gt;,&lt;/code&gt;(逗号)隔开。&lt;/li&gt;
&lt;li&gt;字母后如果接 &lt;code class=&quot;language-text&quot;&gt;:&lt;/code&gt;(单个冒号), 代表这个选项必须接一个参数。&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;字母后如果接 &lt;code class=&quot;language-text&quot;&gt;::&lt;/code&gt;(两个冒号), 代表这个选项可接或不接参数。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;带参数时，选项与参数需要使用 &lt;code class=&quot;language-text&quot;&gt;=&lt;/code&gt; 形式连接，&lt;code class=&quot;language-text&quot;&gt;--long=abc&lt;/code&gt; 合法，而 &lt;code class=&quot;language-text&quot;&gt;--long abc&lt;/code&gt;非法。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;字母后没有冒号，代表这个选项不接参数。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;举例分析:&lt;/p&gt;
&lt;p&gt;选项字符串 &lt;code class=&quot;language-text&quot;&gt;getopt -l foo,bar::,baz:&lt;/code&gt;，表示有三个长选项，&lt;code class=&quot;language-text&quot;&gt;--foo&lt;/code&gt; 不接参数，&lt;code class=&quot;language-text&quot;&gt;--bar&lt;/code&gt; 参数可选，&lt;code class=&quot;language-text&quot;&gt;--baz&lt;/code&gt; 必须接一个参数。&lt;/p&gt;
&lt;h2 id=&quot;用法&quot;&gt;&lt;a href=&quot;#%E7%94%A8%E6%B3%95&quot; aria-label=&quot;用法 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;用法&lt;/h2&gt;
&lt;p&gt;知道如何配置了，但具体如何使用呢？&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token shebang important&quot;&gt;#!/bin/bash&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 选项 `-a` 和 `--arga` 接可选参数&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 选项 `-b` 和 `--argb` 不接参数，充当莫种标志&lt;/span&gt;
&lt;span class=&quot;token comment&quot;&gt;# 选项 `-c` 和 `--argc` 必须接一个参数 &lt;/span&gt;

ARG_B&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;0

&lt;span class=&quot;token comment&quot;&gt;# 读取命令行参数, `-n` 指定命令名，报错时用到。&lt;/span&gt;
TEMP&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;getopt -o a::bc: -l arga::,argb,argc: -n &lt;span class=&quot;token string&quot;&gt;&apos;mycmd&apos;&lt;/span&gt; -- &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$@&lt;/span&gt;&quot;&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;`&lt;/span&gt;&lt;/span&gt;
&lt;span class=&quot;token function&quot;&gt;eval&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;set&lt;/span&gt; -- &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$TEMP&lt;/span&gt;&quot;&lt;/span&gt;

&lt;span class=&quot;token comment&quot;&gt;# 提取选项和其参数&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;do&lt;/span&gt;
    &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$1&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
        -a&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--arga&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$2&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ARG_A&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token string&quot;&gt;&apos;some default value&apos;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; 2 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                *&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ARG_A&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; 2 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            esac &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        -b&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--argb&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ARG_B&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        -c&lt;span class=&quot;token operator&quot;&gt;|&lt;/span&gt;--argc&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;token keyword&quot;&gt;case&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;&lt;span class=&quot;token variable&quot;&gt;$2&lt;/span&gt;&quot;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;in&lt;/span&gt;
                &lt;span class=&quot;token string&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; 2 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
                *&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; ARG_C&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token variable&quot;&gt;$2&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; 2 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
            esac &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        --&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token function&quot;&gt;shift&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;break&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
        *&lt;span class=&quot;token punctuation&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;Internal error!&quot;&lt;/span&gt; &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;token keyword&quot;&gt;exit&lt;/span&gt; 1 &lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;;&lt;/span&gt;
    esac
&lt;span class=&quot;token keyword&quot;&gt;done&lt;/span&gt;

&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ARG_A = &lt;span class=&quot;token variable&quot;&gt;$ARG_A&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ARG_B = &lt;span class=&quot;token variable&quot;&gt;$ARG_B&lt;/span&gt;&quot;&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ARG_C = &lt;span class=&quot;token variable&quot;&gt;$ARG_C&lt;/span&gt;&quot;&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;在 BashScript 中使用 getopt，可以让命令行的解析提取变得直白优雅。
上面介绍的部分已经足够日常使用了。但并没有涵盖 getopt 全部功用，更多需求可以查询其手册。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用 CI 构建和发布 electron 应用]]></title><description><![CDATA[通过 Electron，我们可以使用自己所熟悉的前端技术轻松构建出一款能运行在 Windows, Linux 和 Mac 上的桌面级应用程序。本文将介绍一种简单高效的方法构建并发布安装包。]]></description><link>https://blog.sigoden.com/build-and-publish-electron-app-with-ci/</link><guid isPermaLink="false">https://blog.sigoden.com/build-and-publish-electron-app-with-ci/</guid><content:encoded>&lt;p&gt;Electron 是一款可以通过 Web 技术构建跨平台桌面应用的框架。它将 Chromium 和 Node.js 的事件循环整合在一起，并提供了一些与原生系统交互的 API。&lt;/p&gt;
&lt;p&gt;通过 Electron，我们可以使用自己所熟悉的前端技术轻松构建出一款能运行在 Windows, Linux 和 Mac 上的桌面级应用程序。已经有很多文章介绍了如何开发全平台应用，但是如何高效便捷的构建软件安装包并面向公众发布却较少被提及。本文将介绍一种简单高效的方法构建并发布安装包。&lt;/p&gt;
&lt;p&gt;&lt;a href=&quot;https://github.com/sigoden/alphat&quot;&gt;AlphaT&lt;/a&gt; 是我最近使用 electron 开发的一款应用。这款应用的构建和发布中的一些经验和总结，催生了这篇博文。&lt;/p&gt;
&lt;p&gt;简单说一下构建和发布流程：配置构建工具 &lt;a href=&quot;https://github.com/electron-userland/electron-builder&quot;&gt;electron-builder&lt;/a&gt;, 配置 &lt;a href=&quot;http://www.appveyor.com/&quot;&gt;Travis&lt;/a&gt; 以构建 Linux 和 Mac 应用，配置 &lt;a href=&quot;http://www.appveyor.com/&quot;&gt;AppVeyor&lt;/a&gt; 以构建 Windows 应用，当提交代码到 Github 后，CI 自动拉取代码，运行 electron-builder 相关命令，生成个平台的安装包，并将安装包推送到 Github Releases 中。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2a849dc4e78806b5d648dc322e3a0635/f3ccd/alphat-release.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 80.85106382978722%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAIAAACZeshMAAAACXBIWXMAAAsSAAALEgHS3X78AAABTklEQVQoz42TWVLDMAyGc30eOA8zHIalpZC6iXfLi7ygNKUQmhb+8Xg0sj7J8tINwvYctjyElBNmzIXmecw2zQ7Ce79XxkpluFRCGSE1Yu40H7TgyoADT0NqAz4Y6yx4bV2ISHxM6HwIMdEge/bQ3N09jPePA0XXWkqpmHM9WrPIbktxKfdsYAOntY5pZDpRXGv1MvRSlD2mFGMiu5scOeZx00DsZN7xyVvrrUTUrXPwBbdmrQ0hSCP7PRNCSqmo8+N21jVn7n66AMBMsh58+4cWMDsMT8+vfc9uM/OJ/oZH7TdD2onEFLpYTq0vRWGJbg7gN8wJHlOvkoIM12FEBO9X4fghk4R8PvNLTfBq5S2nyjgaPD6Q9coxxpVtCzP1rG6WpSXvw+Kez/AbjxHrdfZUGWCt55dDpJ3TT7qOfz++BZxLwUx/o5b6xz3P/Cdw4qvhv5Wz+AAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;alphat release&quot;
        title=&quot;&quot;
        src=&quot;/static/2a849dc4e78806b5d648dc322e3a0635/73d01/alphat-release.png&quot;
        srcset=&quot;/static/2a849dc4e78806b5d648dc322e3a0635/a3b1f/alphat-release.png 197w,
/static/2a849dc4e78806b5d648dc322e3a0635/07137/alphat-release.png 393w,
/static/2a849dc4e78806b5d648dc322e3a0635/73d01/alphat-release.png 786w,
/static/2a849dc4e78806b5d648dc322e3a0635/f3ccd/alphat-release.png 1034w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;仅仅进行 git 提交就能自动构建并发布，这么酷的事情一定很复杂吧？&lt;/p&gt;
&lt;p&gt;实际上并不复杂，都只是一些简单配置而已。顺便说一句，对于开源项目，Travis 和 AppVeyor 是能够免费使用的。下面我会一步一步进行说明。&lt;/p&gt;
&lt;h2 id=&quot;使用-electron-builder&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-electron-builder&quot; aria-label=&quot;使用 electron builder permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 electron-builder&lt;/h2&gt;
&lt;p&gt;electron-builder 是一款 electron 应用打包工具，简单配置就可以生成各种不同平台不同格式的安装包。支持的包有：mac 平台的 mas, dmg, pkg；win 平台的 nsis, nsisWeb, portable, appx, squirrelWindows；linux 平台的 deb, snap, appImage, pacman, rpm, freebsd, p5p, apk。同时，它还支持将构建的安装包上传到 Github Releases, Amazon S3 等服务中。从构建到发布，我们唯一剩下要做的就是正确配置。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install electron-builder --save-dev&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;添加脚本&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;postinstall&amp;quot;: &amp;quot;electron-builder install-app-deps&amp;quot;,
&amp;quot;dist&amp;quot;: &amp;quot;electron-builder --publish onTagOrDraft&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中 &lt;code class=&quot;language-text&quot;&gt;postinstall&lt;/code&gt; 不是必须的，只有在使用了原生模块时需要。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;--publish onTagOrDraft&lt;/code&gt; 用来自动发布，详见&lt;a href=&quot;https://github.com/electron-userland/electron-builder#cli-usage&quot;&gt;文档&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;构建配置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;electron 可以从 &lt;code class=&quot;language-text&quot;&gt;package.json&lt;/code&gt; 的 &lt;code class=&quot;language-text&quot;&gt;build&lt;/code&gt; 中读取配置信息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;build&amp;quot;: {
  &amp;quot;appId&amp;quot;: &amp;quot;com.sigoden.alphat&amp;quot;,
  &amp;quot;mac&amp;quot;: {
    &amp;quot;category&amp;quot;: &amp;quot;public.app-category.utilities&amp;quot;
  },
  &amp;quot;dmg&amp;quot;: {
    &amp;quot;contents&amp;quot;: [
      {
        &amp;quot;x&amp;quot;: 110,
        &amp;quot;y&amp;quot;: 150
      },
      {
        &amp;quot;x&amp;quot;: 240,
        &amp;quot;y&amp;quot;: 150,
        &amp;quot;type&amp;quot;: &amp;quot;link&amp;quot;,
        &amp;quot;path&amp;quot;: &amp;quot;/Applications&amp;quot;
      }
    ]
  },
  &amp;quot;win&amp;quot;: {
    &amp;quot;target&amp;quot;: &amp;quot;nsis&amp;quot;
  },
  &amp;quot;linux&amp;quot;: {
    &amp;quot;category&amp;quot;: &amp;quot;Utility&amp;quot;,
    &amp;quot;target&amp;quot;: [
      &amp;quot;deb&amp;quot;,
      &amp;quot;AppImage&amp;quot;
    ]
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;mac&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;dmg&lt;/code&gt; 将指导 electron-builder 构建适用于苹果系统的应用，&lt;code class=&quot;language-text&quot;&gt;win&lt;/code&gt; 指导构建 windows 应用，它表明制作安装包为 nsis 格式，&lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt; 用于构建 linux 应用，它将生成安装包 deb 和 appImage。&lt;/p&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;mac&lt;/code&gt; 和 &lt;code class=&quot;language-text&quot;&gt;linux&lt;/code&gt; 下的 category 必须，具体有那些可选字段参考 &lt;a href=&quot;https://developer.apple.com/app-store/categories/&quot;&gt;mac category&lt;/a&gt; 和 &lt;a href=&quot;https://gist.githubusercontent.com/sigoden/d31049af934844ee4055c37fa70a843c/raw/71ddf814b0a83e9327d00892ef14586a72811f61/linux%2520application%2520category&quot;&gt;linux category&lt;/a&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;提供 icon&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;icon 是必须的，缺失和尺寸错误均将造成构建失败。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;build
├── icon.icns
├── icon.ico
└── icons
    ├── 1024x1024.png
    ├── 128x128.png
    ├── 16x16.png
    ├── 24x24.png
    ├── 256x256.png
    ├── 32x32.png
    ├── 48x48.png
    ├── 512x512.png
    ├── 64x64.png
    └── 96x96.png&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我提供了一个自动从一张 1024x1204 png 图片生成这一切的 &lt;a href=&quot;https://gist.githubusercontent.com/sigoden/02aaf1201a43bc9257362aea090783d7/raw/79cddde8f9a410ef00d9acc21d18c48ac45a446f/makeicon&quot;&gt;shell 脚本&lt;/a&gt;。
当然，你也可以使用在线工具如 &lt;a href=&quot;https://iconverticons.com/online/&quot;&gt;https://iconverticons.com/online/&lt;/a&gt;、&lt;a href=&quot;https://cloudconvert.com&quot;&gt;https://cloudconvert.com&lt;/a&gt; 进行 icon 转换和制作。&lt;/p&gt;
&lt;h2 id=&quot;生成-gh_token&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E6%88%90-gh_token&quot; aria-label=&quot;生成 gh_token permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生成 GH_TOKEN&lt;/h2&gt;
&lt;p&gt;electron-builder 需要 GH&lt;em&gt;TOKEN(Github Personal access token) 才有权限上传文件到 Github Releases 中。该 Token 在 &lt;a href=&quot;https://github.com/settings/tokens&quot;&gt;github token 配置页面&lt;/a&gt; 中进行设置。由于我们的 CI 只需要公用仓储的访问权限，所以只需要勾选`repo &gt; public&lt;/em&gt;repo` 复选框即可。这个 token 只显示一次，需要记录下来，我们在 CI 中配置 GH_TOKEN 环境变量时要用到这个值。&lt;/p&gt;
&lt;h2 id=&quot;配置-ci&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE-ci&quot; aria-label=&quot;配置 ci permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置 CI&lt;/h2&gt;
&lt;p&gt;你可能认为我们并不需要 CI。然而，我们需要为三种不同平台构建应用，而应用是有平台依赖的。你的 Linux 无法构建 Mac 应用，Linux 能通过 wine 构建 windows 应用，但是如此 hack 的行为你能相信构建成的应用的质量吗？正常来说是适用于特定平台的应用是需要在对应平台构建的。所以我们需要 CI，使用 AppVeyor 构建 windows 应用，使用 Travis 构建 Linux 和 Mac 应用。&lt;/p&gt;
&lt;h3 id=&quot;appveyor&quot;&gt;&lt;a href=&quot;#appveyor&quot; aria-label=&quot;appveyor permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;AppVeyor&lt;/h3&gt;
&lt;p&gt;这儿有一份简单（但包含需要的一切）的 &lt;code class=&quot;language-text&quot;&gt;appveyor.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;platform:
  - x64

cache:
  - node_modules
  - &amp;#39;%APPDATA%\npm-cache&amp;#39;
  - &amp;#39;%USERPROFILE%\.electron&amp;#39;

install:
  - ps: Install-Product node 8 x64
  - npm install

build_script:
  - npm run dist

test: off

branches:
  only:
    - master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置很简单明了，从字段名中我们看出各项参数的作用。需要注意的是 &lt;code class=&quot;language-text&quot;&gt;install&lt;/code&gt; 段，指定安装 node-v8-x64，然后安装包依赖。真正的构建由 &lt;code class=&quot;language-text&quot;&gt;build_script&lt;/code&gt; 段控制。&lt;code class=&quot;language-text&quot;&gt;branches&lt;/code&gt; 段表明只对 master 提交进行构建。&lt;/p&gt;
&lt;p&gt;不要忘记配置 GH_TOKEN 环境变量。&lt;/p&gt;
&lt;p&gt;可以直接在　&lt;code class=&quot;language-text&quot;&gt;appveyor.yml&lt;/code&gt; 中配置变量，　如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;environment:
  GH_TOKEN:
    secure: &amp;lt;encrypt_value&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;其中的 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;encrypt_value&amp;gt;&lt;/code&gt; 可以通过将 GH_TOKEN 用 AppVeyor 提供的 &lt;a href=&quot;https://ci.appveyor.com/tools/encrypt&quot;&gt;工具&lt;/a&gt; 加密后获得。&lt;/p&gt;
&lt;p&gt;你也可以在项目设置中配置

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/06163dfa2179d1fdcb3254429acc3bcd/84566/appveyor-env.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 78.28810020876827%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAQCAYAAAAWGF8bAAAACXBIWXMAAAsSAAALEgHS3X78AAABv0lEQVQ4y41U7XKbMBDkxfM4fYbkQfqn+dNMxjbjjAEJJPSFtL2TLRlj0lYzNwih2907rWgOxyO890gpIcaYnzmA/L4sC70jj1QmfxmNtTYneh9yMoNrNcHTulYKQsoKVMl2onxvur6DNQZLCIgEaAnw0Mschkj+dxTQpm1PEEMPZ2d4ZxEIuBcSYlJZtXfuVva1JevYVeicf2BipVIKjHKEnCYoUm8JdAtQooBXwGEYSNVSAb13aNsWl0sHJwRAoImT6JvWisgkxnHMT0NkBbQC8gcu89YJ+Jhw1B6DjwiDQDqfkYggETHTcvkl1qq/ASSFtPGiDaQLULF2HOg6gMD/eSjcL7ZOBaTyz5IOZIlZMZeb8oyCyz+dkKinaWOjqpB9xvLLcHzKs31mL6ZmcvJnVb41Npc8z/NDyd2kYSiRlZd2VEUrknwgt1jZxl2v3hpQzdBEwkTFVhVsVeJuD7cLgXom7Z1ge4fLPJIbUvB4Hw3e1Z20qU0tChYqUUvKCLguP9/jTMzWIV++HgTevsyVhAG3zBcb8ON3j4/J1k17pfE6K/xUDp9zuCssG0vi0Sx4+SXwc/S7gN/9xsraHwXN63AHuukAAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;appveyor env&quot;
        title=&quot;&quot;
        src=&quot;/static/06163dfa2179d1fdcb3254429acc3bcd/73d01/appveyor-env.png&quot;
        srcset=&quot;/static/06163dfa2179d1fdcb3254429acc3bcd/a3b1f/appveyor-env.png 197w,
/static/06163dfa2179d1fdcb3254429acc3bcd/07137/appveyor-env.png 393w,
/static/06163dfa2179d1fdcb3254429acc3bcd/73d01/appveyor-env.png 786w,
/static/06163dfa2179d1fdcb3254429acc3bcd/84566/appveyor-env.png 958w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;配置完成。&lt;/p&gt;
&lt;p&gt;当你提交 master 分支和 vx.xx.xx 标签到 github 时，appveyor 将自动构建 windows 安装包并发布到 Github draft release。&lt;/p&gt;
&lt;h3 id=&quot;travis&quot;&gt;&lt;a href=&quot;#travis&quot; aria-label=&quot;travis permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Travis&lt;/h3&gt;
&lt;p&gt;Travis 的设置与 AppVeyor 类似。添加 &lt;code class=&quot;language-text&quot;&gt;.travis.yml&lt;/code&gt; 文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;osx_image: xcode8.3

dist: trusty
sudo: false

language: node_js
node_js: &amp;quot;8&amp;quot;

env:
  global:
    - ELECTRON_CACHE=$HOME/.cache/electron
    - ELECTRON_BUILDER_CACHE=$HOME/.cache/electron-builder

os:
  - linux
  - osx

cache:
  directories:
  - node_modules
  - $HOME/.cache/electron
  - $HOME/.cache/electron-builder
  - $HOME/.npm/_prebuilds

script:
  - npm run dist

branches:
  only:
    - master&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;language&lt;/code&gt; 指定 node&lt;em&gt;js,  这样我们可以就使用 node 和 npm 。`node&lt;/em&gt;js&lt;code class=&quot;language-text&quot;&gt;中指定 node 版本。需要特别注意的是&lt;/code&gt;os` 段，指定 linux 和 osx，这样 Travis 能够在一次提交中同时运行两个构建，在 linux 下构建
deb 包和 appImage，在 osx 下构建 dmg 和 mac。&lt;/p&gt;
&lt;p&gt;同时不要忘了设置 GH_TOKEN。&lt;/p&gt;
&lt;p&gt;你可以使用 travis 命令行工具对 GH_TOKEN 进行加密&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gem install travis

travis encrypt -r sigoden/alphat GH_TOKEN=&amp;quot;&amp;lt;token&amp;gt;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该命令会输出如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;secure: &amp;quot;&amp;lt;encrypted data&amp;gt;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将 &lt;code class=&quot;language-text&quot;&gt;&amp;lt;encrypted data&amp;gt;&lt;/code&gt; 添加到 &lt;code class=&quot;language-text&quot;&gt;.travis.yml&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;env:
  global:
    - secure: &amp;quot;&amp;lt;encrypted data&amp;gt;&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;同样你也可以在项目设置页面配置环境变量

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/54ff361522e88b0d0a25fb7dc0debbc5/a6f40/travis-env.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 97.1861471861472%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAATCAYAAACQjC21AAAACXBIWXMAAAsSAAALEgHS3X78AAACKUlEQVQ4y6VUW5LTMBDU/a/BFfiAG2x++NlyAQVOCGV2E/LyS37LTbewUl5nU0ChypSUcWs009OSsdYiyzJUVYXruq5QZCU+JxG+2U/AyN84vmrLYRTgeDyiLEsURYHT6QRbWQYs8Lj5gLh4nMFvAywPMMMwYOh7tG2Lruv83PN/09R+e9UDg3NwtNcylF/V1XXt95mi7dA5XxPcBAjAnoe1Q497Yx70muGRJcbrNTNqXphODBw9/HhGtP+JjtnLr4xUWQj6gsMkSbBarVCyIeJRpoDDdKrGm+gj3n+J0TCQeJYJp8yWQY0252zMKJ7EJ82XMCtpx80nW3n/MGGuuGVTxF/H3TUBI/5/mJadqdjdkvwMs4bMTQ3Dwj/PdJ6xeT6dsTsckF4uuNDSNPVa1CyTThN+31GrwpzPZ4/TJQhyCU2U5Mzbr2usvifeaQkINybwo8zexRs8ENPOMDIFuCn5Txr7VzMl+ct5UqZu05z7uzt775spKImUPBXSGANKj3ayUH54NALHeZ57HcrvNTs1xQfUxwtBdr+H3WxQSrQk2Audazs9GtvtFnEc+3lDnEx+7dccmmh0ndwkascOuqcnOHa5p7+Vj6e6eYlcH9j1KIp8lqpCQy+WfKYbHDqJegJ7081hxuNu93vNTeOd1+bm6lkv6u4q4GtgCVnZk7dRtniylvdYT5eyNT0DqmxpKoBFsN7Ghr6Gsy978gunRlTkOfg0dBlU8i8UoMtfI3X8dwAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;travis env&quot;
        title=&quot;&quot;
        src=&quot;/static/54ff361522e88b0d0a25fb7dc0debbc5/73d01/travis-env.png&quot;
        srcset=&quot;/static/54ff361522e88b0d0a25fb7dc0debbc5/a3b1f/travis-env.png 197w,
/static/54ff361522e88b0d0a25fb7dc0debbc5/07137/travis-env.png 393w,
/static/54ff361522e88b0d0a25fb7dc0debbc5/73d01/travis-env.png 786w,
/static/54ff361522e88b0d0a25fb7dc0debbc5/a6f40/travis-env.png 924w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;配置完成。&lt;/p&gt;
&lt;p&gt;当你提交 master 分支和 vx.xx.xx 标签到 github 时，travis 将自动构建 linux 和 osx 安装包当发布到 Github draft release。&lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;上面的介绍配置很简练的，尽管它确实能够为我们搭建了一套构建发布体系，但对于正式的商业应用，仍然有许多要调整补充的。你可能要添加原生包支持，应用签名，发布到到 Mac App Store 或 Windows Store 等方面的配置。但我相信这些都不是大问题，因为文档都有说明，而且 CI 类似虚拟机，允许安装并使用命令，本地做的工作几乎都可以在 CI 上完成。希望大家读了这篇文章后能有所收获。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[使用 verdaccio 搭建 npm 私有仓储]]></title><description><![CDATA[私有 npm 仓储可以保护企业的内部库，可以通过缓存加快企业内部包的安装。如何搭建一套私有 npm 仓储呢？]]></description><link>https://blog.sigoden.com/verdaccio-private-npm-registry/</link><guid isPermaLink="false">https://blog.sigoden.com/verdaccio-private-npm-registry/</guid><content:encoded>&lt;p&gt;本文将讲述如何使用 Verdaccio  搭建私有 npm 仓储。&lt;/p&gt;
&lt;h2 id=&quot;入门&quot;&gt;&lt;a href=&quot;#%E5%85%A5%E9%97%A8&quot; aria-label=&quot;入门 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;入门&lt;/h2&gt;
&lt;p&gt;verdaccio 是个发布在 npm 上的命令行工具。可以通过 npm 直接下载安装&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm i -g verdaccio&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;verdaccio 在文件系统上存储数据，没有额外依赖，而且提供了一套默认配置，我们可以直接启动仓储服务&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;$ verdaccio

 warn --- config file  - /home/ubuntu/.config/verdaccio/config.yaml
 warn --- http address - http://localhost:4873/ - verdaccio/2.3.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;终端上的日志显示了默认配置文件路径和 verdaccio 工作的地址端口&lt;/p&gt;
&lt;p&gt;浏览器打开&lt;code class=&quot;language-text&quot;&gt;http://localhost:4873/&lt;/code&gt; ，页面如下&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2da30c8e79a31ce587e22614b8e10763/9c15e/verdaccio-home-default.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 46.292585170340686%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAJCAYAAAAywQxIAAAACXBIWXMAAAsSAAALEgHS3X78AAABRElEQVQoz5XRvU7CcBQF8L6NYVaZNBFdTDS+hQ/g5EAIlIlNNhs6MZS2CTSUqjFuJk7A1FIGURmMC19agkLpx/FSNGqoBv/JL6dNbk9vWubp6ABd4RiPh7t42NlAe2+LxNDe38Z9LIrWegSttchXfl5/uCO3qyvobkbRIczo5gpvZhWj60tYWhnDC5VUMDynPKP7SgmWWgpyqM5ZavGnchGv9OwMgyWP/81fh/FdF75HZuk4lHPT8Rgv/T76nU7gudcLWIMBppPJfM5ZtLCh7/tYeuuQWSZswLZtiKIIjuOQy/HgeZ4yF+C4U+TzeTi0TVjpr4WapkEQBEiSBFmWg5wpFApQFOV/hWP6ftnsCeLxOFKpFNJpFizLIplMIpFIIJPJBC9dutClH2SaJmq1Kur1OhqNBjFgGAZ0XUez2YTneaGF7+WIfDT77ObcAAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;verdaccio&quot;
        title=&quot;&quot;
        src=&quot;/static/2da30c8e79a31ce587e22614b8e10763/73d01/verdaccio-home-default.png&quot;
        srcset=&quot;/static/2da30c8e79a31ce587e22614b8e10763/a3b1f/verdaccio-home-default.png 197w,
/static/2da30c8e79a31ce587e22614b8e10763/07137/verdaccio-home-default.png 393w,
/static/2da30c8e79a31ce587e22614b8e10763/73d01/verdaccio-home-default.png 786w,
/static/2da30c8e79a31ce587e22614b8e10763/9c15e/verdaccio-home-default.png 998w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;恭喜！仓储搭建并运行成功。&lt;/p&gt;
&lt;h2 id=&quot;配置&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;storage: 设置托管或缓存包的存放目录&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;~~ users: 权限控制，已准备弃用~~&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;auth: 权限控制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;htpasswd: 启用 htpasswd 插件管理权限&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;file: 制定 htpasswd 文件路径，htpasswd 中存储者用户名和加密过的秘钥&lt;/li&gt;
&lt;li&gt;max_users: 最多允许注册用户数&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;uplinks: 设置外部仓储，如果 verdaccio 找不到请求的包（非 verdaccio 托管），就会查找外部仓储。常见的有&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;{name}: 外部仓储名称&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;url: 访问路径&lt;/li&gt;
&lt;li&gt;timeout: 超时&lt;/li&gt;
&lt;li&gt;maxage: 默认值 2m，2m 钟内不会就同样的请求访问外部仓储&lt;/li&gt;
&lt;li&gt;fail_timeout: 如果外部访问失败，在多长时间内不回重试&lt;/li&gt;
&lt;li&gt;headers: 添加自定义 http 头当外部仓储访问请求中，例如&lt;code class=&quot;language-text&quot;&gt;authorization: &amp;quot;Basic YourBase64EncodedCredentials==&amp;quot;&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;cache: 是否启用缓存，默认启用。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;常用仓储有&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npmjs:
  url: https://registry.npmjs.org
yarnjs:
  url: https://registry.yarnpkg.com
cnpmjs:
  url: https://registry.npm.taobao.org&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;packages: 包访问或发布控制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;{regexp}: 包名匹配正则。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;access: 访问控制，可选值有&lt;code class=&quot;language-text&quot;&gt;$all&lt;/code&gt;（用户不限制）, &lt;code class=&quot;language-text&quot;&gt;$anonymous&lt;/code&gt;（用户不限制）, &lt;code class=&quot;language-text&quot;&gt;$authenticated&lt;/code&gt;（所有登录用户）,  &lt;code class=&quot;language-text&quot;&gt;username&lt;/code&gt;( 用户名，需指定具体用户，可指定多个用户，用户间空格隔开，如 secret super-secret-area ultra-secret-area)。&lt;del&gt;尽管&lt;code class=&quot;language-text&quot;&gt;@all&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;@anonymous&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;all&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;undefined&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;anonymous&lt;/code&gt;目前仍然可以使用，但已准备废弃。&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;&lt;del&gt;allow_access: access 的别称，已准备弃用。&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;publish: 发布控制，配置请参考 access&lt;/li&gt;
&lt;li&gt;&lt;del&gt;allow_publish: publish 的别称，已准备弃用。&lt;/del&gt;&lt;/li&gt;
&lt;li&gt;proxy: 代理控制，设置的值必选现在 uplinks 中定义。&lt;/li&gt;
&lt;li&gt;&lt;del&gt;proxy_access: proxy 的别称，已准备弃用。&lt;/del&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;常用的包名正则有：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;**         # 匹配任意包
@*/*       # 匹配任意 scope 包
@npmuser/* # 匹配 scope 为 npmuser 的包
npmuser-*  # 匹配包名有 npmuser- 前缀的包&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;包名正则规范通 gitignore 一致，verdaccio 内部使用&lt;code class=&quot;language-text&quot;&gt;minimatch&lt;/code&gt;实现的，如果需要书写更复杂的正则，可以参考 &lt;a href=&quot;https://www.npmjs.com/package/minimatch&quot;&gt;minimatch&lt;/a&gt; 文档。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;web: 前端展示页面控制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;title: 设置页面标题&lt;/li&gt;
&lt;li&gt;logo: 指定 logo 图片文件路径&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;publish: 发布包是的全局配置&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;allow_offline: 在外部仓储离线时是否允许发布。在发布包是 verdaccio 会检查依赖包有效性，这个过程中需要访问外部仓储。&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;url_prefix: 设置资源文件路径前缀。默认不需要设置，但如果使用 nginx 代理并改写了请求路径，就需要指定了。&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;listen: 设置服务运行地址端口，默认为 &lt;a href=&quot;http://localhost:4873&quot;&gt;http://localhost:4873&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;支持的配置有：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;localhost:4873            # default value
http://localhost:4873     # same thing
0.0.0.0:4873              # listen on all addresses (INADDR_ANY)
https://example.org:4873  # if you want to use https
[::1]:4873                # ipv6
unix:/tmp/verdaccio.sock    # unix socket&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;https: HTTPS 证书配置&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;key: path/to/server.key&lt;/li&gt;
&lt;li&gt;cert: path/to/server.crt&lt;/li&gt;
&lt;li&gt;ca: path/to/server.pem&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;log: 日志控制&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;type: file, stdout, stderr, 其中 stdout 需要同时指定 path&lt;/li&gt;
&lt;li&gt;level: trace | debug | info | http (default) | warn | error | fatal&lt;/li&gt;
&lt;li&gt;format: json | pretty | pretty-timestamped&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;http_proxy: 设置以 http 形式访问外部仓储时使用的代理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;https_proxy: 设置以 https 形式访问外部仓储时使用的代理&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;no_proxy: 不使用代理的请求路径&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;max&lt;em&gt;body&lt;/em&gt;size: 请求时上传的 json 允许的最大值&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;notify: 当有包发布成功时，verdaccio 会发送通知。通知实际上是一次 http 请求。支持配置多套通知&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;method: 请求方法 GET,POST 等 HTTP Method&lt;/li&gt;
&lt;li&gt;packagePattern: 包匹配正则， 这儿为 js 正则，仅当发布的包名匹配正则时才发送通知&lt;/li&gt;
&lt;li&gt;packagePatternFlags: js 正则标志位，如&lt;code class=&quot;language-text&quot;&gt;i&lt;/code&gt;忽略大小写&lt;/li&gt;
&lt;li&gt;headers: 自定义请求头&lt;/li&gt;
&lt;li&gt;endpoint: 请求地址&lt;/li&gt;
&lt;li&gt;content: handlebar 格式 html 模板，可以使用变量详见 &lt;a href=&quot;https://github.com/npm/registry/blob/master/docs/responses/package-metadata.md&quot;&gt;Package Metadata&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;演示&quot;&gt;&lt;a href=&quot;#%E6%BC%94%E7%A4%BA&quot; aria-label=&quot;演示 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;演示&lt;/h2&gt;
&lt;p&gt;我们先通过 verdaccio 熟悉一下 npm 包发布流程&lt;/p&gt;
&lt;h3 id=&quot;公开包&quot;&gt;&lt;a href=&quot;#%E5%85%AC%E5%BC%80%E5%8C%85&quot; aria-label=&quot;公开包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;公开包&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;项目初始化&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm init -f&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;编写包代码&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这个包只有一个 index.js 文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;module.exports = function () {
  return &amp;#39;verdaccio works&amp;#39;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;注册并登录仓储&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm adduser --registry  http://localhost:4873&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输入用户名，密码和邮箱创建用户&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;发布包&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm publish --registry http://localhost:4873&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷新页面可以看到我们提交的包出现了&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;测试安装&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install &amp;lt;package-name&amp;gt; --registry http://localhost:4873&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;成功，如果我们退出登录状态后再安装呢&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm logout --registry http://localhost:4873
npm install &amp;lt;package-name&amp;gt; --registry http://localhost:4873&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;也是成功的，这说明 verdaccio 提供的默认配置中所有发布的包都被公开，所有人（包括未登录用户）均可见。&lt;/p&gt;
&lt;h3 id=&quot;私有包&quot;&gt;&lt;a href=&quot;#%E7%A7%81%E6%9C%89%E5%8C%85&quot; aria-label=&quot;私有包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;私有包&lt;/h3&gt;
&lt;p&gt;现在配置&lt;code class=&quot;language-text&quot;&gt;org-&lt;/code&gt;前缀的包全部私有&lt;/p&gt;
&lt;p&gt;只需在配置文件 config.yml 中 package 段添加配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  &amp;#39;org-*&amp;#39;:
    access: $authenticated
    publish: $authenticated
    proxy: npmjs&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这里我们配置了所有&lt;code class=&quot;language-text&quot;&gt;org-&lt;/code&gt;前缀的包只有注册用户才能访问和发布。&lt;/p&gt;
&lt;p&gt;你也可以对 publish 做进一步限制，只有 npmuser 用户才能发布&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  &amp;#39;org-*&amp;#39;:
    access: $authenticated
    publish: npmuser
    proxy: npmjs&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;注意修改配置后要重启 verdaccio&lt;/p&gt;
&lt;h3 id=&quot;scope-包&quot;&gt;&lt;a href=&quot;#scope-%E5%8C%85&quot; aria-label=&quot;scope 包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;scope 包&lt;/h3&gt;
&lt;p&gt;其实加前缀并不是一种很好组织包的方式，npm 提供了更好的名称空间策略 scope&lt;/p&gt;
&lt;p&gt;scope 包包名格式：@scope-name/pkg-name&lt;/p&gt;
&lt;p&gt;初始化包时指定 scope&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm init --scope org&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们可以为 scope 绑定一个仓储&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm login --registry=http://reg.example.com --scope=@org
npm config set @org:registry http://reg.example.com&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样凡是碰到 scope 为 @org 的包，npm 将自动切换作业仓储到 scope 绑定的仓储，这提供了一种多仓储策略。&lt;/p&gt;
&lt;p&gt;scope 私有包配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  &amp;#39;@org/*&amp;#39;:
    access: $authenticated
    publish: $authenticated
    proxy: npmjs&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;使用 verdaccio，我们可以很容易就搭建一套私有 npm 仓储，并能灵活的进行访问控制。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[nginx 配置从入门到精通]]></title><description><![CDATA[nginx 可以作为静态文件服务器，可以伺服单页面应用，可以反向代理 API, 可以配置 https 等，任何一项功能都需要相应配置。如何配置合乎自己需要的 nginx 呢？]]></description><link>https://blog.sigoden.com/nginx-how-to-write-conf/</link><guid isPermaLink="false">https://blog.sigoden.com/nginx-how-to-write-conf/</guid><content:encoded>&lt;h2 id=&quot;概述&quot;&gt;&lt;a href=&quot;#%E6%A6%82%E8%BF%B0&quot; aria-label=&quot;概述 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;概述&lt;/h2&gt;
&lt;p&gt;nginx 是模块化的，多种多样的模块提供了各种各样的功能。模块会对外暴露一些配置的&lt;a href=&quot;http://nginx.org/en/docs/dirindex.html&quot;&gt;指令&lt;/a&gt; 和&lt;a href=&quot;http://nginx.org/en/docs/varindex.html&quot;&gt;变量&lt;/a&gt;。
一般的 nginx 发行版只包含部分模块，具体有那些可以运行&lt;code class=&quot;language-text&quot;&gt;nginx -V&lt;/code&gt;查看，如果使用了没有编译在 nginx 中的模块指令，nginx 将会报错，所以使用前请确保模块已编译。&lt;/p&gt;
&lt;h2 id=&quot;指令&quot;&gt;&lt;a href=&quot;#%E6%8C%87%E4%BB%A4&quot; aria-label=&quot;指令 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;指令&lt;/h2&gt;
&lt;p&gt;指令控制模块的行为，分为块指令（如&lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;stream&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;location&lt;/code&gt;）和普通指令（如 &lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;if&lt;/code&gt;）。&lt;/p&gt;
&lt;h2 id=&quot;块指令&quot;&gt;&lt;a href=&quot;#%E5%9D%97%E6%8C%87%E4%BB%A4&quot; aria-label=&quot;块指令 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;块指令&lt;/h2&gt;
&lt;p&gt;块指令语法：&lt;code class=&quot;language-text&quot;&gt;name { ... }&lt;/code&gt;; 花括号构成一个上下文，指令是有上下文限制的。如&lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;需要运行在&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;上下文中，&lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;需要运行在&lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;上下文中。指令的上下文官网文档上多有标注的，如&lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;的文档&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Syntax:	server_name name ...;
Default: server_name &amp;quot;&amp;quot;;
Context: server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;Context: server&lt;/code&gt;表示&lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;需要上下文&lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;
像&lt;code class=&quot;language-text&quot;&gt;events&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;http&lt;/code&gt;不被包含在任何&lt;code class=&quot;language-text&quot;&gt;{}&lt;/code&gt;中，这类指令的上下文为&lt;code class=&quot;language-text&quot;&gt;main&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;典型的 nginx 配置中块指令结构如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;...              #全局块

events {         #events 块
   ...
}

http {     #http 块
    ...    #http 全局块
    server {      #server 块
        ...       #server 全局块
        location [PATTERN] { #location 块
            ...
        }
        location [PATTERN] {
            ...
        }
    }
    server {
      ...
    }
    ...    #http 全局块
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;普通指令&quot;&gt;&lt;a href=&quot;#%E6%99%AE%E9%80%9A%E6%8C%87%E4%BB%A4&quot; aria-label=&quot;普通指令 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;普通指令&lt;/h3&gt;
&lt;p&gt;普通指令语法：&lt;code class=&quot;language-text&quot;&gt;name params [params];&lt;/code&gt;，参数间空格隔开，句尾分号必须。 如果参数为多行字符串，需要用引号（单双均可）包起来。例如&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;log_format compression &amp;#39;$remote_addr - $remote_user [$time_local] &amp;#39;
                       &amp;#39;&amp;quot;$request&amp;quot; $status $bytes_sent &amp;#39;
                       &amp;#39;&amp;quot;$http_referer&amp;quot; &amp;quot;$http_user_agent&amp;quot; &amp;quot;$gzip_ratio&amp;quot;&amp;#39;;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;普通指令也是有上下文的，使用时请注意。而且有些指令有默认值，有时候并不出现在配置中，但是并不表示它不起作用，如&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;，其默认值为&lt;code class=&quot;language-text&quot;&gt;listen *:80 | *:8000;&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;server&lt;/code&gt;块如果没有显示的配置&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;, 将默认监听端口 80。&lt;/p&gt;
&lt;h2 id=&quot;变量&quot;&gt;&lt;a href=&quot;#%E5%8F%98%E9%87%8F&quot; aria-label=&quot;变量 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;变量&lt;/h2&gt;
&lt;p&gt;nginx 变量由 $ 起头，采用下划线命名发，存储值。&lt;/p&gt;
&lt;p&gt;可以作为指令参数&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;fastcgi_param QUERY_STRING $query_string;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;也可以作为参数的一部分&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;fastcgi_param SCRIPT_FILENAME $document_root$fastcgi_script_name;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;调试变量&quot;&gt;&lt;a href=&quot;#%E8%B0%83%E8%AF%95%E5%8F%98%E9%87%8F&quot; aria-label=&quot;调试变量 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;调试变量&lt;/h3&gt;
&lt;p&gt;nginx 提供了很多变量，我们如何查看或调试这些变量呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;通过 return 返回变量值&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  location / {
     return 200 &amp;#39;request_uri: $request_uri
       query_string: $query_string&amp;#39;;
  }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;通过日志&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;log_format var &amp;#39;request_uri: $request_uri
       query_string: $query_string&amp;#39;;

  location / {
    access_log /path/to/var/access.log var;
    return 200;
  }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;通过自定义响应头&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  location / {
    add_header X-VAR-REQUEST-URI $request_uri;
    add_header X-VAR-QUERY-STRING $query_string;
  }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;自定义变量&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%8F%98%E9%87%8F&quot; aria-label=&quot;自定义变量 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自定义变量&lt;/h3&gt;
&lt;p&gt;指令&lt;code class=&quot;language-text&quot;&gt;set&lt;/code&gt;可以自定义变量&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Syntax:	set $variable value;
Default:	—
Context:	server, location, if&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;set $my_var &amp;quot;hello world&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但请注意，该功能是&lt;code class=&quot;language-text&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;模块提供的，并不通用。该模块还提供了&lt;code class=&quot;language-text&quot;&gt;if&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;break&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;等指令，这些指令让人觉得 nginx.conf 是一种程序脚本，这其实是错觉。它们仅仅是 nginx 指令而已。&lt;/p&gt;
&lt;h2 id=&quot;实战&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E6%88%98&quot; aria-label=&quot;实战 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实战&lt;/h2&gt;
&lt;p&gt;nginx 配置就是指令和变量的组合。如同知道词汇和语法还是很难写好文章，知道指令和变量还是不容易写出好的配置。写出一套好配置没什么技巧，只能多看多练了。&lt;/p&gt;
&lt;p&gt;下面举个例子说明如何一步一步配置 nginx&lt;/p&gt;
&lt;h3 id=&quot;案例介绍&quot;&gt;&lt;a href=&quot;#%E6%A1%88%E4%BE%8B%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;案例介绍 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;案例介绍&lt;/h3&gt;
&lt;h4 id=&quot;服务与资源&quot;&gt;&lt;a href=&quot;#%E6%9C%8D%E5%8A%A1%E4%B8%8E%E8%B5%84%E6%BA%90&quot; aria-label=&quot;服务与资源 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;服务与资源&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;官网主页的静态资源，存储在 /data/wwww 目录，由一堆 html,js,css,png 等资源文件组成，其中主页文件为 home.html。&lt;/li&gt;
&lt;li&gt;微信公众号页面是单页面，存储在 /data/wx 目录。&lt;/li&gt;
&lt;li&gt;微信后台运行于服务器 A: 10.0.12.1 和服务器 B: 10.0.12.2 的 3000 端口。&lt;/li&gt;
&lt;li&gt;域名 www.example.com 证书位于 /data/certs/www.example.com/{fullchain.pem, privkey.pem}&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;域名绑定&quot;&gt;&lt;a href=&quot;#%E5%9F%9F%E5%90%8D%E7%BB%91%E5%AE%9A&quot; aria-label=&quot;域名绑定 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;域名绑定&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;官网主页绑定 www.example.com，其中 example.com 也绑定主页&lt;/li&gt;
&lt;li&gt;微信公众号页面绑定 wx.example.com&lt;/li&gt;
&lt;li&gt;微信后台绑定 api.example.com&lt;/li&gt;
&lt;/ul&gt;
&lt;h4 id=&quot;要求&quot;&gt;&lt;a href=&quot;#%E8%A6%81%E6%B1%82&quot; aria-label=&quot;要求 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;要求&lt;/h4&gt;
&lt;ul&gt;
&lt;li&gt;访问域名能获取正常资源&lt;/li&gt;
&lt;li&gt;静态资源要进行压缩&lt;/li&gt;
&lt;li&gt;官网首页启用 https&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;配置过程&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE%E8%BF%87%E7%A8%8B&quot; aria-label=&quot;配置过程 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置过程&lt;/h3&gt;
&lt;h4 id=&quot;静态资源服务器&quot;&gt;&lt;a href=&quot;#%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1%E5%99%A8&quot; aria-label=&quot;静态资源服务器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;静态资源服务器&lt;/h4&gt;
&lt;p&gt;本例中使用 nginx 作为静态资源服务器和发现代理服务器，涉及到的功能全部与 http 相关，而 nginx 与 http 相关的模块是&lt;code class=&quot;language-text&quot;&gt;ngx_http_core_module&lt;/code&gt;。
同一个端口运行多个以域名作为区分的虚拟服务，查看&lt;code class=&quot;language-text&quot;&gt;ngx_http_core_module&lt;/code&gt;文档&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Syntax:	server { ... }
Default:	—
Context:	http
Sets configuration for a virtual server. There is no clear separation between IP-based (based on the IP address) and name-based (based on the “Host” request header field) virtual servers. Instead, the listen directives describe all addresses and ports that should accept connections for the server, and the server_name directive lists all server names. Example configurations are provided in the “How nginx processes a request” document.&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到&lt;code class=&quot;language-text&quot;&gt;Sets configuration for a virtual server&lt;/code&gt;这句，块指令 server 正是我们所需要的，
同时文档指出&lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;用来制定服务所绑定的域名，官网主页配置如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name www.example.com;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们需要告诉 nginx 当收到请求时去磁盘的哪个位置获取文件，指令&lt;code class=&quot;language-text&quot;&gt;root&lt;/code&gt;出场了&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name www.example.com;
  root /data/www;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置完成，&lt;code class=&quot;language-text&quot;&gt;nginx -t&lt;/code&gt;测试语法，没问题，&lt;code class=&quot;language-text&quot;&gt;nginx -s reload&lt;/code&gt;让配置生效。请求&lt;code class=&quot;language-text&quot;&gt;www.example.com/home.html&lt;/code&gt;发现可以正常工作，直接访问&lt;code class=&quot;language-text&quot;&gt;www.example.com&lt;/code&gt;则 403。
但是我们希望输入&lt;code class=&quot;language-text&quot;&gt;www.example.com&lt;/code&gt;就能获得首页，而不用多输入一段&lt;code class=&quot;language-text&quot;&gt;/home.html&lt;/code&gt;。&lt;/p&gt;
&lt;p&gt;查看&lt;code class=&quot;language-text&quot;&gt;ngx_http_core_module&lt;/code&gt;文档，发现没有相关功能的模块，可能是其它模块提供的功能，查找 http 以及首页 (index) 相关的模块，果然找到&lt;code class=&quot;language-text&quot;&gt;ngx_http_index_module&lt;/code&gt;，它只有一个指令 index&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name www.example.com;
  root /data/www;
  location / {
    index home.html index.html;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;刷新配置，请求&lt;code class=&quot;language-text&quot;&gt;www.example.com&lt;/code&gt;，正常
一个简单的静态资源服务器完成啦！!!&lt;/p&gt;
&lt;h4 id=&quot;https&quot;&gt;&lt;a href=&quot;#https&quot; aria-label=&quot;https permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;https&lt;/h4&gt;
&lt;p&gt;https 可以理解为&lt;code class=&quot;language-text&quot;&gt;http over ssl&lt;/code&gt;, 查找 http 以及 ssl 相关模块，找到&lt;code class=&quot;language-text&quot;&gt;ngx_http_ssl_module&lt;/code&gt;
文档中就给出了具体的配置示例&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;worker_processes auto;

http {

    ...

    server {
        listen              443 ssl;
        keepalive_timeout   70;

        ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
        ssl_certificate     /usr/local/nginx/conf/cert.pem;
        ssl_certificate_key /usr/local/nginx/conf/cert.key;
        ssl_session_cache   shared:SSL:10m;
        ssl_session_timeout 10m;

        ...
    }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们可以参照这些配置，配置 https 版的 www.example.com&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  listen              443 ssl;
  keepalive_timeout   70;

  ssl_protocols       TLSv1 TLSv1.1 TLSv1.2;
  ssl_ciphers         AES128-SHA:AES256-SHA:RC4-SHA:DES-CBC3-SHA:RC4-MD5;
  ssl_certificate     /data/certs/www.example.com/fullchain.pem;
  ssl_certificate_key /data/certs/www.example.com/privkey.pem;
  ssl_session_cache   shared:SSL:10m;
  ssl_session_timeout 10m;

  server_name         www.example.com;
  root /data/www;
  location / {
    index home.html index.html;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;跳转301&quot;&gt;&lt;a href=&quot;#%E8%B7%B3%E8%BD%AC301&quot; aria-label=&quot;跳转301 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;跳转301&lt;/h4&gt;
&lt;p&gt;example.com 和 www.example.com 同时绑定一个服务，我们可以通过&lt;code class=&quot;language-text&quot;&gt;server_name&lt;/code&gt;多参数实现&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server_name example.com www.example.com;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;但是这样不利于统计分析（通一页面重复统计两次等），更好的做法是进行 301 跳转。
处理这类需求的模块是&lt;code class=&quot;language-text&quot;&gt;ngx_http_rewrite_module&lt;/code&gt;, 指令&lt;code class=&quot;language-text&quot;&gt;rewrite&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;都满足需求，选那个呢？&lt;/p&gt;
&lt;p&gt;这里选择&lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;，因为&lt;code class=&quot;language-text&quot;&gt;rewrite&lt;/code&gt;要进行正则匹配，性能上逊色于&lt;code class=&quot;language-text&quot;&gt;return&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name example.com;
  return 301 https://www.example.com;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;单页面&quot;&gt;&lt;a href=&quot;#%E5%8D%95%E9%A1%B5%E9%9D%A2&quot; aria-label=&quot;单页面 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;单页面&lt;/h4&gt;
&lt;p&gt;单页面也是静态资源，其特殊之处在于路由是被一个页面接管的。&lt;code class=&quot;language-text&quot;&gt;wx.example.com&lt;/code&gt;请求是的首页，&lt;code class=&quot;language-text&quot;&gt;wx.example.com/user&lt;/code&gt;也请求的是首页，首页里的 js 会根据路径自己渲染合适的页面。&lt;/p&gt;
&lt;p&gt;如果像之前&lt;code class=&quot;language-text&quot;&gt;www.example.com&lt;/code&gt;那样配置，用户在单页面里刷新浏览器就 404 了，因为 nginx 根据路径查找文件却找不到。&lt;/p&gt;
&lt;p&gt;所有请求都返回首页也不对，有些 css，js 需要正确返回文件。而且单页面也不是一个其它页面也没有了，我可能有一个帮助页面&lt;code class=&quot;language-text&quot;&gt;help.html&lt;/code&gt;不是用单页面开发的，但也要正确加载啊。
我们期望 nginx 先按路径查找文件，找到了，返回找到的。找不到，很有可能是单页面的路由，返回单页面首页。&lt;/p&gt;
&lt;p&gt;很幸运，nginx 提供了指令&lt;code class=&quot;language-text&quot;&gt;try_files&lt;/code&gt;处理这种情况&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name wx.example.com;
  root /data/wx;
  location / {
    try_files $uri $uri/ /index.html;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;压缩&quot;&gt;&lt;a href=&quot;#%E5%8E%8B%E7%BC%A9&quot; aria-label=&quot;压缩 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;压缩&lt;/h4&gt;
&lt;p&gt;为了减小带宽，一些静态资源一般需要压缩后传送。linux 世界有一款常用的压缩软件&lt;code class=&quot;language-text&quot;&gt;gzip&lt;/code&gt;, nginx 也提供了类似的模块&lt;code class=&quot;language-text&quot;&gt;ngx_http_gzip_module&lt;/code&gt;
由于不管是&lt;code class=&quot;language-text&quot;&gt;www.example.com&lt;/code&gt;还是&lt;code class=&quot;language-text&quot;&gt;wx.example.com&lt;/code&gt;都有静态资源，都需要压缩，所以可以直接配置在 http 块下，结合文档配置如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;gzip            on;
gzip_min_length 1000;
gzip_proxied    expired no-cache no-store private auth;
gzip_types      text/plain text/css application/json application/x-javascript text/xml application/xml application/xml+rss text/javascript;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;根据静态资源类型调整&lt;code class=&quot;language-text&quot;&gt;gzip_types&lt;/code&gt;指令的参数&lt;/p&gt;
&lt;h4 id=&quot;反向代理&quot;&gt;&lt;a href=&quot;#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86&quot; aria-label=&quot;反向代理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;反向代理&lt;/h4&gt;
&lt;p&gt;前面均是用 nginx 作为静态资源服务器，配置&lt;code class=&quot;language-text&quot;&gt;api.example.com&lt;/code&gt;则需要用到 nginx 的反向代理功能了。
与代理相关的模块是&lt;code class=&quot;language-text&quot;&gt;ngx_http_proxy_module&lt;/code&gt;，根据文档中的例子，得出如下配置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;server {
  server_name api.example.com;
  location / {
    proxy_pass       http://10.0.12.1:3000;
    proxy_set_header Host      $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;测试发现，已经可以正常工作了。但是我们的后台服务器有两台，难道要 proxy_pass 两次&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;  location / {
    proxy_pass       http://10.0.12.1:3000;
    proxy_pass       http://10.0.12.2:3000;
  }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可惜 nginx 不支持。
还是看文档，发现多次提到&lt;code class=&quot;language-text&quot;&gt;upstream&lt;/code&gt;的概念。查找&lt;code class=&quot;language-text&quot;&gt;ngx_http_upstream_module&lt;/code&gt;，发现正式我们需要的&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;upstream api {
  server 10.0.12.1:3000;
  server 10.0.12.2:3000;
}

server {
  server_name api.example.com;
  location / {
    proxy_pass       http://api;
    proxy_set_header Host      $host;
    proxy_set_header X-Real-IP $remote_addr;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;小结&quot;&gt;&lt;a href=&quot;#%E5%B0%8F%E7%BB%93&quot; aria-label=&quot;小结 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;小结&lt;/h3&gt;
&lt;p&gt;案例到这儿就分析完了，思路就是根据需求，找到可能提供这个需求的模块。例如需要权限控制，有模块&lt;code class=&quot;language-text&quot;&gt;ngx_http_auth_basic_module&lt;/code&gt;；需要限制流量，找模块&lt;code class=&quot;language-text&quot;&gt;ngx_http_limit_req_module&lt;/code&gt;。
进入模块文档，一般复杂一点的模块都会提供一些配置范例，可以多参考。然后查找相关指令，编写配置，测试。&lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;到这儿大家应该对 nginx 配置有了一个直观的认知和清晰的构造思路。有时间多分析，多练习。完成功能只是起步，nginx 中有大量的指令是用来性能调优，安全强化的，配置时也请多注意。
模块提供了&lt;/p&gt;</content:encoded></item><item><title><![CDATA[开发安全的 API 所需要核对的清单]]></title><description><![CDATA[当你在设计，测试以及发布你的 API 的时候所需要核对那些重要安全措施呢？]]></description><link>https://blog.sigoden.com/api-security-checklist/</link><guid isPermaLink="false">https://blog.sigoden.com/api-security-checklist/</guid><content:encoded>&lt;h2 id=&quot;身份认证&quot;&gt;&lt;a href=&quot;#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81&quot; aria-label=&quot;身份认证 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;身份认证&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要使用 &lt;code class=&quot;language-text&quot;&gt;Basic Auth&lt;/code&gt; 使用标准的认证协议 (如 JWT, OAuth).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要再造 &lt;code class=&quot;language-text&quot;&gt;Authentication&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;token generating&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;password storing&lt;/code&gt; 这些轮子, 使用标准的.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在登录中使用 &lt;code class=&quot;language-text&quot;&gt;Max Retry&lt;/code&gt; 和自动封禁功能.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 加密所有的敏感数据.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;jwt-json-web-token&quot;&gt;&lt;a href=&quot;#jwt-json-web-token&quot; aria-label=&quot;jwt json web token permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;JWT (JSON Web Token)&lt;/h3&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用随机复杂的密钥 (&lt;code class=&quot;language-text&quot;&gt;JWT Secret&lt;/code&gt;) 以增加暴力破解的难度.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要在请求体中直接提取数据, 要对数据进行加密 (&lt;code class=&quot;language-text&quot;&gt;HS256&lt;/code&gt; 或 &lt;code class=&quot;language-text&quot;&gt;RS256&lt;/code&gt;).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使 token 的过期时间尽量的短 (&lt;code class=&quot;language-text&quot;&gt;TTL&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;RTTL&lt;/code&gt;).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要在 JWT 的请求体中存放敏感数据, 它是&lt;a href=&quot;https://jwt.io/#debugger-io&quot;&gt;可破解的&lt;/a&gt;.&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;oauth-授权或认证协议&quot;&gt;&lt;a href=&quot;#oauth-%E6%8E%88%E6%9D%83%E6%88%96%E8%AE%A4%E8%AF%81%E5%8D%8F%E8%AE%AE&quot; aria-label=&quot;oauth 授权或认证协议 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;OAuth 授权或认证协议&lt;/h3&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 始终在后台验证 &lt;code class=&quot;language-text&quot;&gt;redirect_uri&lt;/code&gt;, 只允许白名单的 URL.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 每次交换令牌的时候不要加 token (不允许 &lt;code class=&quot;language-text&quot;&gt;response_type=token&lt;/code&gt;).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用 &lt;code class=&quot;language-text&quot;&gt;state&lt;/code&gt; 参数并填充随机的哈希数来防止跨站请求伪造(CSRF).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 对不同的应用分别定义默认的作用域和各自有效的作用域参数.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;访问&quot;&gt;&lt;a href=&quot;#%E8%AE%BF%E9%97%AE&quot; aria-label=&quot;访问 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;访问&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 限制流量来防止 DDoS 攻击和暴力攻击.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在服务端使用 HTTPS 协议来防止 MITM 攻击.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用 &lt;code class=&quot;language-text&quot;&gt;HSTS&lt;/code&gt; 协议防止 SSLStrip 攻击.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;输入&quot;&gt;&lt;a href=&quot;#%E8%BE%93%E5%85%A5&quot; aria-label=&quot;输入 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;输入&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用与操作相符的 HTTP 操作函数, &lt;code class=&quot;language-text&quot;&gt;GET (读取)&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;POST (创建)&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;PUT (替换/更新)&lt;/code&gt; 以及 &lt;code class=&quot;language-text&quot;&gt;DELETE (删除记录)&lt;/code&gt;, 如果请求的方法不适用于请求的资源则返回 &lt;code class=&quot;language-text&quot;&gt;405 Method Not Allowed&lt;/code&gt;.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在请求头中的 &lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt; 字段使用内容验证来只允许支持的格式 (如 &lt;code class=&quot;language-text&quot;&gt;application/xml&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;application/json&lt;/code&gt; 等等) 并在不满足条件的时候返回 &lt;code class=&quot;language-text&quot;&gt;406 Not Acceptable&lt;/code&gt;.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 验证 &lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt; 的发布数据和你收到的一样 (如 &lt;code class=&quot;language-text&quot;&gt;application/x-www-form-urlencoded&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;multipart/form-data&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;application/json&lt;/code&gt; 等等).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 验证用户输入来避免一些普通的易受攻击缺陷 (如 &lt;code class=&quot;language-text&quot;&gt;XSS&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;SQL-注入&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;远程代码执行&lt;/code&gt; 等等).&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要在 URL 中使用任何敏感的数据 (&lt;code class=&quot;language-text&quot;&gt;credentials&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Passwords&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;security tokens&lt;/code&gt;, or &lt;code class=&quot;language-text&quot;&gt;API keys&lt;/code&gt;), 而是使用标准的认证请求头.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用一个 API Gateway 服务来启用缓存、访问速率限制 (如 &lt;code class=&quot;language-text&quot;&gt;Quota&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Spike Arrest&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Concurrent Rate Limit&lt;/code&gt;) 以及动态地部署 APIs resources.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;处理&quot;&gt;&lt;a href=&quot;#%E5%A4%84%E7%90%86&quot; aria-label=&quot;处理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;处理&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 检查是否所有的终端都在身份认证之后, 以避免被破坏了的认证体系.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 避免使用特有的资源 id. 使用 &lt;code class=&quot;language-text&quot;&gt;/me/orders&lt;/code&gt; 替代 &lt;code class=&quot;language-text&quot;&gt;/user/654321/orders&lt;/code&gt;&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用 &lt;code class=&quot;language-text&quot;&gt;UUID&lt;/code&gt; 代替自增长的 id.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 如果需要解析 XML 文件, 确保实体解析(entity parsing)是关闭的以避免 &lt;code class=&quot;language-text&quot;&gt;XXE&lt;/code&gt; 攻击.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 如果需要解析 XML 文件, 确保实体扩展(entity expansion)是关闭的以避免通过指数实体扩展攻击实现的 &lt;code class=&quot;language-text&quot;&gt;Billion Laughs/XML bomb&lt;/code&gt;.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在文件上传中使用 CDN.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 如果需要处理大量的数据, 使用 Workers 和 Queues 来快速响应, 从而避免 HTTP 阻塞.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要忘了把 DEBUG 模式关掉.&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;输出&quot;&gt;&lt;a href=&quot;#%E8%BE%93%E5%87%BA&quot; aria-label=&quot;输出 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;输出&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 发送 &lt;code class=&quot;language-text&quot;&gt;X-Content-Type-Options: nosniff&lt;/code&gt; 头.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 发送 &lt;code class=&quot;language-text&quot;&gt;X-Frame-Options: deny&lt;/code&gt; 头.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 发送 &lt;code class=&quot;language-text&quot;&gt;Content-Security-Policy: default-src &amp;#39;none&amp;#39;&lt;/code&gt; 头.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 删除指纹头 - &lt;code class=&quot;language-text&quot;&gt;X-Powered-By&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Server&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;X-AspNet-Version&lt;/code&gt; 等等.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在响应中强制使用 &lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt;, 如果你的类型是 &lt;code class=&quot;language-text&quot;&gt;application/json&lt;/code&gt; 那么你的 &lt;code class=&quot;language-text&quot;&gt;content-type&lt;/code&gt; 就是 &lt;code class=&quot;language-text&quot;&gt;application/json&lt;/code&gt;.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 不要返回敏感的数据, 如 &lt;code class=&quot;language-text&quot;&gt;credentials&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;Passwords&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;security tokens&lt;/code&gt;.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在操作结束时返回恰当的状态码. (如 &lt;code class=&quot;language-text&quot;&gt;200 OK&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;400 Bad Request&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;401 Unauthorized&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;405 Method Not Allowed&lt;/code&gt; 等等).&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;持续集成和持续部署&quot;&gt;&lt;a href=&quot;#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%92%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2&quot; aria-label=&quot;持续集成和持续部署 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;持续集成和持续部署&lt;/h2&gt;
&lt;ul&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 使用单元测试和集成测试来审计你的设计和实现.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 引入代码审查流程, 不要自行批准更改.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 在推送到生产环境之前确保服务的所有组件都用杀毒软件静态地扫描过, 包括第三方库和其它依赖.&lt;/li&gt;
&lt;li class=&quot;task-list-item&quot;&gt;&lt;input type=&quot;checkbox&quot; disabled&gt; 为部署设计一个回滚方案.&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[使用 webhook 自动部署]]></title><description><![CDATA[如何有一种机制，直接克隆提交到仓储的代码，进行测试并部署，生活将方便很多。这种机制是存在的，名为 webhook。]]></description><link>https://blog.sigoden.com/webhook-deploy/</link><guid isPermaLink="false">https://blog.sigoden.com/webhook-deploy/</guid><content:encoded>&lt;h2 id=&quot;webhook-介绍&quot;&gt;&lt;a href=&quot;#webhook-%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;webhook 介绍 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;WEBHOOK 介绍&lt;/h2&gt;
&lt;p&gt;Webhook 允许第三方应用监听 WEB 服务中的特定事件，在这些事件发生时通过 HTTP POST 方式通知 ( 超时 5 秒） 到第三方应用指定的 Web URL。 例如项目有新的内容 Push，或是 Merge Request 有更新等。 WebHook 可方便用户实现自动部署，自动测试，自动打包，监控项目变化等。 且最近已被广泛使用。各大 git 服务 github,gitlab,bitbucket, 以及 ci 服务 circle, jenkins 等均提供了 webhook 接口, 可以利用它将一些作业自动化。&lt;/p&gt;
&lt;p&gt;下面介绍如何做到 git push 一下，线上代码自动更新了。 &lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/47fc09a39305721082079b02c25051c7/16bf3/webhook-deploy-howto-03.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 598px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 26.254180602006688%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAbElEQVQY073PywqAIBCFYU2oCCuKblBBtalF7/98/cEJXLRpk/CBOONxNOanFWNEDhucR6hxYkYa1MM+U2DFgQ4ZWniF3rVN+1I9Xibs6ndPoNdECxokKjqFTKpn0mPQhIMerMLAL8vq66+XL3CcA24x4QE0AAAAAElFTkSuQmCC&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;webhook 流程&quot;
        title=&quot;&quot;
        src=&quot;/static/47fc09a39305721082079b02c25051c7/16bf3/webhook-deploy-howto-03.png&quot;
        srcset=&quot;/static/47fc09a39305721082079b02c25051c7/a3b1f/webhook-deploy-howto-03.png 197w,
/static/47fc09a39305721082079b02c25051c7/07137/webhook-deploy-howto-03.png 393w,
/static/47fc09a39305721082079b02c25051c7/16bf3/webhook-deploy-howto-03.png 598w&quot;
        sizes=&quot;(max-width: 598px) 100vw, 598px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2 id=&quot;发送方配置&quot;&gt;&lt;a href=&quot;#%E5%8F%91%E9%80%81%E6%96%B9%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;发送方配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;发送方配置&lt;/h2&gt;
&lt;p&gt;webhook 的发送方配置无非是设置第三方 Web URL， 选择触发动作的事件，有些允许设置秘钥以确保数据安全性和完整性。下面已 Github 进行举例&lt;/p&gt;
&lt;p&gt;Settings &gt; Webhooks &gt; Add webhook 下添加一条记录

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/2bc125b498616e1d15eefb48f02ca607/77df2/webhook-deploy-howto-01.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 36.70309653916211%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAYAAAAIy204AAAACXBIWXMAAAsSAAALEgHS3X78AAAA+ElEQVQoz52Q226EMAxE+f9f7FPZrnKBhUASnCtTJ1CpfaraSEeOo3hsz3BQhFoJYg14nwjjTHgwnhJiSgixxYwQIgIRduvwFArOE16r6XmL/iCkXDCknHvijwCze7gjYjGWC46OdR7EYs7uMPoJt28wm72axLspC6WbIZeK1SW0eJ5nZ9s2aD31z7+dUitmKeGt7XkXFIa75ZPTS1CqCePjA4I/Kq07Qkh+VxdSQSl+57uaX3i+jUhSX4IpEHsydc9KvQQdZSReKecvyrf7T0qjjbIsYKObhwVyIV6bp0wVlVf41+G6s7CHlSfysfbp2sr19vHP3LqfEkgh4cSuZboAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;github 配置 webhook 01&quot;
        title=&quot;&quot;
        src=&quot;/static/2bc125b498616e1d15eefb48f02ca607/73d01/webhook-deploy-howto-01.png&quot;
        srcset=&quot;/static/2bc125b498616e1d15eefb48f02ca607/a3b1f/webhook-deploy-howto-01.png 197w,
/static/2bc125b498616e1d15eefb48f02ca607/07137/webhook-deploy-howto-01.png 393w,
/static/2bc125b498616e1d15eefb48f02ca607/73d01/webhook-deploy-howto-01.png 786w,
/static/2bc125b498616e1d15eefb48f02ca607/77df2/webhook-deploy-howto-01.png 1098w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/62226f5944f603be6a48fbb7131b0789/fae55/webhook-deploy-howto-02.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 70.39413382218149%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAOCAYAAAAvxDzwAAAACXBIWXMAAAsSAAALEgHS3X78AAABrklEQVQ4y4VTSW7jQAz0//+Sa4Acc80xDwgGRuyxdnVLvamXGpLyoiSOp4EC2xRZLLLpnZo9jr3DvrH4U6/47CzCEuHDckaEtRae0HY9/lYNZmPRtD0msm0/StwSE3Z8sc7BOU9JTjDqiRLIKi2J1gdMQw/dnmBmA0OxMSUh2CIyofEJ2iWUUgQ5Zyg9o+sHVHUDPRk4KipYEpxfpIDAMbzYlDL47LRNOKmETGTEKB+qVuFYDzgQumFETxhHJRjo3nWD+Bgt3Wfrr4J2Wo2oybnETOpWhU2vyKcokOZCs4wxUqEkxfj7F5yJboQm4NA5sNJICezsh4EG3lLrWhQNpIzV8Dx5Tkz0/VwJI6nyS2HX1ckveapqSebfrJAtx3wnEGwJbwG3QFbGra5trWPYPlo5B198XxRuK90IJ3rNQLsVZKUYhtbJeX9u+QHhtoWL5XnVTYuGwHs5G4OZ9o8J77X8X0JO1PNEi61+PMAl7tdHuUeYeNFdQbCBFntCkL9VlFZLuY/8iPD18w1PHy/Y6yNKXBV7739V91BhLhlv7TueD684mOpHsXwPebV8/gFmEEfTOgGBmQAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;github 配置 webhook 02&quot;
        title=&quot;&quot;
        src=&quot;/static/62226f5944f603be6a48fbb7131b0789/73d01/webhook-deploy-howto-02.png&quot;
        srcset=&quot;/static/62226f5944f603be6a48fbb7131b0789/a3b1f/webhook-deploy-howto-02.png 197w,
/static/62226f5944f603be6a48fbb7131b0789/07137/webhook-deploy-howto-02.png 393w,
/static/62226f5944f603be6a48fbb7131b0789/73d01/webhook-deploy-howto-02.png 786w,
/static/62226f5944f603be6a48fbb7131b0789/fae55/webhook-deploy-howto-02.png 1091w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Payload URL: 当事件发生时 github 将向该地址以 HTTP POST 的方式发送数据&lt;/li&gt;
&lt;li&gt;Content-Type: POST 数据格式，可以为 JSON 或者 x-www-form-urlencoded&lt;/li&gt;
&lt;li&gt;Secret: 安全秘钥，github 使用 SHA-256 算法和此秘钥对需要发送的数据进行加密，生成加密串填充到 X-Hub-Signature HTTP 头中，发送给 Payload URL。&lt;/li&gt;
&lt;li&gt;Active: 是否启用&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;接收方配置&quot;&gt;&lt;a href=&quot;#%E6%8E%A5%E6%94%B6%E6%96%B9%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;接收方配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;接收方配置&lt;/h2&gt;
&lt;p&gt;Webhook 需要一个发送方和一个接收方。我们需要一个 Web Server 对推送来的 webhook 进行处理解析。自己实现一个也并不麻烦，但我们生存在一个开源的世界，有的是轮子供我们选择，下面我们将使用 &lt;a href=&quot;https://www.npmjs.com/package/webhook-cli&quot;&gt;webhook-cli&lt;/a&gt;&lt;/p&gt;
&lt;h3 id=&quot;安装&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85&quot; aria-label=&quot;安装 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;bash&quot;&gt;&lt;pre class=&quot;language-bash&quot;&gt;&lt;code class=&quot;language-bash&quot;&gt;&lt;span class=&quot;token function&quot;&gt;npm&lt;/span&gt; i -g webhook-cli&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;配置-hooksjson&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE-hooksjson&quot; aria-label=&quot;配置 hooksjson permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置 hooks.json&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;language-json&quot;&gt;&lt;code class=&quot;language-json&quot;&gt;&lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;id&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;webhook-deploy-howto&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;execute-command&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;/tmp/webhook-deploy-howto/auto.sh&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;include-command-output-in-response&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token boolean&quot;&gt;true&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
    &lt;span class=&quot;token property&quot;&gt;&quot;trigger-rule&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
      &lt;span class=&quot;token property&quot;&gt;&quot;and&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;[&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;match&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;payload-hash-sha1&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;secret&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;mysecret&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;parameter&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;header&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;X-Hub-Signature&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
          &lt;span class=&quot;token property&quot;&gt;&quot;match&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;type&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;value&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;refs/heads/master&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
            &lt;span class=&quot;token property&quot;&gt;&quot;parameter&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;{&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;source&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;payload&quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot;&gt;,&lt;/span&gt;
              &lt;span class=&quot;token property&quot;&gt;&quot;name&quot;&lt;/span&gt;&lt;span class=&quot;token operator&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;token string&quot;&gt;&quot;ref&quot;&lt;/span&gt;
            &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
          &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
        &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
      &lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;token punctuation&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;token punctuation&quot;&gt;]&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;id: 监听 webhook 事件名，与 Payload URL 对应&lt;/li&gt;
&lt;li&gt;execute-command: 当 webhook 触发并校验通过后，执行的脚本路径&lt;/li&gt;
&lt;li&gt;trigger-rule: 对 webhook 进行校验，上例对签名和提交的分支进行的校验，其中 secret 值与 github 的 Secret 文本框中填写的值对应&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;运行&quot;&gt;&lt;a href=&quot;#%E8%BF%90%E8%A1%8C&quot; aria-label=&quot;运行 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;运行&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;webhook-cli --hooks hooks.json --verbose&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;服务启动后，将监听&lt;code class=&quot;language-text&quot;&gt;0.0.0.0:9000&lt;/code&gt;, 并处理 POST 到 /hooks/webhook-deploy-howto 的请求&lt;/p&gt;
&lt;p&gt;这样当进行了一次 git 提交，git 会向我们&lt;code class=&quot;language-text&quot;&gt;server:9000/hooks/webhook-deploy-howto&lt;/code&gt;发送一条 HTTP POST 请求，webhook-cli 接受到请求后，对数据进行有效性验证。&lt;/p&gt;
&lt;p&gt;如果请求合法，则会运行&lt;code class=&quot;language-text&quot;&gt;/tmp/webhook-deploy-howto/auto.sh&lt;/code&gt;，我们可以在该脚本中拉取最新的代码，运行测试，将代码更新到正式服务器等，完成整个自动化流程。&lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;webhook 是一种事件模型，我们在在发送方注册事件，在接收方处理事件。这种方式使我们能够安全灵活的使用各种独立的服务完成各种复杂任务。可以自动测试，自动部署，也可以发送短信，邮件... 更多玩法还是自己去钻研吧&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Redis 延时推送消息]]></title><description><![CDATA[常常碰到这样的需求：预约前一个小时向短信通知用户不要错过消费，订单超过 24 小时而没有进一步操作自动取消。可以通过 Redis 的键空间通知实现类似需求。]]></description><link>https://blog.sigoden.com/redisyan-shi-tui-song-xiao-xi/</link><guid isPermaLink="false">https://blog.sigoden.com/redisyan-shi-tui-song-xiao-xi/</guid><content:encoded>&lt;h2 id=&quot;介绍&quot;&gt;&lt;a href=&quot;#%E4%BB%8B%E7%BB%8D&quot; aria-label=&quot;介绍 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;介绍&lt;/h2&gt;
&lt;p&gt;键空间通知使得客户端可以通过订阅频道或模式， 来接收那些以某种方式改动 了 Redis 数据集的事件。
比如说，对 0 号数据库的键 mykey 过期时，系统将分发两条消息， 相当于执行以下两个 PUBLISH 命令：&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;PUBLISH __keyspace@0__:mykey expired
PUBLISH __keyevent@0__:expired mykey&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;订阅第一个频道&lt;code class=&quot;language-text&quot;&gt;__keyspace@0__:mykey&lt;/code&gt; 可以接收 0 号数据库中所有修改键 mykey 的事件， 而订阅第二个频道 &lt;code class=&quot;language-text&quot;&gt;__keyevent@0__:expired&lt;/code&gt;则可以接收 0 号数据库中所有执行 expired 命令的键。 以 keyspace 为前缀的频道被称为键空间通知（key-space notification）， 而以 keyevent 为前缀的频道则被称为键事件通知（key-event notification）。&lt;/p&gt;
&lt;h2 id=&quot;配置&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置&lt;/h2&gt;
&lt;p&gt;因为开启键空间通知功能需要消耗一些 CPU ，所以在默认配置下， 该功能处于关闭状态。可以通过修改 redis.conf 文件，或者直接使用 CONFIG SET 命令来开启或关闭键空间通知功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当 notify-keyspace-events 选项的参数为空字符串时，功能关闭。&lt;/li&gt;
&lt;li&gt;另一方面，当参数不是空字符串时，功能开启。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;notify-keyspace-events 字符选项&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;K: 键空间通知，所有通知以 &lt;strong&gt;keyspace@&lt;db&gt;&lt;/strong&gt; 为前缀&lt;/li&gt;
&lt;li&gt;E: 键事件通知，所有通知以 &lt;strong&gt;keyevent@&lt;db&gt;&lt;/strong&gt; 为前缀&lt;/li&gt;
&lt;li&gt;g: DEL 、 EXPIRE 、 RENAME 等类型无关的通用命令的通知&lt;/li&gt;
&lt;li&gt;$: 字符串命令的通知&lt;/li&gt;
&lt;li&gt;l: 列表命令的通知&lt;/li&gt;
&lt;li&gt;s: 集合命令的通知&lt;/li&gt;
&lt;li&gt;h: 哈希命令的通知&lt;/li&gt;
&lt;li&gt;z: 有序集合命令的通知&lt;/li&gt;
&lt;li&gt;x: 过期事件：每当有过期键被删除时发送&lt;/li&gt;
&lt;li&gt;e: 驱逐 (evict) 事件：每当有键因为 maxmemory 政策而被删除时发送&lt;/li&gt;
&lt;li&gt;A: 参数 g$lshzxe 的别名&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;输入的参数中至少要有一个 K 或者 E ， 否则的话， 不管其余的参数是什么， 都不会有任何通知被分发。举个例子， 如果只想订阅键空间中和字符串过期的通知， 那么参数就应该设为 K$e ， 诸如此类。将参数设为字符串 &quot;AKE&quot; 表示发送所有类型的通知。&lt;/p&gt;
&lt;h2 id=&quot;注意&quot;&gt;&lt;a href=&quot;#%E6%B3%A8%E6%84%8F&quot; aria-label=&quot;注意 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;注意&lt;/h2&gt;
&lt;p&gt;Redis 使用以下两种方式删除过期的键：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;当一个键被访问时，程序会对这个键进行检查，如果键已经过期，那么该键将被删除。底层系统会在后台渐进地查找并删除那些过期的键，从而处理那些已经过期、但是不会被访问到的键。&lt;/li&gt;
&lt;li&gt;当过期键被以上两个程序的任意一个发现、 并且将键从数据库中删除时， Redis 会产生一个 expired 通知。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;Redis 并不保证生存时间（TTL）变为 0 的键会立即被删除：如果程序没有访问这个过期键， 或者带有生存时间的键非常多的话，那么在键的生存时间变为 0 ， 直到键真正被删除这中间，可能会有一段比较显著的时间间隔。&lt;/p&gt;
&lt;p&gt;因此，Redis 产生 expired 通知的时间为过期键被删除的时候，而不是键的生存时间变为 0 的时候。如果 Redis 正确配置且负载合理的，延时不会超超过 1s。&lt;/p&gt;
&lt;p&gt;此外，因为 Redis 目前的订阅与发布功能采取的是发送即忘（fire and forget）策略，所以如果你的程序需要可靠事件通知（reliable notification of events），那么目前的键空间通知可能并不适合你： 当订阅事件的客户端断线时，它会丢失所有在断线期间分发给它的事件。针对这个问题，可以开启多个客户端连接来提高可靠性，因为 Redis 会通知所有订阅了的客户端。&lt;/p&gt;
&lt;h2 id=&quot;实现&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E7%8E%B0&quot; aria-label=&quot;实现 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实现&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var Redis = require(&amp;#39;ioredis&amp;#39;);
var redis = new Redis();

// 订阅 subscribe: 订阅具体键名，支持一次可以订阅多个
redis.subscribe(&amp;#39;__keyspace@0__:mykey1&amp;#39;, &amp;#39;__keyspace@0__:mykey2&amp;#39;, function (err, count) {})

// 模式匹配订阅 psubscribe: 匹配模式订阅
redis.psubscribe(&amp;#39;__keyspace@*:order*&amp;#39;, function (err, count) {});

// 普通订阅通知处理
redis.on(&amp;#39;message&amp;#39;, function (channel, message) {
  console.log(&amp;#39;Receive message %s from channel %s&amp;#39;, message, channel);
});

// 模式匹配订阅通知处理
redis.on(&amp;#39;pmessage&amp;#39;, function (channel, key, message) {
  console.log(&amp;#39;Receive pmessage %s on key %s from channel %s&amp;#39;, message, key, channel);
});&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;测试&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95&quot; aria-label=&quot;测试 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;redis-cli config set notify-keyspace-events AKE
redis-cli
&amp;gt; setex mykey1 1 0
&amp;gt; setex mykey2 1 0
&amp;gt; setex order:123456 1 0
&amp;gt; setex order:123457 1 0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Receive message set from channel __keyspace@0__:mykey1
Receive message expire from channel __keyspace@0__:mykey1
Receive message expired from channel __keyspace@0__:mykey1
Receive message set from channel __keyspace@0__:mykey2
Receive message expire from channel __keyspace@0__:mykey2
Receive message expired from channel __keyspace@0__:mykey2
Receive pmessage set on key __keyspace@0__:order:123456 from channel __keyspace@*:order*
Receive pmessage expire on key __keyspace@0__:order:123456 from channel __keyspace@*:order*
Receive pmessage expired on key __keyspace@0__:order:123456 from channel __keyspace@*:order*
Receive pmessage set on key __keyspace@0__:order:123457 from channel __keyspace@*:order*
Receive pmessage expire on key __keyspace@0__:order:123457 from channel __keyspace@*:order*
Receive pmessage expired on key __keyspace@0__:order:123457 from channel __keyspace@*:order*&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;多实例&quot;&gt;&lt;a href=&quot;#%E5%A4%9A%E5%AE%9E%E4%BE%8B&quot; aria-label=&quot;多实例 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;多实例&lt;/h2&gt;
&lt;p&gt;单个实例可能断线，致使错过了接收延时消息。我们可以通过多实例尽可能的提高可靠性。&lt;/p&gt;
&lt;p&gt;Redis 会将通知推送给所有合适的监听者，所以多实例时会收到多份通知，但我们只需要一个处理者。针对这个问题，我们要通过锁来处理。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var Redis = require(&amp;#39;ioredis&amp;#39;);
var sub = new Redis();
var client = new Redis();
var lock = require(&amp;#39;ioredis-lock&amp;#39;).createLock(client);

sub.psubscribe(&amp;#39;__keyspace@0__:order*&amp;#39;, function (err, count) {});

sub.on(&amp;#39;pmessage&amp;#39;, function (channel, key, message) {
  if (channel === &amp;#39;__keyspace@0__:order*&amp;#39;) {
    lock.acquire(key, function (err) {
      if (err) return // 获取锁失败，返回
      console.log(&amp;#39;handle notification %s&amp;#39;, key) // 获取锁成功，处理通知
    })
  }
});&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[使用 git 阅读开源项目时的小技巧]]></title><description><![CDATA[开源项目在早期版本时代码量少，结构简练，且创意和思想已经足够成熟，是切入开源项目的好时机，我们可以使用 git 回溯项目早期代码，并在各个提交间畅游。]]></description><link>https://blog.sigoden.com/gitbang-zhu-yue-du-kai-yuan-xiang-mu/</link><guid isPermaLink="false">https://blog.sigoden.com/gitbang-zhu-yue-du-kai-yuan-xiang-mu/</guid><content:encoded>&lt;h2 id=&quot;为什么要阅读开源项目&quot;&gt;&lt;a href=&quot;#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E9%98%85%E8%AF%BB%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&quot; aria-label=&quot;为什么要阅读开源项目 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;为什么要阅读开源项目&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;源码是唯一的真实&lt;/li&gt;
&lt;li&gt;加深对项目的理解&lt;/li&gt;
&lt;li&gt;学习自己没有的知识&lt;/li&gt;
&lt;li&gt;学习他人的写法，有助于自己代码质量的提高&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;开源项目难点&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E9%9A%BE%E7%82%B9&quot; aria-label=&quot;开源项目难点 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开源项目难点&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;不知道从哪儿开始&lt;/li&gt;
&lt;li&gt;文件太多，无法屡清楚结构&lt;/li&gt;
&lt;li&gt;代码太多，测试编译时耗费太多时间&lt;/li&gt;
&lt;li&gt;内容太多，难以全面理解&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;开源项目特点&quot;&gt;&lt;a href=&quot;#%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE%E7%89%B9%E7%82%B9&quot; aria-label=&quot;开源项目特点 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;开源项目特点&lt;/h2&gt;
&lt;p&gt;开源项目最早只是一个 idea, 这个 idea 是这个项目的根，随着项目的发展，特性会越来越多，架构可能会调整，但这个 idea 总是不变的，它是整个项目的精华。
而我们如果想要理解一个开源项目，弄懂这个 idea 是必须的，很多时候我们就是为了深入理解这个 idea 才产生阅读源码的动机。&lt;/p&gt;
&lt;p&gt;随者这个 idea 的实现，这个项目算是诞生了。但随着越来越多特性的加入，越来越多代码的提交，这个 idea 越来越深的掩藏起来。所以我们可以从&lt;strong&gt;早期版本&lt;/strong&gt;入手。&lt;/p&gt;
&lt;p&gt;最早完成 idea 的版本中这个 idea 是最清晰的，代码量是最少的，也是我们理解这个项目的最佳时机。&lt;/p&gt;
&lt;h2 id=&quot;使用-git-帮助理解开源项目&quot;&gt;&lt;a href=&quot;#%E4%BD%BF%E7%94%A8-git-%E5%B8%AE%E5%8A%A9%E7%90%86%E8%A7%A3%E5%BC%80%E6%BA%90%E9%A1%B9%E7%9B%AE&quot; aria-label=&quot;使用 git 帮助理解开源项目 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;使用 git 帮助理解开源项目&lt;/h2&gt;
&lt;p&gt;早期版本是切入开源项目的好时机，git 是版本控制领域的佼佼者，使用 git 帮助理解开源项目&lt;/p&gt;
&lt;h3 id=&quot;逆序查看日志&quot;&gt;&lt;a href=&quot;#%E9%80%86%E5%BA%8F%E6%9F%A5%E7%9C%8B%E6%97%A5%E5%BF%97&quot; aria-label=&quot;逆序查看日志 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;逆序查看日志&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git log --reverse&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;找一个感兴趣的版本切入&quot;&gt;&lt;a href=&quot;#%E6%89%BE%E4%B8%80%E4%B8%AA%E6%84%9F%E5%85%B4%E8%B6%A3%E7%9A%84%E7%89%88%E6%9C%AC%E5%88%87%E5%85%A5&quot; aria-label=&quot;找一个感兴趣的版本切入 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;找一个感兴趣的版本切入&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git checkout &amp;lt;commit-id&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;导航与对比&quot;&gt;&lt;a href=&quot;#%E5%AF%BC%E8%88%AA%E4%B8%8E%E5%AF%B9%E6%AF%94&quot; aria-label=&quot;导航与对比 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;导航与对比&lt;/h3&gt;
&lt;ul&gt;
&lt;li&gt;切换当前提交的上一次提交&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git checkout HEAD~&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;切换当前提交的下一次提交&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git log --reverse --pretty=%H master | grep -A 1 $(git rev-parse HEAD) | tail -n1 | xargs git checkout;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;比较上一个分支与当前分支&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git diff HEAD~..HEAD&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;追踪文件的变更历史&quot;&gt;&lt;a href=&quot;#%E8%BF%BD%E8%B8%AA%E6%96%87%E4%BB%B6%E7%9A%84%E5%8F%98%E6%9B%B4%E5%8E%86%E5%8F%B2&quot; aria-label=&quot;追踪文件的变更历史 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;追踪文件的变更历史&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git log --follow path/to/source_file&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;根据需要，可以专门阅读该文件相关的某个特定的 commit，很多时候项目第一版的代码会比最新版的代码简单很多，阅读旧版的代码可能会比较容易。如果是为了修复 bug 而读代码，这样的变更历史有时候可以提示我们哪个 commit 可能引入了 bug。&lt;/p&gt;
&lt;h3 id=&quot;查找字段&quot;&gt;&lt;a href=&quot;#%E6%9F%A5%E6%89%BE%E5%AD%97%E6%AE%B5&quot; aria-label=&quot;查找字段 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;查找字段&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git grep -w func -A100 -B100&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;假设有一个内部函数叫做&lt;code class=&quot;language-text&quot;&gt;func()&lt;/code&gt;, 没有文档，如何知道这个函数怎么用？除了阅读内部函数的实现和阅读实例，基本上没有其他方法。对于这种情况
可以批量找到 func 的用例，在 vim 里从上往下先扫一遍，找到尽可能简单的用例，然后再返回到源文件中阅读这个用例的上下文。&lt;/p&gt;
&lt;h3 id=&quot;别名&quot;&gt;&lt;a href=&quot;#%E5%88%AB%E5%90%8D&quot; aria-label=&quot;别名 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;别名&lt;/h3&gt;
&lt;p&gt;有些常用的 git 操作，我们可以通过设置 git alias 加快输入&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;git config --global alias.prev &amp;#39;checkout HEAD~&amp;#39;
git config --global alias.next &amp;#39;! f() { git log --reverse --pretty=%H ${1:-master} | grep -A 1 $(git rev-parse HEAD) | tail -n1 | xargs git checkout; }; f&amp;#39;
git config --global alias.difp &amp;#39;diff HEAD~..HEAD&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[一份详见的 npm 参考手册]]></title><description><![CDATA[一份详见的 npm 使用手册]]></description><link>https://blog.sigoden.com/npm-can-kao-shou-ce/</link><guid isPermaLink="false">https://blog.sigoden.com/npm-can-kao-shou-ce/</guid><content:encoded>&lt;h2 id=&quot;权限&quot;&gt;&lt;a href=&quot;#%E6%9D%83%E9%99%90&quot; aria-label=&quot;权限 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;权限&lt;/h2&gt;
&lt;p&gt;npm 允许通过 scope 组织私有包，通过 team 细化权限控制。&lt;/p&gt;
&lt;p&gt;npm 官方仓储有两种类型的包，普通包和 scope 包&lt;/p&gt;
&lt;p&gt;普通包特征：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;只能公有，谁都可以下载使用&lt;/li&gt;
&lt;li&gt;仅可以通过所有者 (owner) 进行权限控制，如果要允许某个用户修改或发布包，必须将该用户添加到包的所有者列表。添加到包所有者列表的用户具备所有的权限。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;scope 包特征：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;包名有两部组成，@scope/name, @后的为 scope 名，/ 后的才是具体的包名&lt;/li&gt;
&lt;li&gt;可以控制公有和私有&lt;/li&gt;
&lt;li&gt;细化的权限控制，比如可以创建团队，并赋予团队对包只读 / 修改的权限&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;owner-所有者管理&quot;&gt;&lt;a href=&quot;#owner-%E6%89%80%E6%9C%89%E8%80%85%E7%AE%A1%E7%90%86&quot; aria-label=&quot;owner 所有者管理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;owner 所有者管理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm owner add &amp;lt;user&amp;gt; [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt; # 将用户添加到包的所有者列表
npm owner rm &amp;lt;user&amp;gt; [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt; # 从包的所有这列表中删除用户
npm owner ls [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt; # 列出包的所有者&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;成为包的所有者的用户，将能够修改元数据（如标记弃用），发布新版本，添加其他用户到包的所有者列表&lt;/p&gt;
&lt;h3 id=&quot;tteam-组织成员管理&quot;&gt;&lt;a href=&quot;#tteam-%E7%BB%84%E7%BB%87%E6%88%90%E5%91%98%E7%AE%A1%E7%90%86&quot; aria-label=&quot;tteam 组织成员管理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;t/team 组织成员管理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm team create &amp;lt;scope:team&amp;gt; # 创建团队
npm team destroy &amp;lt;scope:team&amp;gt; # 删除团队

npm team add &amp;lt;scope:team&amp;gt; &amp;lt;user&amp;gt; # 添加用户到团队
npm team rm &amp;lt;scope:team&amp;gt; &amp;lt;user&amp;gt; # 从团队中移除用户

npm team ls &amp;lt;scope&amp;gt;|&amp;lt;scope:team&amp;gt; 列出团队 / 成员

npm team edit &amp;lt;scope:team&amp;gt;  用编辑器编辑团队信息&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;access-包访问控制&quot;&gt;&lt;a href=&quot;#access-%E5%8C%85%E8%AE%BF%E9%97%AE%E6%8E%A7%E5%88%B6&quot; aria-label=&quot;access 包访问控制 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;access 包访问控制&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm access public [&amp;lt;package&amp;gt;]  # 设置包开放
npm access restricted [&amp;lt;package&amp;gt;] # 设置包私有

npm access grant &amp;lt;read-only|read-write&amp;gt; &amp;lt;scope:team&amp;gt; [&amp;lt;package&amp;gt;] # 设置团队对包可以只读 / 允许修改
npm access revoke &amp;lt;scope:team&amp;gt; [&amp;lt;package&amp;gt;] # 从团队中收回包权限

npm access ls-packages [&amp;lt;user&amp;gt;|&amp;lt;scope&amp;gt;|&amp;lt;scope:team&amp;gt;]  # 列出用户 / 域 / 团队能够访问的包
npm access ls-collaborators [&amp;lt;package&amp;gt; [&amp;lt;user&amp;gt;]] # 列出包的权限信息
npm access edit [&amp;lt;package&amp;gt;] # 用编辑器编辑包权限&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;adduserlogin-用户登录&quot;&gt;&lt;a href=&quot;#adduserlogin-%E7%94%A8%E6%88%B7%E7%99%BB%E5%BD%95&quot; aria-label=&quot;adduserlogin 用户登录 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;adduser/login 用户登录&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm adduser [--registry=url] [--scope=@orgname] [--always-auth]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;提示输入 username, password, email，进行登录校验，返回 token 保存到.npmrc&lt;/p&gt;
&lt;h3 id=&quot;logout-注销&quot;&gt;&lt;a href=&quot;#logout-%E6%B3%A8%E9%94%80&quot; aria-label=&quot;logout 注销 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;logout 注销&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm logout [--registry=&amp;lt;url&amp;gt;] [--scope=&amp;lt;@scope&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;请求仓储服务将当前 token 失效&lt;/p&gt;
&lt;h3 id=&quot;whoami-查看用户信息&quot;&gt;&lt;a href=&quot;#whoami-%E6%9F%A5%E7%9C%8B%E7%94%A8%E6%88%B7%E4%BF%A1%E6%81%AF&quot; aria-label=&quot;whoami 查看用户信息 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;whoami 查看用户信息&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm whoami [--registry &amp;lt;registry&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;列出用户在 npmjs.org 上的用户名&lt;/p&gt;
&lt;h2 id=&quot;仓储&quot;&gt;&lt;a href=&quot;#%E4%BB%93%E5%82%A8&quot; aria-label=&quot;仓储 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;仓储&lt;/h2&gt;
&lt;h3 id=&quot;ssesearch-仓储查找包&quot;&gt;&lt;a href=&quot;#ssesearch-%E4%BB%93%E5%82%A8%E6%9F%A5%E6%89%BE%E5%8C%85&quot; aria-label=&quot;ssesearch 仓储查找包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;s/se/search 仓储查找包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm search [-l|--long] [--json] [--parseable] [--no-description] [search terms ...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;-l|--long: 展示出全部的 DESCRIPTION 栏信息&lt;/li&gt;
&lt;li&gt;--no-description: 不显示 DESCRIPTION 栏信息&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;publish-发布&quot;&gt;&lt;a href=&quot;#publish-%E5%8F%91%E5%B8%83&quot; aria-label=&quot;publish 发布 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;publish 发布&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm publish [&amp;lt;tarball&amp;gt;|&amp;lt;folder&amp;gt;] [--tag &amp;lt;tag&amp;gt;] [--access &amp;lt;public|restricted&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;--tag: 带上 tag 信息发布，之后包可以通过&lt;code class=&quot;language-text&quot;&gt;npm install &amp;lt;name&amp;gt;@&amp;lt;tag&amp;gt;&lt;/code&gt;安装&lt;/li&gt;
&lt;li&gt;--access: 仅适用于 scope 包，默认为 restricted&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;unpublish-取消发布&quot;&gt;&lt;a href=&quot;#unpublish-%E5%8F%96%E6%B6%88%E5%8F%91%E5%B8%83&quot; aria-label=&quot;unpublish 取消发布 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;unpublish 取消发布&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm unpublish [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt;[@&amp;lt;version&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从仓储中删除包，该操作会破坏依赖，不推荐适用，如果是为了鼓励用户适用新版本，可以使用 deprecate 命令&lt;/p&gt;
&lt;h3 id=&quot;deprecate-弃用&quot;&gt;&lt;a href=&quot;#deprecate-%E5%BC%83%E7%94%A8&quot; aria-label=&quot;deprecate 弃用 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;deprecate 弃用&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm deprecate &amp;lt;pkg&amp;gt;[@&amp;lt;version&amp;gt;] &amp;lt;message&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;标记包弃用，用户在安装时 npm 会有警告&lt;/p&gt;
&lt;h3 id=&quot;stars-列出收藏包&quot;&gt;&lt;a href=&quot;#stars-%E5%88%97%E5%87%BA%E6%94%B6%E8%97%8F%E5%8C%85&quot; aria-label=&quot;stars 列出收藏包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;stars 列出收藏包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm stars [&amp;lt;user&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看用户喜欢的包&lt;/p&gt;
&lt;h3 id=&quot;starunstart-收藏取消收藏&quot;&gt;&lt;a href=&quot;#starunstart-%E6%94%B6%E8%97%8F%E5%8F%96%E6%B6%88%E6%94%B6%E8%97%8F&quot; aria-label=&quot;starunstart 收藏取消收藏 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;star/unstart 收藏/取消收藏&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm star [&amp;lt;pkg&amp;gt;...]
npm unstar [&amp;lt;pkg&amp;gt;...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;标记喜欢 / 取消喜欢标记&lt;/p&gt;
&lt;h2 id=&quot;本地&quot;&gt;&lt;a href=&quot;#%E6%9C%AC%E5%9C%B0&quot; aria-label=&quot;本地 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;本地&lt;/h2&gt;
&lt;h3 id=&quot;init-初始化packagejson&quot;&gt;&lt;a href=&quot;#init-%E5%88%9D%E5%A7%8B%E5%8C%96packagejson&quot; aria-label=&quot;init 初始化packagejson permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;init 初始化package.json&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm init [-f|--force|-y|--yes]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;初始化 package.json,  默认会有很多输入提示，可以通过&lt;code class=&quot;language-text&quot;&gt;-f|--force|-y|--yes&lt;/code&gt;选项创建默认配置的 package.json
已经存在 package.json 后再次运行&lt;code class=&quot;language-text&quot;&gt;npm init&lt;/code&gt;不会破坏已有配置，只会变更你真正改动的部分&lt;/p&gt;
&lt;h3 id=&quot;iinstall-安装&quot;&gt;&lt;a href=&quot;#iinstall-%E5%AE%89%E8%A3%85&quot; aria-label=&quot;iinstall 安装 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;i/install 安装&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm install (with no args, in package dir) # 读取 package.json 安装
npm install [&amp;lt;@scope&amp;gt;/]&amp;lt;name&amp;gt; # 默认安装标签为 latest
npm install [&amp;lt;@scope&amp;gt;/]&amp;lt;name&amp;gt;@&amp;lt;tag&amp;gt; # 指定标签
npm install [&amp;lt;@scope&amp;gt;/]&amp;lt;name&amp;gt;@&amp;lt;version&amp;gt; # 指定版本
npm install [&amp;lt;@scope&amp;gt;/]&amp;lt;name&amp;gt;@&amp;lt;version range&amp;gt; # 指定版本范围
npm install &amp;lt;tarball file&amp;gt;  # 通过 tarball 文件安装
npm install &amp;lt;tarball url&amp;gt; # 通过 tarball 文件 url 链接安装
npm install &amp;lt;git remote url&amp;gt; # 通过 git 安装包，url 格式为&amp;lt;protocol&amp;gt;://[&amp;lt;user&amp;gt;[:&amp;lt;password&amp;gt;]@]&amp;lt;hostname&amp;gt;[:&amp;lt;port&amp;gt;][:][/]&amp;lt;path&amp;gt;[#&amp;lt;commit-ish&amp;gt;]
npm install &amp;lt;folder&amp;gt; 通过包所在的文件夹安装&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;--registry: 从指定仓储中下载安装包&lt;/li&gt;
&lt;li&gt;-S/--save: 安装并保存包信息到 package.json 的 dependencies 区&lt;/li&gt;
&lt;li&gt;-D/--save-dev: 安装并保存包信息到 package.json 的 devDependencies 区&lt;/li&gt;
&lt;li&gt;--tag: 优先根据标签而不是版本安装包&lt;/li&gt;
&lt;li&gt;--dry-run: 报告安装状况而不真的安装&lt;/li&gt;
&lt;li&gt;-f/--force: 安装时跳过缓存直接从远程下载&lt;/li&gt;
&lt;li&gt;-g/--global: 安装到全局&lt;/li&gt;
&lt;li&gt;--link: 链接全局安装的包的本地&lt;/li&gt;
&lt;li&gt;--no-shrinkwrap: 安装时忽略 shrinkwrap&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;ununinstall-删除&quot;&gt;&lt;a href=&quot;#ununinstall-%E5%88%A0%E9%99%A4&quot; aria-label=&quot;ununinstall 删除 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;un/uninstall 删除&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm uninstall [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt;[@&amp;lt;version&amp;gt;]... [-S|--save|-D|--save-dev]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;-S/--save: 删除包并移除包在 package.json 的 dependencies 区的信息&lt;/li&gt;
&lt;li&gt;-D/--save-dev: 删除包并移除包在 package.json 的 devDependencies 区的信息&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;dedupeddp-清除重复包&quot;&gt;&lt;a href=&quot;#dedupeddp-%E6%B8%85%E9%99%A4%E9%87%8D%E5%A4%8D%E5%8C%85&quot; aria-label=&quot;dedupeddp 清除重复包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;dedupe/ddp 清除重复包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm dedupe&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;npm 检查包依赖树并清除不要的包&lt;/p&gt;
&lt;h3 id=&quot;dist-tags-标签管理&quot;&gt;&lt;a href=&quot;#dist-tags-%E6%A0%87%E7%AD%BE%E7%AE%A1%E7%90%86&quot; aria-label=&quot;dist tags 标签管理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;dist-tags 标签管理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm dist-tag add &amp;lt;pkg&amp;gt;@&amp;lt;version&amp;gt; [&amp;lt;tag&amp;gt;] # 添加标签
npm dist-tag rm &amp;lt;pkg&amp;gt; &amp;lt;tag&amp;gt; # 移除标签
npm dist-tag ls [&amp;lt;pkg&amp;gt;] # 列出包所包含的标签&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;常见标签有 latest, next, lts 等&lt;/p&gt;
&lt;p&gt;可以在发布和下载包是带上标签&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm publish # 默认标签 latest
npm publish --tag next  # 发布 next 标签
npm install npm # 默认标签 latest
npm install npm@next
npm install --tag next&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;--registry: 发布包到指定仓储&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;vversion-更新包的版本信息&quot;&gt;&lt;a href=&quot;#vversion-%E6%9B%B4%E6%96%B0%E5%8C%85%E7%9A%84%E7%89%88%E6%9C%AC%E4%BF%A1%E6%81%AF&quot; aria-label=&quot;vversion 更新包的版本信息 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;v/version 更新包的版本信息&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm version [&amp;lt;newversion&amp;gt; | major | minor | patch | premajor | preminor | prepatch | prerelease | from-git]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该命令执行步骤&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;检查 git 工作目录&lt;/li&gt;
&lt;li&gt;运行 preversion 脚本，可以写些触发测试的脚本&lt;/li&gt;
&lt;li&gt;结合当前包当前版本信息和 patch, minor, major 等，生成新版本号，更新 package.json 中 version 字段&lt;/li&gt;
&lt;li&gt;patch 1.0.0 =&gt; 1.0.1&lt;/li&gt;
&lt;li&gt;prepatch 1.0.0 =&gt; 1.0.1-0&lt;/li&gt;
&lt;li&gt;minor 1.0.0 =&gt; 1.1.0&lt;/li&gt;
&lt;li&gt;preminor 1.0.0 =&gt; 1.1.0-0&lt;/li&gt;
&lt;li&gt;major 1.0.0 =&gt; 2.0.0&lt;/li&gt;
&lt;li&gt;premajor 1.0.0 =&gt; 2.0.0-0&lt;/li&gt;
&lt;li&gt;prerelease 1.0.0-0 =&gt; 1.0.0-1&lt;/li&gt;
&lt;li&gt;from-git 从 git 获取版本信息&lt;/li&gt;
&lt;li&gt;运行 version 脚本&lt;/li&gt;
&lt;li&gt;git 提交并打标签&lt;/li&gt;
&lt;li&gt;运行 postversion 脚本&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;itinstall-test--运行安装并测试&quot;&gt;&lt;a href=&quot;#itinstall-test--%E8%BF%90%E8%A1%8C%E5%AE%89%E8%A3%85%E5%B9%B6%E6%B5%8B%E8%AF%95&quot; aria-label=&quot;itinstall test  运行安装并测试 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;it/install-test  运行安装并测试&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm it
npm install-test&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;相当于运行 npm install &amp;#x26;&amp;#x26; npm test&lt;/p&gt;
&lt;h3 id=&quot;lnlink-软链接安装&quot;&gt;&lt;a href=&quot;#lnlink-%E8%BD%AF%E9%93%BE%E6%8E%A5%E5%AE%89%E8%A3%85&quot; aria-label=&quot;lnlink 软链接安装 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ln/link 软链接安装&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm link  # 在全局 node_modules 下创建当前文件夹的超链接
npm link [&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt;[@&amp;lt;version&amp;gt;] # 将全局安装的包链接到本地 node_modules 中&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;lslist-列出包&quot;&gt;&lt;a href=&quot;#lslist-%E5%88%97%E5%87%BA%E5%8C%85&quot; aria-label=&quot;lslist 列出包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ls/list 列出包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm ls [[&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt; ...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打印依赖树&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;--json: 已 json 格式输出&lt;/li&gt;
&lt;li&gt;--long: 展示更多信息&lt;/li&gt;
&lt;li&gt;--parseable: 显示展平的目录而不是依赖树&lt;/li&gt;
&lt;li&gt;--global: 显示全局安装的包的依赖树&lt;/li&gt;
&lt;li&gt;--depth: 树层级，从 0 开始&lt;/li&gt;
&lt;li&gt;--prod/production: 仅显示 package.json 里 dependencies 包的依赖&lt;/li&gt;
&lt;li&gt;--dev: 仅显示 package.json 里 devDependencies 包的依赖&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;updateup-更新并安装遗漏的包&quot;&gt;&lt;a href=&quot;#updateup-%E6%9B%B4%E6%96%B0%E5%B9%B6%E5%AE%89%E8%A3%85%E9%81%97%E6%BC%8F%E7%9A%84%E5%8C%85&quot; aria-label=&quot;updateup 更新并安装遗漏的包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;update/up 更新并安装遗漏的包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm update [-g] [&amp;lt;pkg&amp;gt;...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;更新包到包的 semver 所允许的最新版本，并安装遗漏的包&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;--save: 更新并保存更新到 package.json&lt;/li&gt;
&lt;li&gt;--dev: 同时更新 devDependencies 中的包&lt;/li&gt;
&lt;li&gt;--depth: 默认情况下仅更新顶层 (--depth=0) 为 0 的包，如果想更新所有包，可以指定 --depth=9999&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;outdated-检测过期&quot;&gt;&lt;a href=&quot;#outdated-%E6%A3%80%E6%B5%8B%E8%BF%87%E6%9C%9F&quot; aria-label=&quot;outdated 检测过期 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;outdated 检测过期&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm outdated [[&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt; ...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;.e.g&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;Package        Current  Wanted  Latest  Location
ajv              4.8.2  4.11.8   5.0.1  example
async            2.1.2   2.4.0   2.4.0  example
body-parser     1.15.2  1.17.1  1.17.1  example&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;列表栏&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;Current: 当前版本&lt;/li&gt;
&lt;li&gt;Wanted: smever 允许的最高版本&lt;/li&gt;
&lt;li&gt;Latest: 仓储中最新版本&lt;/li&gt;
&lt;li&gt;Location: 依赖树中的位置&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;命令选项&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;--json: 已 json 格式输出&lt;/li&gt;
&lt;li&gt;--long: 展示更多信息&lt;/li&gt;
&lt;li&gt;--parseable: 平铺展示&lt;/li&gt;
&lt;li&gt;--global: 显示全局安装的包的依赖树&lt;/li&gt;
&lt;li&gt;--depth: 树层级，默认 0&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;pack-打包-tarball-文件&quot;&gt;&lt;a href=&quot;#pack-%E6%89%93%E5%8C%85-tarball-%E6%96%87%E4%BB%B6&quot; aria-label=&quot;pack 打包 tarball 文件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;pack 打包 tarball 文件&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm pack [[&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt;...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从包生成名为&lt;code class=&quot;language-text&quot;&gt;&amp;lt;name&amp;gt;-&amp;lt;version&amp;gt;.tgz&lt;/code&gt;的 tarball, 并缓存&lt;/p&gt;
&lt;h3 id=&quot;prune-清理外来包&quot;&gt;&lt;a href=&quot;#prune-%E6%B8%85%E7%90%86%E5%A4%96%E6%9D%A5%E5%8C%85&quot; aria-label=&quot;prune 清理外来包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;prune 清理外来包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm prune [[&amp;lt;@scope&amp;gt;/]&amp;lt;pkg&amp;gt;...] [--production]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;清理不在 package.json 生成的依赖树中的包&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;--production: 移除 devDependencies 中的包&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;shrinkwrap-锁定依赖包版本&quot;&gt;&lt;a href=&quot;#shrinkwrap-%E9%94%81%E5%AE%9A%E4%BE%9D%E8%B5%96%E5%8C%85%E7%89%88%E6%9C%AC&quot; aria-label=&quot;shrinkwrap 锁定依赖包版本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;shrinkwrap 锁定依赖包版本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm shrinkwrap&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;shrinkwrap 用来锁定依赖包的版本&lt;/p&gt;
&lt;p&gt;包 A 的 package.json&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
	&amp;quot;name&amp;quot;: &amp;quot;A&amp;quot;,
	&amp;quot;version&amp;quot;: &amp;quot;0.1.0&amp;quot;,
	&amp;quot;dependencies&amp;quot;: {
		&amp;quot;B&amp;quot;: &amp;quot;&amp;lt;0.1.0&amp;quot;
	}
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;包 A 的依赖树&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; A@0.1.0
	`-- B@0.0.1
		`-- C@0.0.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当 B 有新版本 0.0.2 发布，B@0.0.2 满足小于0.1.0, 所以&lt;code class=&quot;language-text&quot;&gt;npm install A&lt;/code&gt;安装成功后依赖树&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt; A@0.1.0
	`-- B@0.0.2
		`-- C@0.0.1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;我们希望包 A 依赖的 B 版本保持在 B@0.0.1, 可以运行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm shrinkwrap&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;该命令会生成 npm-shrinkwrap.json, 其内容如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
  &amp;quot;name&amp;quot;: &amp;quot;A&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;0.1.0&amp;quot;,
  &amp;quot;dependencies&amp;quot;: {
    &amp;quot;B&amp;quot;: {
      &amp;quot;version&amp;quot;: &amp;quot;0.0.1&amp;quot;,
      &amp;quot;from&amp;quot;: &amp;quot;B@^0.0.1&amp;quot;,
      &amp;quot;resolved&amp;quot;: &amp;quot;https://registry.npmjs.org/B/-/B-0.0.1.tgz&amp;quot;,
      &amp;quot;dependencies&amp;quot;: {
        &amp;quot;C&amp;quot;: {
          &amp;quot;version&amp;quot;: &amp;quot;0.0.1&amp;quot;,
          &amp;quot;from&amp;quot;: &amp;quot;org/C#v0.0.1&amp;quot;,
          &amp;quot;resolved&amp;quot;: &amp;quot;git://github.com/org/C.git#5c380ae319fc4efe9e7f2d9c78b0faa588fd99b4&amp;quot;
        }
      }
    }
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行&lt;code class=&quot;language-text&quot;&gt;npm install&lt;/code&gt;时如果存在 npm-shrinkwrap.json, npm 在安装包时会根据 shrinkwrap.json 锁定依赖包的版本&lt;/p&gt;
&lt;h3 id=&quot;cache-缓存管理&quot;&gt;&lt;a href=&quot;#cache-%E7%BC%93%E5%AD%98%E7%AE%A1%E7%90%86&quot; aria-label=&quot;cache 缓存管理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;cache 缓存管理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm cache add &amp;lt;tarball file&amp;gt; # 添加到缓存
npm cache add &amp;lt;folder&amp;gt;
npm cache add &amp;lt;tarball url&amp;gt;
npm cache add &amp;lt;name&amp;gt;@&amp;lt;version&amp;gt;

npm cache ls [&amp;lt;path&amp;gt;]  # 缓存明细

npm cache clean [&amp;lt;path&amp;gt;] # 清除缓存&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;缓存路径可以通过&lt;code class=&quot;language-text&quot;&gt;npm config get cache&lt;/code&gt;获取&lt;/p&gt;
&lt;h2 id=&quot;脚本&quot;&gt;&lt;a href=&quot;#%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;脚本&lt;/h2&gt;
&lt;p&gt;package.json 的 scripts 区可以用来定义自定义脚本&lt;/p&gt;
&lt;h3 id=&quot;runrun-script-运行脚本&quot;&gt;&lt;a href=&quot;#runrun-script-%E8%BF%90%E8%A1%8C%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;runrun script 运行脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;run/run-script 运行脚本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm run &amp;lt;command&amp;gt; [-- &amp;lt;args&amp;gt;...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行 package.json 的 scripts 中定义的命令&lt;/p&gt;
&lt;p&gt;npm run 会自动将&lt;code class=&quot;language-text&quot;&gt;node_modules/.bin&lt;/code&gt;添加到环境变量 PATH 中。如果本地安装过 mocha, 可以这样编写&lt;code class=&quot;language-text&quot;&gt;&amp;quot;scripts&amp;quot;: {&amp;quot;test&amp;quot;: &amp;quot;mocha test/\*.js&amp;quot;}&lt;/code&gt;而不需要&lt;code class=&quot;language-text&quot;&gt;&amp;quot;scripts&amp;quot;: {&amp;quot;test&amp;quot;: &amp;quot;node_modules/.bin/tap test/\*.js&amp;quot;}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;start-运行-start-脚本&quot;&gt;&lt;a href=&quot;#start-%E8%BF%90%E8%A1%8C-start-%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;start 运行 start 脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;start 运行 start 脚本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm start [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;等同与&lt;code class=&quot;language-text&quot;&gt;npm run start [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;stop-运行-stop-脚本&quot;&gt;&lt;a href=&quot;#stop-%E8%BF%90%E8%A1%8C-stop-%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;stop 运行 stop 脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;stop 运行 stop 脚本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm stop [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;等同与&lt;code class=&quot;language-text&quot;&gt;npm run stop [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;tsttest-运行-test-脚本&quot;&gt;&lt;a href=&quot;#tsttest-%E8%BF%90%E8%A1%8C-test-%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;tsttest 运行 test 脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;tst/test 运行 test 脚本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm test [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;等同与&lt;code class=&quot;language-text&quot;&gt;npm run test [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;rbrebuild-重新编译本地包&quot;&gt;&lt;a href=&quot;#rbrebuild-%E9%87%8D%E6%96%B0%E7%BC%96%E8%AF%91%E6%9C%AC%E5%9C%B0%E5%8C%85&quot; aria-label=&quot;rbrebuild 重新编译本地包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;rb/rebuild 重新编译本地包&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm rebuild [[&amp;lt;@scope&amp;gt;/&amp;lt;name&amp;gt;]...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行指定包中的 build 脚本，适用于更新 node 版本后，重新编译 C++ 包&lt;/p&gt;
&lt;h3 id=&quot;restart--顺序执行重启相关的一系列脚本&quot;&gt;&lt;a href=&quot;#restart--%E9%A1%BA%E5%BA%8F%E6%89%A7%E8%A1%8C%E9%87%8D%E5%90%AF%E7%9B%B8%E5%85%B3%E7%9A%84%E4%B8%80%E7%B3%BB%E5%88%97%E8%84%9A%E6%9C%AC&quot; aria-label=&quot;restart  顺序执行重启相关的一系列脚本 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;restart  顺序执行重启相关的一系列脚本&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm restart [-- &amp;lt;args&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;循序执行&lt;code class=&quot;language-text&quot;&gt;1. prerestart 2. prestop 3. stop 4. poststop 5. restart 6. prestart 7. start 8. poststart 9. postrestart&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;配置&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置&lt;/h2&gt;
&lt;h3 id=&quot;cconfig-配置管理&quot;&gt;&lt;a href=&quot;#cconfig-%E9%85%8D%E7%BD%AE%E7%AE%A1%E7%90%86&quot; aria-label=&quot;cconfig 配置管理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;c/config 配置管理&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm config set &amp;lt;key&amp;gt; &amp;lt;value&amp;gt; [-g|--global] # 添加或更新
npm config get &amp;lt;key&amp;gt; # 获取
npm config delete &amp;lt;key&amp;gt; # 删除
npm config list #  配置明细
npm config edit # 编辑器编辑&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;--global: 全局配置&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;get-列出配置&quot;&gt;&lt;a href=&quot;#get-%E5%88%97%E5%87%BA%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;get 列出配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;get 列出配置&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm get &amp;lt;key&amp;gt; # 同 npm config get&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;set-设置配置&quot;&gt;&lt;a href=&quot;#set-%E8%AE%BE%E7%BD%AE%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;set 设置配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;set 设置配置&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm set &amp;lt;key&amp;gt; &amp;lt;value&amp;gt; [-g|--global] #同 npm config set&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;查看&quot;&gt;&lt;a href=&quot;#%E6%9F%A5%E7%9C%8B&quot; aria-label=&quot;查看 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;查看&lt;/h2&gt;
&lt;h3 id=&quot;root--打印包根目录&quot;&gt;&lt;a href=&quot;#root--%E6%89%93%E5%8D%B0%E5%8C%85%E6%A0%B9%E7%9B%AE%E5%BD%95&quot; aria-label=&quot;root  打印包根目录 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;root  打印包根目录&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm root # 打印本地 node_modules 目录
npm root -g # 打印全局 node_modules 目录&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;prefix-打印-prefix-配置&quot;&gt;&lt;a href=&quot;#prefix-%E6%89%93%E5%8D%B0-prefix-%E9%85%8D%E7%BD%AE&quot; aria-label=&quot;prefix 打印 prefix 配置 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;prefix 打印 prefix 配置&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm prefix # 打印包含 package.json 最近父目录
npm prefix -g # 打印全局配置 prefix 的值&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;vview-查看仓储信息&quot;&gt;&lt;a href=&quot;#vview-%E6%9F%A5%E7%9C%8B%E4%BB%93%E5%82%A8%E4%BF%A1%E6%81%AF&quot; aria-label=&quot;vview 查看仓储信息 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;v/view 查看仓储信息&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm view [&amp;lt;@scope&amp;gt;/]&amp;lt;name&amp;gt;[@&amp;lt;version&amp;gt;] [&amp;lt;field&amp;gt;[.&amp;lt;subfield&amp;gt;]...]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看仓储信息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm view compact


#  打印
{ name: &amp;#39;compact&amp;#39;,
  description: &amp;#39;A JavaScript compacting middleware for express&amp;#39;,
  &amp;#39;dist-tags&amp;#39;: { latest: &amp;#39;0.1.2&amp;#39; },
  maintainers: [ &amp;#39;serby &amp;lt;paul@serby.net&amp;gt;&amp;#39; ],
  time:
   { modified: &amp;#39;2017-03-28T12:49:48.000Z&amp;#39;,
     created: &amp;#39;2012-02-06T01:39:50.261Z&amp;#39;,
     &amp;#39;0.1.2&amp;#39;: &amp;#39;2012-09-04T11:19:17.618Z&amp;#39;,
     &amp;#39;0.1.1&amp;#39;: &amp;#39;2012-08-29T08:18:12.345Z&amp;#39;,
     &amp;#39;0.1.0&amp;#39;: &amp;#39;2012-07-09T14:40:56.751Z&amp;#39;,
     &amp;#39;0.0.7&amp;#39;: &amp;#39;2012-07-04T17:14:01.593Z&amp;#39;,
     &amp;#39;0.0.6&amp;#39;: &amp;#39;2012-06-29T14:29:04.847Z&amp;#39;,
     &amp;#39;0.0.5&amp;#39;: &amp;#39;2012-05-23T10:10:15.010Z&amp;#39;,
     &amp;#39;0.0.4&amp;#39;: &amp;#39;2012-03-31T09:05:40.450Z&amp;#39;,
     &amp;#39;0.0.3&amp;#39;: &amp;#39;2012-03-23T15:25:18.289Z&amp;#39;,
     &amp;#39;0.0.2&amp;#39;: &amp;#39;2012-03-21T18:15:24.718Z&amp;#39;,
     &amp;#39;0.0.1&amp;#39;: &amp;#39;2012-02-06T01:39:50.261Z&amp;#39; },
  users: { serby: true },
  author: &amp;#39;Paul Serby &amp;lt;paul@serby.net&amp;gt;&amp;#39;,
  repository: { type: &amp;#39;git&amp;#39;, url: &amp;#39;git://github.com/serby/compact.git&amp;#39; },
  versions:
   [ &amp;#39;0.0.1&amp;#39;,
     &amp;#39;0.0.2&amp;#39;,
     &amp;#39;0.0.3&amp;#39;,
     &amp;#39;0.0.4&amp;#39;,
     &amp;#39;0.0.5&amp;#39;,
     &amp;#39;0.0.6&amp;#39;,
     &amp;#39;0.0.7&amp;#39;,
     &amp;#39;0.1.0&amp;#39;,
     &amp;#39;0.1.1&amp;#39;,
     &amp;#39;0.1.2&amp;#39; ],
  version: &amp;#39;0.1.2&amp;#39;,
  main: &amp;#39;./lib/compact.js&amp;#39;,
  scripts: { test: &amp;#39;mocha -r should -R spec&amp;#39; },
  engines: { node: &amp;#39;&amp;gt;=0.8&amp;#39; },
  dependencies:
   { lodash: &amp;#39;~0.3&amp;#39;,
     async: &amp;#39;~0.1&amp;#39;,
     &amp;#39;uglify-js&amp;#39;: &amp;#39;~1.3&amp;#39;,
     mkdirp: &amp;#39;~0.3&amp;#39; },
  devDependencies: { mocha: &amp;#39;*&amp;#39;, should: &amp;#39;~1.1&amp;#39;, async: &amp;#39;~0.1&amp;#39;, asyncjs: &amp;#39;~0.0&amp;#39; },
  optionalDependencies: {},
  dist:
   { shasum: &amp;#39;66361e17108185bf261d42aff6a91b925e473139&amp;#39;,
     size: 7603,
     noattachment: false,
     tarball: &amp;#39;http://registry.npm.taobao.org/compact/download/compact-0.1.2.tgz&amp;#39; },
  directories: {},
  publish_time: 1346757557618 }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm view compact@0.1.2 dependencies

# 打印
{ lodash: &amp;#39;~0.3&amp;#39;,
  async: &amp;#39;~0.1&amp;#39;,
  &amp;#39;uglify-js&amp;#39;: &amp;#39;~1.3&amp;#39;,
  mkdirp: &amp;#39;~0.3&amp;#39; }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;bin-查看-bin-目录&quot;&gt;&lt;a href=&quot;#bin-%E6%9F%A5%E7%9C%8B-bin-%E7%9B%AE%E5%BD%95&quot; aria-label=&quot;bin 查看 bin 目录 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;bin 查看 bin 目录&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm bin # 打印包含 npm bin 目录，通常为 node_modules/.bin/
npm prefix -g # 打印全局 npm bin 目录&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;bugsissue-浏览器查看-bugs&quot;&gt;&lt;a href=&quot;#bugsissue-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B-bugs&quot; aria-label=&quot;bugsissue 浏览器查看 bugs permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;bugs/issue 浏览器查看 bugs&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm bugs [&amp;lt;packagename&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打开包 bug 追踪 url&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm bugs npm # 浏览器打开 https://github.com/npm/npm/issues&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;docshome-浏览器查看帮助文档&quot;&gt;&lt;a href=&quot;#docshome-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B%E5%B8%AE%E5%8A%A9%E6%96%87%E6%A1%A3&quot; aria-label=&quot;docshome 浏览器查看帮助文档 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;docs/home 浏览器查看帮助文档&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm docs [&amp;lt;pkgname&amp;gt; [&amp;lt;pkgname&amp;gt; ...]]
npm docs .
npm home [&amp;lt;pkgname&amp;gt; [&amp;lt;pkgname&amp;gt; ...]]
npm home .&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打开文档 url&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm docs npm #浏览器打开 https://docs.npmjs.com/&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;repo-浏览器查看仓储&quot;&gt;&lt;a href=&quot;#repo-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8B%E4%BB%93%E5%82%A8&quot; aria-label=&quot;repo 浏览器查看仓储 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;repo 浏览器查看仓储&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm repo [&amp;lt;pkg&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打开 git url&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm repo npm #浏览器打开 https://github.com/npm/npm&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;help-查看帮助&quot;&gt;&lt;a href=&quot;#help-%E6%9F%A5%E7%9C%8B%E5%B8%AE%E5%8A%A9&quot; aria-label=&quot;help 查看帮助 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;help 查看帮助&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm help &amp;lt;term&amp;gt; [&amp;lt;terms..&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;打印特定术语或命令的帮助&lt;/p&gt;
&lt;h3 id=&quot;help-search-帮助中搜索关键字&quot;&gt;&lt;a href=&quot;#help-search-%E5%B8%AE%E5%8A%A9%E4%B8%AD%E6%90%9C%E7%B4%A2%E5%85%B3%E9%94%AE%E5%AD%97&quot; aria-label=&quot;help search 帮助中搜索关键字 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;help-search 帮助中搜索关键字&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm help-search &amp;lt;text&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;从 npm 官方 markdown 文档中搜索词条&lt;/p&gt;
&lt;h2 id=&quot;其他&quot;&gt;&lt;a href=&quot;#%E5%85%B6%E4%BB%96&quot; aria-label=&quot;其他 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;其他&lt;/h2&gt;
&lt;h3 id=&quot;completion-命令补全&quot;&gt;&lt;a href=&quot;#completion-%E5%91%BD%E4%BB%A4%E8%A1%A5%E5%85%A8&quot; aria-label=&quot;completion 命令补全 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;completion 命令补全&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm completion &amp;gt;&amp;gt; ~/.bashrc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;npm 命令补全&lt;/p&gt;
&lt;h3 id=&quot;doctor-环境检测&quot;&gt;&lt;a href=&quot;#doctor-%E7%8E%AF%E5%A2%83%E6%A3%80%E6%B5%8B&quot; aria-label=&quot;doctor 环境检测 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;doctor 环境检测&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm doctor&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;环境检测&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;npm 能调用 node 和 git 命令&lt;/li&gt;
&lt;li&gt;registry 能够访问&lt;/li&gt;
&lt;li&gt;本地和全局 node_modules 可写&lt;/li&gt;
&lt;li&gt;缓存存在且 tarball 文件健全&lt;/li&gt;
&lt;/ul&gt;
&lt;h3 id=&quot;edit-进入包目录并启动编辑器&quot;&gt;&lt;a href=&quot;#edit-%E8%BF%9B%E5%85%A5%E5%8C%85%E7%9B%AE%E5%BD%95%E5%B9%B6%E5%90%AF%E5%8A%A8%E7%BC%96%E8%BE%91%E5%99%A8&quot; aria-label=&quot;edit 进入包目录并启动编辑器 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;edit 进入包目录并启动编辑器&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm edit &amp;lt;pkg&amp;gt;[@&amp;lt;version&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;进入包目录并启动编辑器&lt;/p&gt;
&lt;h3 id=&quot;explore-进入包目录并运行命令&quot;&gt;&lt;a href=&quot;#explore-%E8%BF%9B%E5%85%A5%E5%8C%85%E7%9B%AE%E5%BD%95%E5%B9%B6%E8%BF%90%E8%A1%8C%E5%91%BD%E4%BB%A4&quot; aria-label=&quot;explore 进入包目录并运行命令 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;explore 进入包目录并运行命令&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm explore &amp;lt;pkg&amp;gt; [-- &amp;lt;cmd&amp;gt;]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;进入包目录并运行命令&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm explore connect -- ls

# 打印
HISTORY.md  index.js  LICENSE  node_modules  package.json  README.md&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;ping-检查仓储是否可用&quot;&gt;&lt;a href=&quot;#ping-%E6%A3%80%E6%9F%A5%E4%BB%93%E5%82%A8%E6%98%AF%E5%90%A6%E5%8F%AF%E7%94%A8&quot; aria-label=&quot;ping 检查仓储是否可用 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;ping 检查仓储是否可用&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;npm ping [--registry &amp;lt;registry&amp;gt;]
npm ping --registry https://registry.npmjs.org&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;检查仓储是否可用&lt;/p&gt;</content:encoded></item><item><title><![CDATA[socket.io 系列一：介绍]]></title><description><![CDATA[socket.io 提供了基于事件的实时双向通讯，本文将对其进行详细介绍]]></description><link>https://blog.sigoden.com/socket-iozhi-yi-jie-shao/</link><guid isPermaLink="false">https://blog.sigoden.com/socket-iozhi-yi-jie-shao/</guid><content:encoded>&lt;h2 id=&quot;历史&quot;&gt;&lt;a href=&quot;#%E5%8E%86%E5%8F%B2&quot; aria-label=&quot;历史 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;历史&lt;/h2&gt;
&lt;p&gt;Web 端与服务器间的实时数据传输的是一个很重要的需求，但最早只能通过 AJAX 轮询询实现。在 WebSocket 标准没有推出之前，AJAX 轮询是唯一可行的方式（通过 Flash 浏览器也可以，但这里不做讨论）。AJAX 轮询原理是设置定时器，定时通过 AJAX 同步服务器数据。这种方式存在延时且对服务端造成很大负载。直到 2011 年，IETF 才标准化 WebSocket——一种基于 TCP 套接字进行收发数据的协议。现如今主流浏览器均已支持 WebSocket。

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/5aed05526ef6481cefe065e7afb1028b/70e11/browser-websocket-support.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 34.384858044164034%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABpUlEQVQY002MzUvbYACH83/tsKswBhsehOEu7SalpDtO0IsMpzsMdnAHDxbFQV2Voq2YprWCZfYj2jTNxxu7pm/6Nm/SNPGNSVQcKLKFeREeHn6Hhx+Fexzu80avYSIuHCm+JQYjKRjJV2PwlNBWHMRHDmzZxi2CeUvjKEctuSrjDPgx4l3UJlgmhuSb4o17fu2oj4QOuHKAHz3+354thrbkWxJ1oe4TZdcdCmNdIMN2YAJiyRZqeaboGR0fix5q32BwbSiXSHDgaWhIIZJcJAy1U8pFgAx/Y52HvaYJ67ZW+1RffFWKN8+ZETwzejXcPTkQMmvN71r/l29ILNha51cg5MhApSrCzxy3Nn/4MVZ8TxdTiRI9VZieyL+OH8y8YxN0kU6WU5P5N8/3XhZ2lgfZdCIXe7b7YrX6lWn/oGpynhEyZX6r0snOVWbfFuM0m5phkwtH84vVhRT7YZqJ5bj0ibInlTf7hY06lz2Wc1F/KG5Tt+Pug6ffk/5fb7CtbiydfV7pfPvSWtLNxh3RgFFtQCZ0wQOBfwJ4G+p3HoziexIZ/gPC8UctmQOrJgAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;浏览器 WebSocket 支持状况&quot;
        title=&quot;&quot;
        src=&quot;/static/5aed05526ef6481cefe065e7afb1028b/73d01/browser-websocket-support.png&quot;
        srcset=&quot;/static/5aed05526ef6481cefe065e7afb1028b/a3b1f/browser-websocket-support.png 197w,
/static/5aed05526ef6481cefe065e7afb1028b/07137/browser-websocket-support.png 393w,
/static/5aed05526ef6481cefe065e7afb1028b/73d01/browser-websocket-support.png 786w,
/static/5aed05526ef6481cefe065e7afb1028b/a5918/browser-websocket-support.png 1179w,
/static/5aed05526ef6481cefe065e7afb1028b/70e11/browser-websocket-support.png 1268w&quot;
        sizes=&quot;(max-width: 786px) 100vw, 786px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;socket.io 将数据传输部分独立出来形成了 &lt;a href=&quot;https://github.com/socketio/engine.io.git&quot;&gt;engine.io&lt;/a&gt;, engine.io 对 WebSocket 和 AJAX 轮询进行封装，形成一套 API, 屏蔽了细节差异和兼容性问题，实现了跨浏览器 / 跨设备进行双向数据。&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;socket.io 对 engine.io 不是必须的，你也可以实现自己的 engine.io，通过&lt;code class=&quot;language-text&quot;&gt;server.bind&lt;/code&gt;绑定&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;应用&quot;&gt;&lt;a href=&quot;#%E5%BA%94%E7%94%A8&quot; aria-label=&quot;应用 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;应用&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;实时数据分析展示（报表，日志）&lt;/li&gt;
&lt;li&gt;即时通讯、聊天，&lt;/li&gt;
&lt;li&gt;二进制流（图片，音乐，视频）传输&lt;/li&gt;
&lt;li&gt;多人协同编辑&lt;/li&gt;
&lt;li&gt;即时消息推送&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;类似技术&quot;&gt;&lt;a href=&quot;#%E7%B1%BB%E4%BC%BC%E6%8A%80%E6%9C%AF&quot; aria-label=&quot;类似技术 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;类似技术&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;AJAX 轮询：基于 XMLHttpRequest 的 AJAX 轮询&lt;/li&gt;
&lt;li&gt;AJAX 长轮询：类似轮询，服务器在客户端请求后不返回响应，直到有数据需要传到客户端，传完数据后客户端再发起新的请求。缺点是要额外传输的 HTTP 头，保持住请求不响应也需要一些额外工作。&lt;/li&gt;
&lt;li&gt;HTTP 流：与 AJAX 长轮询类似，服务端响应会带上 HTTP 头：Transfer-Encoding: chunked，返回完数据到客户端后客户端也不需要发起新的请求，缺点是各个 chunk 之间的数据难以识别和处理。&lt;/li&gt;
&lt;li&gt;插件：类似 Flash,Silverlight, 作为插件越来越被主流浏览器和用户排斥&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下面就不同角度对各技术进行分析&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;
&lt;p&gt;单向 / 双向&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;单向：AJAX 轮询，AJAX 长轮询，HTTP 流&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;双向：WebSocket, 插件&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;延时&lt;/p&gt;
&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WebSocket &amp;lt; 插件 &amp;lt; HTTP 流 &amp;lt; AJAX 长轮询 &amp;lt; AJAX 轮询&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&quot;3&quot;&gt;
&lt;li&gt;效率&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;插件 &amp;gt; WebSocket &amp;gt; HTTP 流 &amp;gt; AJAX 长轮询 &amp;gt; AJAX 轮询&lt;/code&gt;&lt;/p&gt;
&lt;ol start=&quot;4&quot;&gt;
&lt;li&gt;移动端支持&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;WebSocket: 基本均支持
HTTP 流，AJAX 长轮询，AJAX 轮询：基本均支持
插件：基本不支持&lt;/p&gt;
&lt;ol start=&quot;5&quot;&gt;
&lt;li&gt;开发或设置难易程度&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;WebSocket &amp;lt; AJAX 轮询 &amp;lt; 插件 &amp;lt; AJAX 长轮询，HTTP 流&lt;/code&gt;&lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;socket.io 封装了 WebSocket, 不支持 WebSocket 的情况还提供了降级 AJAX 轮询，功能完备，设计优雅，是开发实时双向通讯的不二手段。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[socket.io 系列二：基本应用]]></title><description><![CDATA[socket.io 提供了基于事件的实时双向通讯，本文将对其进行详细(二)]]></description><link>https://blog.sigoden.com/socket-iozhi-er-ji-ben-ying-yong/</link><guid isPermaLink="false">https://blog.sigoden.com/socket-iozhi-er-ji-ben-ying-yong/</guid><content:encoded>&lt;h2 id=&quot;服务端与客户端连接&quot;&gt;&lt;a href=&quot;#%E6%9C%8D%E5%8A%A1%E7%AB%AF%E4%B8%8E%E5%AE%A2%E6%88%B7%E7%AB%AF%E8%BF%9E%E6%8E%A5&quot; aria-label=&quot;服务端与客户端连接 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;服务端与客户端连接&lt;/h2&gt;
&lt;p&gt;socket.io 同时提供了服务端和客户端的 API&lt;/p&gt;
&lt;p&gt;服务端 socket.io 必须绑定一个 http.Server 实例&lt;/p&gt;
&lt;h2 id=&quot;绑定-httpserver&quot;&gt;&lt;a href=&quot;#%E7%BB%91%E5%AE%9A-httpserver&quot; aria-label=&quot;绑定 httpserver permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;绑定 http.Server&lt;/h2&gt;
&lt;ol&gt;
&lt;li&gt;隐式绑定&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;通过实例化时传入端口或实例化后调用&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;attach&lt;/code&gt;函数进行隐式绑定。socket.io 内部实例化并监听 http.Server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;实例化时传入端口&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let io = require(&amp;#39;socket.io&amp;#39;)(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;直接通过&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;attach&lt;/code&gt;函数绑定。&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;与&lt;code class=&quot;language-text&quot;&gt;attach&lt;/code&gt;同义&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let io = require(&amp;#39;socket.io&amp;#39;)
io.listen(3000) // io.attach(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;显示绑定&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;可以手动指定 http.Server&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;实例化时绑定&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let server = require(&amp;#39;http&amp;#39;).Server();
let io = require(&amp;#39;socket.io&amp;#39;)(server)

server.listen(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;通过&lt;code class=&quot;language-text&quot;&gt;listen&lt;/code&gt;或&lt;code class=&quot;language-text&quot;&gt;attach&lt;/code&gt;绑定&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let server = require(&amp;#39;http&amp;#39;).Server();
let io = require(&amp;#39;socket.io&amp;#39;)()

io.listen(server) // io.attach(server)

server.listen(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;可以绑定 express 或 koa 等 http 框架&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;express&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;express&amp;#39;)
let server = require(&amp;#39;http&amp;#39;).Server(app)
let io = require(&amp;#39;socket.io&amp;#39;)(server)

app.listen(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;koa&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;koa&amp;#39;)()
let server = require(&amp;#39;http&amp;#39;).Server(app.callback())

let io = require(&amp;#39;socket.io&amp;#39;)(server)

app.listen(3000)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;监听连接状态&quot;&gt;&lt;a href=&quot;#%E7%9B%91%E5%90%AC%E8%BF%9E%E6%8E%A5%E7%8A%B6%E6%80%81&quot; aria-label=&quot;监听连接状态 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;监听连接状态&lt;/h2&gt;
&lt;p&gt;当服务器端与客户端连接成功时，服务端会监听到&lt;code class=&quot;language-text&quot;&gt;connection&lt;/code&gt;和&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;事件 (connection 与 connect 同义）, 客户端会监听到&lt;code class=&quot;language-text&quot;&gt;connect&lt;/code&gt;事件，断开连接时服务端的对应到客户端的 socket 与客户端均会均会监听到&lt;code class=&quot;language-text&quot;&gt;disconnect&lt;/code&gt;事件&lt;/p&gt;
&lt;p&gt;服务端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let server = require(&amp;#39;http&amp;#39;).Server()
let io = require(&amp;#39;socket.io&amp;#39;)(server)

server.listen(3000);
io.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  console.log(&amp;#39;connect&amp;#39;)
  socket.on(&amp;#39;disconnect&amp;#39;, () =&amp;gt; {
    console.log(&amp;#39;disconnect&amp;#39;)
  })
  socket.disconnect()
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行后打印&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;connect
disconnect&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;客户端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let socket = io(&amp;#39;http://localhost:3000&amp;#39;)
socket.on(&amp;#39;connect&amp;#39;, () =&amp;gt; {
  console.log(&amp;#39;connect&amp;#39;)
})
socket.on(&amp;#39;disconnect&amp;#39;, () =&amp;gt; {
  console.log(&amp;#39;disconnect&amp;#39;)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;运行后打印&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;connect
disconnect&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;传输数据&quot;&gt;&lt;a href=&quot;#%E4%BC%A0%E8%BE%93%E6%95%B0%E6%8D%AE&quot; aria-label=&quot;传输数据 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;传输数据&lt;/h2&gt;
&lt;p&gt;服务器与客户端的 socket 是一个关联的 EventEmitter 对象，客户端 socket 派发的事件可以通以被服务端的 socket 接收，服务器端 socket 派发的事件也可以被客户端接受。基于这种机制，可以实现双向交流。&lt;/p&gt;
&lt;p&gt;现在模拟这样一种情况：客户端不停发送随机数，当随机数大于 0.95 时，服务端延时 1s 后向客户端发送警告以及警告次数&lt;/p&gt;
&lt;p&gt;服务端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let server = require(&amp;#39;http&amp;#39;).Server()
let io = require(&amp;#39;socket.io&amp;#39;)(server)

server.listen(3000);
io.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  socket.on(&amp;#39;random&amp;#39;, value =&amp;gt; {
    console.log(value)
    if (value &amp;gt; 0.95) {
      if (typeof socket.warning === &amp;#39;undefined&amp;#39;) socket.warning = 0
      setTimeout(() =&amp;gt; {
        socket.emit(&amp;#39;warn&amp;#39;, ++socket.warning)
      }, 1000)
    }
  })
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;socket 对象可以用来存储状态信息和自定义数据，如&lt;code class=&quot;language-text&quot;&gt;socket.warning&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;客户端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let socket = io(&amp;#39;http://localhost:3000&amp;#39;)
let interval = setInterval(() =&amp;gt; {
  socket.emit(&amp;#39;random&amp;#39;, Math.random())
}, 500)
socket.on(&amp;#39;warn&amp;#39;, count =&amp;gt; {
  console.log(&amp;#39;warning count: &amp;#39; + count)
})
socket.on(&amp;#39;disconnect&amp;#39;, () =&amp;gt; {
  clearInterval(interval)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;传输流&quot;&gt;&lt;a href=&quot;#%E4%BC%A0%E8%BE%93%E6%B5%81&quot; aria-label=&quot;传输流 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;传输流&lt;/h2&gt;
&lt;p&gt;socket.io 可以处理流&lt;/p&gt;
&lt;p&gt;服务端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.on(&amp;#39;connection&amp;#39;, function (socket) {
  let stream = ss.createStream()
  ss(socket).emit(&amp;#39;script&amp;#39;, stream)
  fs.createReadStream(__filename).pipe(stream)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;客户端代码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let socket = io(&amp;#39;http://localhost:3000&amp;#39;)
ss(socket).on(&amp;#39;script&amp;#39;, stream =&amp;gt; {
  let buffer = &amp;#39;&amp;#39;
  stream.on(&amp;#39;data&amp;#39;, data =&amp;gt; {
    buffer += data.toString()
  })
  stream.on(&amp;#39;end&amp;#39;, () =&amp;gt; {
    console.log(buffer)
  })
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[socket.io 系列三：深入学习]]></title><description><![CDATA[socket.io 提供了基于事件的实时双向通讯，本文将对其进行详细介绍(三)]]></description><link>https://blog.sigoden.com/socket-iozhi-san-shen-ru-xue-xi/</link><guid isPermaLink="false">https://blog.sigoden.com/socket-iozhi-san-shen-ru-xue-xi/</guid><content:encoded>&lt;h2 id=&quot;静态文件&quot;&gt;&lt;a href=&quot;#%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6&quot; aria-label=&quot;静态文件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;静态文件&lt;/h2&gt;
&lt;p&gt;socket.io 默认情况下会通过 socket.io-client 包提供 socket.io.min.js 和 socket.io.js.map 下载
运行实例 app.js&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app)

app.listen(3000);&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;浏览器访问&lt;code class=&quot;language-text&quot;&gt;http://localhost:3000/socket.io/socket.io.js&lt;/code&gt;可以加载压缩的源码，访问&lt;code class=&quot;language-text&quot;&gt;http://localhost:3000/socket.io/socket.io.js.map&lt;/code&gt;加载 sourcemap&lt;/p&gt;
&lt;p&gt;我们可以改变这种行为&lt;/p&gt;
&lt;h3 id=&quot;禁用-socketiojs-下载&quot;&gt;&lt;a href=&quot;#%E7%A6%81%E7%94%A8-socketiojs-%E4%B8%8B%E8%BD%BD&quot; aria-label=&quot;禁用 socketiojs 下载 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;禁用 socket.io.js 下载&lt;/h3&gt;
&lt;p&gt;方法 1: 实例化时传入控制参数&lt;code class=&quot;language-text&quot;&gt;serveClient&lt;/code&gt;值 false&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let io = require(&amp;#39;socket.io&amp;#39;)(app, {
  serveClient: false
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;方法 2: 调用函数&lt;code class=&quot;language-text&quot;&gt;serverClient&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)()
io.serveClient(false)
io.listen(app) // 或者 io.attach(app)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;如果在调用函数前服务已绑定 http.Server, 该方法将不起作用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;禁用后再次访问将提示&lt;code class=&quot;language-text&quot;&gt;{&amp;quot;code&amp;quot;:0,&amp;quot;message&amp;quot;:&amp;quot;Transport unknown&amp;quot;}&lt;/code&gt;&lt;/p&gt;
&lt;h3 id=&quot;修改静态文件路径&quot;&gt;&lt;a href=&quot;#%E4%BF%AE%E6%94%B9%E9%9D%99%E6%80%81%E6%96%87%E4%BB%B6%E8%B7%AF%E5%BE%84&quot; aria-label=&quot;修改静态文件路径 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;修改静态文件路径&lt;/h3&gt;
&lt;p&gt;socket.io.js 路径可以改变，其默认路径为 /socket.io。&lt;/p&gt;
&lt;p&gt;实例化时传参&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let io = require(&amp;#39;socket.io&amp;#39;)(app, {
  path: &amp;#39;/io&amp;#39;
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;调用函数&lt;code class=&quot;language-text&quot;&gt;path&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)()
io.path(&amp;#39;/io&amp;#39;)
io.listen(app)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;如果在调用函数前服务已绑定 http.Server, 该方法将不起作用&lt;/p&gt;
&lt;/blockquote&gt;
&lt;h2 id=&quot;安全策略&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E5%85%A8%E7%AD%96%E7%95%A5&quot; aria-label=&quot;安全策略 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安全策略&lt;/h2&gt;
&lt;p&gt;socket.io 提供了两种安全策略&lt;/p&gt;
&lt;h3 id=&quot;allowrequest&quot;&gt;&lt;a href=&quot;#allowrequest&quot; aria-label=&quot;allowrequest permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;allowRequest&lt;/h3&gt;
&lt;p&gt;函数&lt;code class=&quot;language-text&quot;&gt;allowRequest&lt;/code&gt;有两个参数，第一个参数为收到的握手包 (http.request) 对象，作为判断依据，success), err 是错误对象，success 为 boolean, false 表示阻止建立连接&lt;/p&gt;
&lt;p&gt;前端请求带上 token&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let socket = io(&amp;#39;http://localhost:3000?token=abc&amp;#39;)
socket.on(&amp;#39;connect&amp;#39;, () =&amp;gt; {
  console.log(&amp;#39;connect&amp;#39;)
})
socket.on(&amp;#39;connect_error&amp;#39;, err =&amp;gt; {
  socket.disconnect()
  console.log(&amp;#39;connect_error&amp;#39;, err)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;后端 allowRequest 根据 token 判断是否继续&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app, {
  allowRequest: (req, cb) =&amp;gt; {
    if (req._query &amp;amp;&amp;amp; req._query.token === &amp;#39;abc&amp;#39;) return cb(null, true)
    cb(null, false)
  }
});&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;origins&quot;&gt;&lt;a href=&quot;#origins&quot; aria-label=&quot;origins permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;origins&lt;/h3&gt;
&lt;p&gt;可以对源进行限制&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;实例化时限制源&lt;/li&gt;
&lt;/ol&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app, {
  origins: &amp;#39;http://localhost:3000&amp;#39;
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ol start=&quot;2&quot;&gt;
&lt;li&gt;origins 函数设置源&lt;/li&gt;
&lt;/ol&gt;
&lt;p&gt;origins 函数有两种形式
origins(string):  设置运行的源
origins(string, fn(err, success)): 通过函数判断源是否允许&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.origins(&amp;#39;http://localhost:*&amp;#39;)

io.origins((origin, cb) =&amp;gt; {
  if (origin === &amp;#39;http://localhost:3000/&amp;#39;) return cb(null, true)
  cb(null, false)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;名称空间&quot;&gt;&lt;a href=&quot;#%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4&quot; aria-label=&quot;名称空间 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;名称空间&lt;/h2&gt;
&lt;p&gt;名称空间用来对服务端 / 客户端的连接隔离，有些地方，也称呼名称空间 (namespace) 为通道 (channel)。下面举例对其意义进行说明&lt;/p&gt;
&lt;p&gt;我们需要实现一个协同应用，这个应用有两个功能：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;协同编辑：多个用户可以同时编辑一个文档&lt;/li&gt;
&lt;li&gt;消息：用户间可以发送消息&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;用 socket.io 实现这个应用，有如下几种形式&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;完全独立：协同编辑有一个独立服务 edit.socket.test, 消息系统一个独立服务 message.socket.test&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let editSocket = io(&amp;#39;edit.socket.test&amp;#39;)
let messageSocket = io(&amp;#39;message.socket.test&amp;#39;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;名称空间：只运行一个独立服务，通过名称空间进行隔离&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app)
let editServer = io.of(&amp;#39;/edit&amp;#39;)
let messsageServer = io.of(&amp;#39;/message&amp;#39;)
editServer.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  // 编辑相关
})
messsageServer.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  / 消息相关
})

let editSocket = io(&amp;#39;socket.test/edit&amp;#39;)
let messageSocket = io(&amp;#39;socket.test/message&amp;#39;)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;事件名约定：通过为事件名添加进行隔离&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app)

io.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  // 编辑相关
  io.emit(&amp;#39;edit:test&amp;#39;)
  io.on(&amp;#39;edit:test&amp;#39;, data =&amp;gt; {

  })
  // 消息相关
  io.emit(&amp;#39;message:test&amp;#39;)
  io.on(&amp;#39;message:test&amp;#39;, data =&amp;gt; {

  })
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;通过事件名约定程序的侵入性太大，不利于拆分和重组，不推荐。 而完全独立的模式需要使用两个 socket 连接，即浪费浏览器允许的并发连接数，又更多消耗服务器资源。使用名称空间即能实现很好的隔离，又不会对资源造成浪费。&lt;/p&gt;
&lt;h3 id=&quot;默认名称空间&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E5%90%8D%E7%A7%B0%E7%A9%BA%E9%97%B4&quot; aria-label=&quot;默认名称空间 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认名称空间&lt;/h3&gt;
&lt;p&gt;socket.io 实例化时自动绑定路径为&lt;code class=&quot;language-text&quot;&gt;/&lt;/code&gt;的名称空间&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;let app = require(&amp;#39;http&amp;#39;).createServer()
let io = require(&amp;#39;socket.io&amp;#39;)(app)

io.sockets // io.of(&amp;#39;/&amp;#39;).sockets
io.emit // 代理 io.of(&amp;#39;/&amp;#39;).emit, 类似函数有&amp;#39;to&amp;#39;, &amp;#39;in&amp;#39;, &amp;#39;use&amp;#39;, &amp;#39;send&amp;#39;, &amp;#39;write&amp;#39;, &amp;#39;clients&amp;#39;, &amp;#39;compress&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;中间件&quot;&gt;&lt;a href=&quot;#%E4%B8%AD%E9%97%B4%E4%BB%B6&quot; aria-label=&quot;中间件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;中间件&lt;/h2&gt;
&lt;p&gt;socket.io 的名空间通过 use 注册中间件，中间件在客户端与服务端建立连接成功后，connet 事件派发前调用&lt;strong&gt;一次&lt;/strong&gt;。&lt;/p&gt;
&lt;p&gt;利用中间件数据校验&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.use((socket, next) =&amp;gt; {
  if (socket.request.headers.cookie) return next()
  next(new Error(&amp;#39;Authentication error&amp;#39;))
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;利用中间件提取或转换数据&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.use((socket, next) =&amp;gt; {
  getInfo(socket.request.query.id, (err, data) =&amp;gt; {
    if (err) return next(err)
	socket.custom = data
	next()
  })
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;与-allowrequest-对比&quot;&gt;&lt;a href=&quot;#%E4%B8%8E-allowrequest-%E5%AF%B9%E6%AF%94&quot; aria-label=&quot;与 allowrequest 对比 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;与 allowRequest 对比&lt;/h3&gt;
&lt;p&gt;allowRequest 可以进行一些校验，提取，为什么还要需要中间件？&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;allowRequest 传入的 http.request 实例，而中间件出入数据 socket 实例，socket 实例包含 request 实例，且有更多信息&lt;/li&gt;
&lt;li&gt;中间件直接支持多个异步流程嵌套，而 allowRequest 需要自己实现&lt;/li&gt;
&lt;/ol&gt;
&lt;h3 id=&quot;与-connection-事件对比&quot;&gt;&lt;a href=&quot;#%E4%B8%8E-connection-%E4%BA%8B%E4%BB%B6%E5%AF%B9%E6%AF%94&quot; aria-label=&quot;与 connection 事件对比 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;与 connection 事件对比&lt;/h3&gt;
&lt;p&gt;connection 事件也传入 socket, 也可以进行数验，提取，为什么还要需要中间件？&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;中间件直接支持多个异步流程嵌套，而 allowRequest 需要自己实现&lt;/li&gt;
&lt;li&gt;中间件成功后到 connection 事件发送成功前，socket.io 还做了一些工作，比如把 socket 实例添加到 connected 对象中，加入聊天室等。如果因为权限中断连接，在中间件中处理更省资源。&lt;/li&gt;
&lt;/ol&gt;
&lt;h2 id=&quot;聊天室&quot;&gt;&lt;a href=&quot;#%E8%81%8A%E5%A4%A9%E5%AE%A4&quot; aria-label=&quot;聊天室 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;聊天室&lt;/h2&gt;
&lt;p&gt;聊天室是对当前连接的 socket 集合根据特定规则进行归组，方便群发消息。可以类比 QQ 群的概率。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;socket.join(&amp;#39;room name&amp;#39;) // 进入
socket.leave(&amp;#39;room name&amp;#39;) // 退出&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.to(&amp;#39;some room&amp;#39;).emit(&amp;#39;some event&amp;#39;) // io.to 与 io.in 同义，向某个聊天室的所有成员发送消息&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;默认聊天室&quot;&gt;&lt;a href=&quot;#%E9%BB%98%E8%AE%A4%E8%81%8A%E5%A4%A9%E5%AE%A4&quot; aria-label=&quot;默认聊天室 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;默认聊天室&lt;/h3&gt;
&lt;p&gt;每个 socket 在连接成功后会自动创建一个默认个聊天室，这个聊天室的名字是当前 socket 的 id, 可以通过默认聊天室实现向特定用户发送消息&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;socket.on(&amp;#39;say to someone&amp;#39;, (id, msg) =&amp;gt; {
  socket.broadcast.to(id).emit(&amp;#39;my message&amp;#39;, msg)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;消息发送&quot;&gt;&lt;a href=&quot;#%E6%B6%88%E6%81%AF%E5%8F%91%E9%80%81&quot; aria-label=&quot;消息发送 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;消息发送&lt;/h2&gt;
&lt;h3 id=&quot;应答消息&quot;&gt;&lt;a href=&quot;#%E5%BA%94%E7%AD%94%E6%B6%88%E6%81%AF&quot; aria-label=&quot;应答消息 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;应答消息&lt;/h3&gt;
&lt;p&gt;普通消息不需要回应，而应答消息提供了应答机制&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;io.on(&amp;#39;connection&amp;#39;, socket =&amp;gt; {
  socket.emit(&amp;#39;an event&amp;#39;, { some: &amp;#39;data&amp;#39; }) // 普通消息

  socket.emit(&amp;#39;ferret&amp;#39;, &amp;#39;tobi&amp;#39;, function (data) { // 应答消息
    console.log(data); // data will be &amp;#39;woot&amp;#39;
  })
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;socket.on(&amp;#39;ferret&amp;#39;, (name, fn) =&amp;gt; {
  fn(&amp;#39;woot&amp;#39;)
})&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;压缩&quot;&gt;&lt;a href=&quot;#%E5%8E%8B%E7%BC%A9&quot; aria-label=&quot;压缩 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;压缩&lt;/h3&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;socket.compress(true)&lt;/code&gt;启用压缩，调用后当前连接的所有数据在传递给客户端前都会进行压缩&lt;/p&gt;
&lt;h3 id=&quot;volatile-标志&quot;&gt;&lt;a href=&quot;#volatile-%E6%A0%87%E5%BF%97&quot; aria-label=&quot;volatile 标志 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;volatile 标志&lt;/h3&gt;
&lt;p&gt;socket.io 在正常情况下对发送的消息进行追踪，确保消息发送成功，而设置 volatile 后发送消息，socket.io 不会对消息追踪，消息可能丢失&lt;/p&gt;
&lt;h3 id=&quot;分类&quot;&gt;&lt;a href=&quot;#%E5%88%86%E7%B1%BB&quot; aria-label=&quot;分类 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;分类&lt;/h3&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;// 客户端发送消息
socket.emit(&amp;#39;hello&amp;#39;, &amp;#39;can you hear me?&amp;#39;, 1, 2, &amp;#39;abc&amp;#39;);

// 向所有连接的客户端（除了自己）发送消息
socket.broadcast.emit(&amp;#39;broadcast&amp;#39;, &amp;#39;hello friends!&amp;#39;);

// 向 game 聊天室发送消息，自己不算
socket.to(&amp;#39;game&amp;#39;).emit(&amp;#39;nice game&amp;#39;, &amp;quot;let&amp;#39;s play a game&amp;quot;);

// 同时向 game1 和 game2 聊天室发送消息，自己不算
socket.to(&amp;#39;game1&amp;#39;).to(&amp;#39;game2&amp;#39;).emit(&amp;#39;nice game&amp;#39;, &amp;quot;let&amp;#39;s play a game (too)&amp;quot;);

// 向 game 聊天室的所有人发送消息
io.in(&amp;#39;game&amp;#39;).emit(&amp;#39;big-announcement&amp;#39;, &amp;#39;the game will start soon&amp;#39;);

// 发送消息到&amp;lt;socketid&amp;gt;客户端
socket.to(&amp;lt;socketid&amp;gt;).emit(&amp;#39;hey&amp;#39;, &amp;#39;I just met you&amp;#39;);

// 发送应答消息
socket.emit(&amp;#39;question&amp;#39;, &amp;#39;do you think so?&amp;#39;, function (answer) {});&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[探究 logstash grok 文本解析]]></title><description><![CDATA[Logstash 常用于 ELK 栈(在日志处理领域被广泛使用), 主要负责数据的收集，处理，转发。而 grok 是 filters 模块中一个文本正则解析插件。只有理解了 grok, 我们才能从容应对各种各样的日志内容，本文结合实例详细分析了如何使用 grok。]]></description><link>https://blog.sigoden.com/logstash-grok-wen-ben-jie-xi/</link><guid isPermaLink="false">https://blog.sigoden.com/logstash-grok-wen-ben-jie-xi/</guid><content:encoded>&lt;h2 id=&quot;试错环境&quot;&gt;&lt;a href=&quot;#%E8%AF%95%E9%94%99%E7%8E%AF%E5%A2%83&quot; aria-label=&quot;试错环境 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;试错环境&lt;/h2&gt;
&lt;p&gt;文本的解析规则的编写相对来说还是挺复杂的，我们需要搭建一个调试环境，以便我们试错。&lt;/p&gt;
&lt;p&gt;配置 logstash 从标准终端输入中读取数据，grok 解析后，rubydebug 编码后打印到标准终端。&lt;/p&gt;
&lt;p&gt;对应配置文件 logstash.conf 如下&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;input {
	stdin {
	}
}

filter {
	grok {
		match =&amp;gt; {
			&amp;quot;message&amp;quot; =&amp;gt; &amp;#39;%{DATA}&amp;#39;
		}
	}
}

output {
  stdout { codec =&amp;gt; rubydebug }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;Logstash 进行了分层设计，input 模块进行日志接受，filters 模块进行日志处理，output 模块进行日志转发，此外还提供了 codecs 模块可以对输入输出信息进行编码解码。各层在配置中也存在着对应。&lt;/p&gt;
&lt;p&gt;rubydebug 用来输出结构化数据。&lt;/p&gt;
&lt;p&gt;启动 logstash&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;logstash -f logstash.conf&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;logstash 成功启动后，终端中输入&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;hello&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;logstash 将打印&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &amp;quot;@timestamp&amp;quot; =&amp;gt; 2017-04-08T03:08:10.999Z,
      &amp;quot;@version&amp;quot; =&amp;gt; &amp;quot;1&amp;quot;,
          &amp;quot;host&amp;quot; =&amp;gt; &amp;quot;612edb7645b3&amp;quot;,
       &amp;quot;message&amp;quot; =&amp;gt; &amp;quot;hello&amp;quot;,
          &amp;quot;tags&amp;quot; =&amp;gt; []
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;整个试错环境运行成功&lt;/p&gt;
&lt;h2 id=&quot;解析规则&quot;&gt;&lt;a href=&quot;#%E8%A7%A3%E6%9E%90%E8%A7%84%E5%88%99&quot; aria-label=&quot;解析规则 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;解析规则&lt;/h2&gt;
&lt;h3 id=&quot;正则规则&quot;&gt;&lt;a href=&quot;#%E6%AD%A3%E5%88%99%E8%A7%84%E5%88%99&quot; aria-label=&quot;正则规则 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;正则规则&lt;/h3&gt;
&lt;p&gt;grok 使用的是 &lt;a href=&quot;https://raw.githubusercontent.com/kkos/oniguruma/master/doc/RE&quot;&gt;Oniguruma 正则&lt;/a&gt; 来解析文本&lt;/p&gt;
&lt;h3 id=&quot;命名正则&quot;&gt;&lt;a href=&quot;#%E5%91%BD%E5%90%8D%E6%AD%A3%E5%88%99&quot; aria-label=&quot;命名正则 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;命名正则&lt;/h3&gt;
&lt;p&gt;命名正则顾名思义就是定义了名字的正则规则&lt;/p&gt;
&lt;p&gt;logstash 内置了一些&lt;a href=&quot;https://github.com/logstash-plugins/logstash-patterns-core/tree/master/patterns&quot;&gt;命名正则&lt;/a&gt;&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;定义&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;DATA .*?&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;给规则&lt;code class=&quot;language-text&quot;&gt;.*?&lt;/code&gt;命名 DATA。&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;命名正则用法&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;%{SYNTAX:SEMANTIC:TYPE}

# 例子
# %{INT:count:int}
# %{Number:rate:float}
# %{DATA:upstream}
# %{DATA}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;SYNTAX: 命名正则&lt;/li&gt;
&lt;li&gt;SEMANTIC: 通过正则解析出来的结构化数据对应的键值，省略时表示仅匹配但不做解析&lt;/li&gt;
&lt;li&gt;TYPE: 通过正则解析出来的结构化数据对应的类型，省略时表示类型为字符串，当前支持的可选值为 int 和 float&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;实例&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;修改&lt;code class=&quot;language-text&quot;&gt;logstash.conf&lt;/code&gt;中的 message 字段&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;message&amp;quot; =&amp;gt; &amp;#39;%{INT:count:int}&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启 logstash 后，终端输入&lt;code class=&quot;language-text&quot;&gt;3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;可以看到输出&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &amp;quot;@timestamp&amp;quot; =&amp;gt; 2017-04-08T03:39:40.205Z,
      &amp;quot;@version&amp;quot; =&amp;gt; &amp;quot;1&amp;quot;,
          &amp;quot;host&amp;quot; =&amp;gt; &amp;quot;612edb7645b3&amp;quot;,
         &amp;quot;count&amp;quot; =&amp;gt; 3,
       &amp;quot;message&amp;quot; =&amp;gt; &amp;quot;3&amp;quot;,
          &amp;quot;tags&amp;quot; =&amp;gt; []
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;输出中多了一个字段&lt;code class=&quot;language-text&quot;&gt;count&lt;/code&gt;, 其值为&lt;code class=&quot;language-text&quot;&gt;3&lt;/code&gt;。grok 解析并添加字段 count, 其值为整数 3&lt;/p&gt;
&lt;h3 id=&quot;直接使用正则&quot;&gt;&lt;a href=&quot;#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%88%99&quot; aria-label=&quot;直接使用正则 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;直接使用正则&lt;/h3&gt;
&lt;p&gt;除了使用命名正则外，我们也可以直接使用正则&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;message&amp;quot; =&amp;gt; &amp;#39;[0-9]+&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果需要提取数据到结构化对象中，可以使用如下规则&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;(?&amp;lt;SEMANTIC&amp;gt;RULE)

# e.g
(?&amp;lt;count&amp;gt;[0-9]+)&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;配置 logstash.conf&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;message&amp;quot; =&amp;gt; &amp;#39;(?&amp;lt;count&amp;gt;[0-9]+)&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;重启后输入&lt;code class=&quot;language-text&quot;&gt;3&lt;/code&gt;&lt;/p&gt;
&lt;p&gt;logstash 打印&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
    &amp;quot;@timestamp&amp;quot; =&amp;gt; 2017-04-08T04:17:33.670Z,
      &amp;quot;@version&amp;quot; =&amp;gt; &amp;quot;1&amp;quot;,
          &amp;quot;host&amp;quot; =&amp;gt; &amp;quot;612edb7645b3&amp;quot;,
         &amp;quot;count&amp;quot; =&amp;gt; &amp;quot;3&amp;quot;,
       &amp;quot;message&amp;quot; =&amp;gt; &amp;quot;3&amp;quot;,
          &amp;quot;tags&amp;quot; =&amp;gt; []
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;实战&quot;&gt;&lt;a href=&quot;#%E5%AE%9E%E6%88%98&quot; aria-label=&quot;实战 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;实战&lt;/h2&gt;
&lt;p&gt;下面进行 nginx 错误日志解析&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;参考日志数据&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;2017/04/08 00:48:07 [error] 24175#24175: *573179 open() &amp;quot;/www/README.html&amp;quot; failed (2: No such file or directory), client: 220.181.51.93, server: www.baicaiyun.cn, request: &amp;quot;GET /README.html HTTP/1.1&amp;quot;, host: &amp;quot;www.example.com&amp;quot;

2017/04/07 18:09:33 [error] 24174#24174: *571806 connect() failed (111: Connection refused) while connecting to upstream, client: 113.99.120.208, server: www.example.com, request: &amp;quot;GET /api/user/3332432/info HTTP/1.1&amp;quot;, upstream: &amp;quot;http://10.46.122.16:8081/v1/ordersheet/3332432/info&amp;quot;, host: &amp;quot;www.example.com&amp;quot;, referrer: &amp;quot;http://www.example.com/user&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;strong&gt;分析上面数据&lt;/strong&gt;&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;时间：&lt;code class=&quot;language-text&quot;&gt;2017/04/07 18:09:33&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;timestamp =&amp;gt; 2017/04/07 18:09:33&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;错误级别：&lt;code class=&quot;language-text&quot;&gt;[error]&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;severity =&amp;gt; error&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;进程信息：&lt;code class=&quot;language-text&quot;&gt;24175#24175&lt;/code&gt;, 不需要结构化&lt;/li&gt;
&lt;li&gt;错误信息：&lt;code class=&quot;language-text&quot;&gt;*573179 open() &amp;quot;/www/README.html&amp;quot; failed (2: No such file or directory),&lt;/code&gt;　需要结构化&lt;code class=&quot;language-text&quot;&gt;errormessage =&amp;gt; *573179 open() &amp;quot;/www/README.html&amp;quot; failed (2: No such file or directory)&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;客户端 IP: &lt;code class=&quot;language-text&quot;&gt;client: 220.181.51.93,&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;clientip =&amp;gt; 220.181.51.93&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;服务名：&lt;code class=&quot;language-text&quot;&gt;server: www.example.com&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;server =&amp;gt; www.example.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;上行『可选』: &lt;code class=&quot;language-text&quot;&gt;upstream: &amp;quot;http://10.46.122.16:8081/v1/ordersheet/3332432/info&amp;quot;,&lt;/code&gt;, 不需要结构化&lt;/li&gt;
&lt;li&gt;访问域名：&lt;code class=&quot;language-text&quot;&gt;host: &amp;quot;www.example.com&amp;quot;&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;hostname =&amp;gt; www.example.com&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;Referrer『可选』: &lt;code class=&quot;language-text&quot;&gt;, referrer: &amp;quot;http://www.example.com/user&amp;quot;&lt;/code&gt;, 需要结构化&lt;code class=&quot;language-text&quot;&gt;referrer =&amp;gt; http://www.example.com/use&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;&lt;strong&gt;编写正则规则&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;quot;message&amp;quot; =&amp;gt; &amp;#39;(?&amp;lt;timestamp&amp;gt;%{YEAR}/%{MONTHNUM}/%{MONTHDAY} %{TIME}) \[%{LOGLEVEL:severity}\] %{POSINT}#%{NUMBER}: %{GREEDYDATA:errormessage}, client: %{IP:clientip}, server: %{DATA}, request: \&amp;quot;%{WORD:verb} %{GREEDYDATA:request} HTTP/%{NUMBER:httpversion}\&amp;quot;(?:, upstream: \&amp;quot;%{DATA}\&amp;quot;)?, host: \&amp;quot;%{HOSTNAME:hostname}\&amp;quot;(?:, referrer: \&amp;quot;%{DATA:referrer}\&amp;quot;)?&amp;#39;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;第一条数据解析结果&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
        &amp;quot;severity&amp;quot; =&amp;gt; &amp;quot;error&amp;quot;,
    &amp;quot;errormessage&amp;quot; =&amp;gt; &amp;quot;*573179 open() \&amp;quot;/www/README.html\&amp;quot; failed (2: No such file or directory)&amp;quot;,
         &amp;quot;request&amp;quot; =&amp;gt; &amp;quot;/README.html&amp;quot;,
            &amp;quot;verb&amp;quot; =&amp;gt; &amp;quot;GET&amp;quot;,
         &amp;quot;message&amp;quot; =&amp;gt; &amp;quot;2017/04/08 00:48:07 [error] 24175#24175: *573179 open() \&amp;quot;/www/README.html\&amp;quot; failed (2: No such file or directory), client: 220.181.51.93, server: www.baicaiyun.cn, request: \&amp;quot;GET /README.html HTTP/1.1\&amp;quot;, host: \&amp;quot;www.example.com\&amp;quot;&amp;quot;,
            &amp;quot;tags&amp;quot; =&amp;gt; [],
        &amp;quot;hostname&amp;quot; =&amp;gt; &amp;quot;www.example.com&amp;quot;,
      &amp;quot;@timestamp&amp;quot; =&amp;gt; 2017-04-08T04:41:52.336Z,
        &amp;quot;clientip&amp;quot; =&amp;gt; &amp;quot;220.181.51.93&amp;quot;,
        &amp;quot;@version&amp;quot; =&amp;gt; &amp;quot;1&amp;quot;,
            &amp;quot;host&amp;quot; =&amp;gt; &amp;quot;612edb7645b3&amp;quot;,
     &amp;quot;httpversion&amp;quot; =&amp;gt; &amp;quot;1.1&amp;quot;,
       &amp;quot;timestamp&amp;quot; =&amp;gt; &amp;quot;2017/04/08 00:48:07&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;第二条数据解析结果&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;{
        &amp;quot;severity&amp;quot; =&amp;gt; &amp;quot;error&amp;quot;,
    &amp;quot;errormessage&amp;quot; =&amp;gt; &amp;quot;*571806 connect() failed (111: Connection refused) while connecting to upstream&amp;quot;,
         &amp;quot;request&amp;quot; =&amp;gt; &amp;quot;/api/user/3332432/info&amp;quot;,
            &amp;quot;verb&amp;quot; =&amp;gt; &amp;quot;GET&amp;quot;,
         &amp;quot;message&amp;quot; =&amp;gt; &amp;quot;2017/04/07 18:09:33 [error] 24174#24174: *571806 connect() failed (111: Connection refused) while connecting to upstream, client: 113.99.120.208, server: www.example.com, request: \&amp;quot;GET /api/user/3332432/info HTTP/1.1\&amp;quot;, upstream: \&amp;quot;http://10.46.122.16:8081/v1/ordersheet/3332432/info\&amp;quot;, host: \&amp;quot;www.example.com\&amp;quot;, referrer: \&amp;quot;http://www.example.com/user\&amp;quot;&amp;quot;,
            &amp;quot;tags&amp;quot; =&amp;gt; [],
        &amp;quot;referrer&amp;quot; =&amp;gt; &amp;quot;http://www.example.com/user&amp;quot;,
        &amp;quot;hostname&amp;quot; =&amp;gt; &amp;quot;www.example.com&amp;quot;,
      &amp;quot;@timestamp&amp;quot; =&amp;gt; 2017-04-08T04:48:36.250Z,
        &amp;quot;clientip&amp;quot; =&amp;gt; &amp;quot;113.99.120.208&amp;quot;,
        &amp;quot;@version&amp;quot; =&amp;gt; &amp;quot;1&amp;quot;,
            &amp;quot;host&amp;quot; =&amp;gt; &amp;quot;612edb7645b3&amp;quot;,
     &amp;quot;httpversion&amp;quot; =&amp;gt; &amp;quot;1.1&amp;quot;,
       &amp;quot;timestamp&amp;quot; =&amp;gt; &amp;quot;2017/04/07 18:09:33&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[我们该以何种风格写 javascript]]></title><description><![CDATA[JavaScript 是一种多范式的灵活的动态语言，为了强化协作，我们常常需要再项目中选定一种风格，如何选择呢？]]></description><link>https://blog.sigoden.com/javascriptbiao-zhun-dai-ma-feng-ge/</link><guid isPermaLink="false">https://blog.sigoden.com/javascriptbiao-zhun-dai-ma-feng-ge/</guid><content:encoded>&lt;h2 id=&quot;你需要一份代码风格&quot;&gt;&lt;a href=&quot;#%E4%BD%A0%E9%9C%80%E8%A6%81%E4%B8%80%E4%BB%BD%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC&quot; aria-label=&quot;你需要一份代码风格 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;你需要一份代码风格&lt;/h2&gt;
&lt;p&gt;良好的代码风格，不仅仅有助于自己在以后阅读的时候能够方便简单的读懂，也是方便他人阅读理解。尤其是在团队合作的时候，如果每个人都很随意的自己用自己的方式，不仅不好维护，互相也不能理解代码意思。这样反而拖延工作量，浪费时间，降低效率。不同的代码风格严重时也可能造成纷争，影响团队和谐。&lt;/p&gt;
&lt;h2 id=&quot;你需要代码检查工具&quot;&gt;&lt;a href=&quot;#%E4%BD%A0%E9%9C%80%E8%A6%81%E4%BB%A3%E7%A0%81%E6%A3%80%E6%9F%A5%E5%B7%A5%E5%85%B7&quot; aria-label=&quot;你需要代码检查工具 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;你需要代码检查工具&lt;/h2&gt;
&lt;p&gt;代码风格如果不被遵守，就完全没有意义。如何确保每个人写出来的代码都符合你所定义的风格，这就需要工具了。eslint 是 javascript 社区最优秀的代码风格检查工具。它提供了一套相当完善的插件机制，可以自由的扩展，动态加载配置规则，同时可以方便的根据报错定位到具体的规则配置。每一条代码风格都是可以通过 eslint 配置的。&lt;/p&gt;
&lt;h2 id=&quot;你需要强制你的项目使用一种风格&quot;&gt;&lt;a href=&quot;#%E4%BD%A0%E9%9C%80%E8%A6%81%E5%BC%BA%E5%88%B6%E4%BD%A0%E7%9A%84%E9%A1%B9%E7%9B%AE%E4%BD%BF%E7%94%A8%E4%B8%80%E7%A7%8D%E9%A3%8E%E6%A0%BC&quot; aria-label=&quot;你需要强制你的项目使用一种风格 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;你需要强制你的项目使用一种风格&lt;/h2&gt;
&lt;p&gt;比选则代码风格更重要的是坚持。只有坚守一种代码风格，我们才能享受到统一的便利。如何强制大家使用一份代码风格呢？&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;如果使用 webpack, 需要再 webpack 中配置 eslint&lt;/li&gt;
&lt;li&gt;在 package.json 中添加钩子如 pretest, prebuild, prepublish, 强制在特点操作前运行 eslint 检查代码风格。&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;常用代码风格&quot;&gt;&lt;a href=&quot;#%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E9%A3%8E%E6%A0%BC&quot; aria-label=&quot;常用代码风格 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;常用代码风格&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://standardjs.com/&quot;&gt;standard&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/airbnb/javascript&quot;&gt;aribnb&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://github.com/google/eslint-config-google&quot;&gt;google&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;这里分享一个技巧:&lt;/p&gt;
&lt;p&gt;在配置完成之后，如果检查发现问题，可以尝试通过 &lt;code class=&quot;language-text&quot;&gt;eslint --fix&lt;/code&gt; 自动修复一下代付风格方面的错误。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[BashScript 参数替换完全指南]]></title><description><![CDATA[如何设置默认变量，如何进行字符截取，如何对变量应用正则进行检测和替换，这些都可以通过 BashScript 参数替换实现。]]></description><link>https://blog.sigoden.com/shell-can-shu-ti-huan/</link><guid isPermaLink="false">https://blog.sigoden.com/shell-can-shu-ti-huan/</guid><content:encoded>&lt;h2 id=&quot;parameter&quot;&gt;&lt;a href=&quot;#parameter&quot; aria-label=&quot;parameter permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${parameter}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;等同 $paramter，常见于拼接字符串时，使变量表述更清晰&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;shell&quot;&gt;&lt;pre class=&quot;language-shell&quot;&gt;&lt;code class=&quot;language-shell&quot;&gt;var&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;1
var_default&lt;span class=&quot;token operator&quot;&gt;=&lt;/span&gt;2
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;${var}&lt;/span&gt;_default &lt;span class=&quot;token comment&quot;&gt;# 1&lt;/span&gt;
&lt;span class=&quot;token keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;token variable&quot;&gt;$var_default&lt;/span&gt; &lt;span class=&quot;token comment&quot;&gt;# 2&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;parameter-default-parameter-default&quot;&gt;&lt;a href=&quot;#parameter-default-parameter-default&quot; aria-label=&quot;parameter default parameter default permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${parameter-default}, ${parameter:-default}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;如果参数 parameter 没有设置，使用 default 值&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=1
var2=2
echo ${var3-$var1} # 1
echo ${var2-$var1} # 2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;${parameter:-default}与 ${parameter-default}不同之处在于： parameter 声明了但为空时， ${parameter-default}认为 parameter 已设置，而 ${parameter:-default}认为 parameter 没有设置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=
echo ${var1-1} # 空
echo ${var1:-1} # 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;parameterdefault-parameterdefault&quot;&gt;&lt;a href=&quot;#parameterdefault-parameterdefault&quot; aria-label=&quot;parameterdefault parameterdefault permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${parameter=default}, ${parameter:=default}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;如果参数 parameter 没有设置，设置 parameter 值为 default, 并返回 default&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=1
echo ${var1=2} # 1
echo ${var2=2} # 2
echo $var2 # 2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;{parameter=default}与 ${parameter-default}不同之处在于：parameter 没有设置时，{parameter=default}返回 default 的同时设置参数 parameter 值为 default&lt;/p&gt;
&lt;p&gt;${parameter:=default}与 ${parameter=default}不同之处在于： parameter 声明了但为空时， ${parameter=default}认为 parameter 已设置，而 ${parameter:=default}认为 parameter 没有设置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=
echo ${var1-1} # 空
echo $var1 # 空
echo ${var1:-1} # 1
echo $var1 # 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;parameteralt-parameteralt&quot;&gt;&lt;a href=&quot;#parameteralt-parameteralt&quot; aria-label=&quot;parameteralt parameteralt permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${parameter+alt}, ${parameter:+alt}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;如果参数 parameter 有设置，返回 alt&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=1
echo ${var1+2} # 2
echo ${var2+2} # 空&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;${parameter:+alt}与 ${parameter+alt}不同之处在于： parameter 声明了但为空时， ${parameter+alt}认为 parameter 已设置，而 ${parameter:+alt}认为 parameter 没有设置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=
echo ${var1+2} # 2
echo ${var1:+2} # 空&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;parametererr_msg-parametererr_msg&quot;&gt;&lt;a href=&quot;#parametererr_msg-parametererr_msg&quot; aria-label=&quot;parametererr_msg parametererr_msg permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${parameter?err_msg}, ${parameter:?err_msg}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;如果参数 parameter 没有设置，打印 err_msg 并中断执行，且退出状态为 1&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=1
echo ${var1?bad} # 1
echo ${var2?bad} #  var2: bad

#查看退出状态
echo $? # 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;${parameter:?err_msg}与 ${parameter?err_msg}}不同之处在于： parameter 声明了但为空时， ${parameter?err_msg}认为 parameter 已设置，而 ${parameter:?err_msg}认为 parameter 没有设置&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=
echo ${var1?bad} # 空
echo ${var1：?bad} # var1: bad

#查看退出状态
echo $? # 1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;var&quot;&gt;&lt;a href=&quot;#var&quot; aria-label=&quot;var permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${#var}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;变量 $var 的字符数&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=abc
echo ${#var1} # 3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;当 $var 为数组时，${#var}返回数组第一个元素的字符数，${#var[*]}和 ${#var[@]}返回数组个数&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;declare -A a
a[0]=abc
a[1]=def
echo ${#a} # 3
echo ${#a[@]} # 2
echo ${#a[*]} # 3
b=(abc def)
echo ${#b} # 3
echo ${#b[@]} # 2
echo ${#b[*]} # 3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varpattern-varpattern&quot;&gt;&lt;a href=&quot;#varpattern-varpattern&quot; aria-label=&quot;varpattern varpattern permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var#Pattern}, ${var##Pattern}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;从 $var 的头部开始匹配 Pattern，移除匹配的部分，返回剩余部分&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abc
echo ${a#a} # bc
echo ${a#ab} # c
echo ${a#abc} # 空
echo ${a#bc} # abc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;${var##Pattern}与 ${var#Pattern}不同之处在于：${var#Pattern}进行尽可能少的匹配，而 ${var##Pattern}尽可能多的匹配&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abaaab
echo ${var#ab*a} # aab
echo ${var##ab*a} # b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varpattern-varpattern-1&quot;&gt;&lt;a href=&quot;#varpattern-varpattern-1&quot; aria-label=&quot;varpattern varpattern 1 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var%Pattern}, ${var%%Pattern}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;从 $var 的尾部开始匹配 Pattern，移除匹配的部分，返回剩余部分&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abc
echo ${a%c} # ab
echo ${a%bc} # a
echo ${a%abc} # 空
echo ${a%ab} # abc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;${var%%Pattern}与 ${var%Pattern}不同之处在于：${var%Pattern}进行尽可能少的匹配，而 ${var%Pattern}尽可能多的匹配&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=baaaba
echo ${var%a*ba} # baa
echo ${var%%a*ba} # b&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varpos&quot;&gt;&lt;a href=&quot;#varpos&quot; aria-label=&quot;varpos permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var:pos}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;从 pos+1 处开始截取 $var&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abcdef
echo ${var:0} # abcdef
echo ${var:1} # bcdef
echo ${var:6} # 空
echo ${var:7} # 空
echo ${var:-1} # abcdef, 当 pos 为负数，直接返回 $var&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varposlen&quot;&gt;&lt;a href=&quot;#varposlen&quot; aria-label=&quot;varposlen permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var:pos:len}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;从 pos+1 处开始截取 $var, 当 len 为正整数，截取长度不超过 len；当 len 为负数，截取到倒数第 len 个字符。&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abcdef
echo ${var:1:1} # b
echo ${var:1:6} # bcdef
echo ${var:1:7} # bcdef
echo ${var:1:-1} # bcde
echo ${var:3:-3} # 空
echo ${var:4:-3} # substring expression: 3 &amp;lt; 4 错误
echo ${var:-1:1} # abcdef, 当 pos 为负数，直接返回 $var
echo ${var:-1:-1} # abcdef&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varpatternreplacement&quot;&gt;&lt;a href=&quot;#varpatternreplacement&quot; aria-label=&quot;varpatternreplacement permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var/Pattern/Replacement}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;从 $var 中将匹配 Pattern 的部分替换为 Replacement&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=aaabcdef
echo ${var/a/A} # Aaabcdef
echo ${var/a*e/A} # Af&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;varpatternreplacement-1&quot;&gt;&lt;a href=&quot;#varpatternreplacement-1&quot; aria-label=&quot;varpatternreplacement 1 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var//Pattern/Replacement}&lt;/h3&gt;
&lt;p&gt;${var//Pattern/Replacement}与 ${var/Pattern/Replacement}不同之处在于：${var//Pattern/Replacement}进行的是全局匹配，${var/Pattern/Replacement}只匹配首次&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=aaabcdef
echo ${var1/a/A} # AAAbcdef
var2=abcab
echo ${var2/ab/AB} # ABcAB&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;varpatternreplacement-2&quot;&gt;&lt;a href=&quot;#varpatternreplacement-2&quot; aria-label=&quot;varpatternreplacement 2 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var/#Pattern/Replacement}&lt;/h3&gt;
&lt;p&gt;${var/#Pattern/Replacement}与 ${var/Pattern/Replacement}不同之处在于：${var/#Pattern/Replacement}限制从头部开始匹配&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abcab
echo ${var/#ab/AB} # ABcab
echo ${var/ab/AB} # ABcab
echo ${var/#bc/BC} # abcab
echo ${var/bc/BC} # aBCab&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h3 id=&quot;varpatternreplacement-3&quot;&gt;&lt;a href=&quot;#varpatternreplacement-3&quot; aria-label=&quot;varpatternreplacement 3 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${var/%Pattern/Replacement}&lt;/h3&gt;
&lt;p&gt;${var/%Pattern/Replacement}与 ${var/Pattern/Replacement}不同之处在于：${var/%Pattern/Replacement}限制从尾部开始匹配&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var=abcab
echo ${var/#ab/AB} # abcAB
echo ${var/ab/AB} # ABcab
echo ${var/#bc/BC} # abcab
echo ${var/bc/BC} # aBCab&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;varprefix-varprefix&quot;&gt;&lt;a href=&quot;#varprefix-varprefix&quot; aria-label=&quot;varprefix varprefix permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;${!varprefix*}, ${!varprefix@}&lt;/h2&gt;
&lt;p&gt;&lt;strong&gt;查找以 varprefix 开头的变量名&lt;/strong&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;var1=1
var2=2
myvar=3
echo ${!var*} # var1 var2
echo ${!var@} # var1 var2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[创建极简 nodejs docker 镜像]]></title><description><![CDATA[本文将介绍如何创建极简 node 镜像]]></description><link>https://blog.sigoden.com/nodejszhi-chuang-jian-zui-xiao-dockerjing-xiang/</link><guid isPermaLink="false">https://blog.sigoden.com/nodejszhi-chuang-jian-zui-xiao-dockerjing-xiang/</guid><content:encoded>&lt;p&gt;使用 docker 运行服务，你可以拥有一致的环境，可以精确控制服务的运行资源 (cpu, 内存），可以方便的设置端口和网络，可以使用镜像仓储管理和分发代码。现在越来越多的开发者选择将服务运行在 docker 上。&lt;/p&gt;
&lt;p&gt;好多 nodejs 用户在使用 docker 时，直接使用了默认的 node 镜像。但你不觉得它太大了吗？现在&lt;code class=&quot;language-text&quot;&gt;node:6.10.1&lt;/code&gt;镜像的体积已经达到 666M，其实要实现同样的功能，只需 43.5M 就够了。尺寸小，意味者更低的资源消耗，更快的下载速度，更小的传输带宽。&lt;/p&gt;
&lt;p&gt;下面一起来揭露技巧。&lt;/p&gt;
&lt;h2 id=&quot;from-设置-alpine-基础镜像&quot;&gt;&lt;a href=&quot;#from-%E8%AE%BE%E7%BD%AE-alpine-%E5%9F%BA%E7%A1%80%E9%95%9C%E5%83%8F&quot; aria-label=&quot;from 设置 alpine 基础镜像 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;FROM: 设置 alpine 基础镜像&lt;/h2&gt;
&lt;p&gt;目前 docker 下最轻量的操作系统是 alpine, 一个 alpine 的体积不到 5M。node 默认镜像依赖的基础镜像是 debian, &lt;code class=&quot;language-text&quot;&gt;debian:jessie&lt;/code&gt;体积已打 123M, 所以想减小尺寸，首要就是从基础镜像切换到 alpine。&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;FROM alpine:3.7&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;run-设置-node-用户&quot;&gt;&lt;a href=&quot;#run-%E8%AE%BE%E7%BD%AE-node-%E7%94%A8%E6%88%B7&quot; aria-label=&quot;run 设置 node 用户 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 设置 node 用户&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;adduser -D -u 1000 node&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;设置 node 用户是可选的。添加用户后在运行容器是可以指定已 node 用户的身份运行服务&lt;/p&gt;
&lt;h2 id=&quot;run-安装-node-编译工具&quot;&gt;&lt;a href=&quot;#run-%E5%AE%89%E8%A3%85-node-%E7%BC%96%E8%AF%91%E5%B7%A5%E5%85%B7&quot; aria-label=&quot;run 安装 node 编译工具 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 安装 node 编译工具&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apk add --no-cache \
    libstdc++ \
&amp;amp;&amp;amp; apk add --no-cache --virtual .build-deps \
    binutils-gold \
    curl \
    g++ \
    gcc \
    gnupg \
    libgcc \
    linux-headers \
    make \
    python&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;apk add --no-cache&lt;/code&gt;不使用本地缓存安装包数据库，直接从远程获取安装包信息安装。这样我们就不必通过&lt;code class=&quot;language-text&quot;&gt;apk update&lt;/code&gt;获取安装包数据库了&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;apk add --virtual .build-deps&lt;/code&gt;将本次安装的所有包封装成一个名为.build-deps 的虚拟包。这样做的好处是可以通过&lt;code class=&quot;language-text&quot;&gt;apk del .build-deps&lt;/code&gt;一键清除这些包&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;run-导入-node-源码包公钥&quot;&gt;&lt;a href=&quot;#run-%E5%AF%BC%E5%85%A5-node-%E6%BA%90%E7%A0%81%E5%8C%85%E5%85%AC%E9%92%A5&quot; aria-label=&quot;run 导入 node 源码包公钥 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 导入 node 源码包公钥&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;for key in \
    9554F04D7259F04124DE6B476D5A82AC7E37093B \
    94AE36675C464D64BAFA68DD7434390BDBE9B9C5 \
    FD3A5288F042B6850C66B31F09FE44734EB7990E \
    71DCFD284A79C3B38668286BC97EC7A07EDE3FC1 \
    DD8F2338BAE7501E3DD5AC78C273792F7D83545D \
    B9AE9905FFD7803F25714661B63B535A4C206CA9 \
    C4F0DFFF4E8C1A8236409D08E73BC641CC11F4C8 \
    56730D5401028683275BD23C23EFEFE93C4CFFFE \
; do \
gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &amp;quot;$key&amp;quot;; \
done&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这些公钥将用来校验我们通过 curl 下载的 nodejs 源码文件&lt;/p&gt;
&lt;h2 id=&quot;run-下载并-node-校验源码文件&quot;&gt;&lt;a href=&quot;#run-%E4%B8%8B%E8%BD%BD%E5%B9%B6-node-%E6%A0%A1%E9%AA%8C%E6%BA%90%E7%A0%81%E6%96%87%E4%BB%B6&quot; aria-label=&quot;run 下载并 node 校验源码文件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 下载并 node 校验源码文件&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -SLO &amp;quot;https://nodejs.org/dist/v$NODE_VERSION/node-v$NODE_VERSION.tar.xz&amp;quot; \
&amp;amp;&amp;amp; curl -SLO &amp;quot;https://nodejs.org/dist/v$NODE_VERSION/SHASUMS256.txt.asc&amp;quot; \
&amp;amp;&amp;amp; gpg --batch --decrypt --output SHASUMS256.txt SHASUMS256.txt.asc \
&amp;amp;&amp;amp; grep &amp;quot; node-v$NODE_VERSION.tar.xz\$&amp;quot; SHASUMS256.txt | sha256sum -c -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;$NODE_VERSION&lt;/code&gt;: 指 node 版本，如 6.10.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;run-编译安装-node&quot;&gt;&lt;a href=&quot;#run-%E7%BC%96%E8%AF%91%E5%AE%89%E8%A3%85-node&quot; aria-label=&quot;run 编译安装 node permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 编译安装 node&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;tar -xf &amp;quot;node-v$NODE_VERSION.tar.xz&amp;quot; \
&amp;amp;&amp;amp; cd &amp;quot;node-v$NODE_VERSION&amp;quot; \
&amp;amp;&amp;amp; ./configure \
&amp;amp;&amp;amp; make -j$(getconf _NPROCESSORS_ONLN) \
&amp;amp;&amp;amp; make install&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;如果不需要 npm, 可以替换第三行为&lt;code class=&quot;language-text&quot;&gt;&amp;amp;&amp;amp; ./configure --without-npm&lt;/code&gt;&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;$NODE_VERSION&lt;/code&gt;: 指 node 版本，如 6.10.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;run-清理&quot;&gt;&lt;a href=&quot;#run-%E6%B8%85%E7%90%86&quot; aria-label=&quot;run 清理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;RUN: 清理&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apk del .build-deps \
&amp;amp;&amp;amp; cd .. \
&amp;amp;&amp;amp; rm -Rf &amp;quot;node-v$NODE_VERSION&amp;quot; \
&amp;amp;&amp;amp; rm &amp;quot;node-v$NODE_VERSION.tar.xz&amp;quot; SHASUMS256.txt.asc SHASUMS256.txt&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;$NODE_VERSION&lt;/code&gt;: 指 node 版本，如 6.10.1&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;cmd-设置镜像入口为-node&quot;&gt;&lt;a href=&quot;#cmd-%E8%AE%BE%E7%BD%AE%E9%95%9C%E5%83%8F%E5%85%A5%E5%8F%A3%E4%B8%BA-node&quot; aria-label=&quot;cmd 设置镜像入口为 node permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;CMD: 设置镜像入口为 node&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;CMD [ &amp;quot;node&amp;quot; ]&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上面为创建 nodejs 镜像必须步骤，下面的步骤根据需要添加&lt;/p&gt;
&lt;h2 id=&quot;安装-yarn&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-yarn&quot; aria-label=&quot;安装 yarn permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 yarn&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;安装依赖&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apk add --no-cache --virtual .build-deps-yarn curl gnupg&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;导入公钥&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;for key in \
6A010C5166006599AA17F08146C2130DFD2497F5 \
; do \
gpg --keyserver ha.pool.sks-keyservers.net --recv-keys &amp;quot;$key&amp;quot;; \
done&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;下载校验&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -fSL -o yarn.js &amp;quot;https://yarnpkg.com/downloads/$YARN_VERSION/yarn-legacy-$YARN_VERSION.js&amp;quot; \
&amp;amp;&amp;amp; curl -fSL -o yarn.js.asc &amp;quot;https://yarnpkg.com/downloads/$YARN_VERSION/yarn-legacy-$YARN_VERSION.js.asc&amp;quot; \
&amp;amp;&amp;amp; gpg --batch --verify yarn.js.asc yarn.js \
&amp;amp;&amp;amp; rm yarn.js.asc&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$YARN_VERSION&lt;/code&gt;: 指 yarn 版本，如 0.22&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mv yarn.js /usr/local/bin/yarn \
&amp;amp;&amp;amp; chmod +x /usr/local/bin/yarn \&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;清理&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apk del .build-deps-yarn&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;c-插件&quot;&gt;&lt;a href=&quot;#c-%E6%8F%92%E4%BB%B6&quot; aria-label=&quot;c 插件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;c++ 插件&lt;/h2&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;如果要支持 c++ 插件，还需安装 python,make,g++&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;apk add --no-cache python make g++&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;headers-文件&quot;&gt;&lt;a href=&quot;#headers-%E6%96%87%E4%BB%B6&quot; aria-label=&quot;headers 文件 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;headers 文件&lt;/h2&gt;
&lt;p&gt;有些 c++ 模块使用过程中还需要下载 node-headers 文件，node-headers 文件国内下载不稳定，建议也集成到镜像里，否则你可能碰到一个包编译很久没动静的情况。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;参考 nodejs 源码下载校验步骤对 headers 文件进行下载校验&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -SLO &amp;quot;https://nodejs.org/dist/v$NODE_VERSION/node-v${NODE_VERSION}-headers.tar.xz&amp;quot;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装 headers 文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mkdir /root/.node-gyp
tar --strip-component 1 -xzf node-v${NODE_VERSION}-heraders.tar.xz /root/.node-gyp/$NODE_VERSION
rm -rf node-v${NODE_VERSION}-headers.tar.xz&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;blockquote&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;$NODE_VERSION&lt;/code&gt;: 指 node 版本，如 6.10.1&lt;/p&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[npm 安装的包为什么不一致]]></title><description><![CDATA[npm 包在安装是可能会产生不一致的目录，这是如何产生的？本文将对不一致原因进行分析。]]></description><link>https://blog.sigoden.com/npman-zhuang-de-bao-wei-shi-yao-bu-yi-zhi/</link><guid isPermaLink="false">https://blog.sigoden.com/npman-zhuang-de-bao-wei-shi-yao-bu-yi-zhi/</guid><content:encoded>&lt;h2 id=&quot;npm-是什么&quot;&gt;&lt;a href=&quot;#npm-%E6%98%AF%E4%BB%80%E4%B9%88&quot; aria-label=&quot;npm 是什么 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;NPM 是什么&lt;/h2&gt;
&lt;p&gt;NPM（node package manager），通常称为 node 包管理器。顾名思义，它的主要功能就是管理 node 包，包括：安装、卸载、更新、查看、搜索、发布等，npm 将开发者从繁琐的包管理工作（版本、依赖等）中解放出来，更加专注于功能的开发。&lt;/p&gt;
&lt;h2 id=&quot;npm-模块复制&quot;&gt;&lt;a href=&quot;#npm-%E6%A8%A1%E5%9D%97%E5%A4%8D%E5%88%B6&quot; aria-label=&quot;npm 模块复制 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;NPM 模块复制&lt;/h2&gt;
&lt;p&gt;从 npm3 开始，npm 对包安装进行了优化，如果模块 A 和模块 C 都依赖了模块 B, 模块 B 将只安装一次。

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 460px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 55.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAB5UlEQVQoz2NgIB8wkqrBAYibgHgBCwvLKk5OzqVAugfID2ViYmIn1lCYghVA/B+EnZ2d/3t7e/+Pior6r6qqChZjZGS8CaRFiTEUJtkOxL9BmvX19cEGiYmJ/WdnZ/8PtWgTEPNhNaGjo4PB19eXce3atWC+oKAgi7qGBoipAjQ9FEiXg5QBcTUQxwNdZw6kmUEKGvOTGbwcLBmD3O0ZA93sGN3tzNGcx8jIycfHx8nOwcGMzxsszMxsQIoLn3f52djYxIA0O8x2BmlpRigbpFkSymYRYGdjAkk7WhjxGmqpyqsqyGo7WRqLOFkaiVoa6TAznDt3LvPevXvvt23bdv3gwYOXnz19+vzQ6dPOIINOMTMfOc/AcKuZgeHaEQaGuycYGFYypMeALUwJ9ZmdExv8A+jV1wnBXi8zIgPeR/q6qDGcPn266T8QbN++/f/+/fv///3z5//hs2eDgHo4zjAzf70PjIQZQHwNiE8yMFxmSIoAG5gc4r0gOybof7i385vEEO8PaRH+3yJ9XNQZNmzYILBlyxblBw8eKFy9elVh+7Ztyis3beLiBIbPQiYmxWUMDKpbgBG0moFBbQ4DgyyDmx04RPycrPmArhMDukwkwsdF1M/ZRtTd1pyZrCySFhWAUw4AFJORLIecktAAAAAASUVORK5CYII=&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;npm-copy&quot;
        title=&quot;&quot;
        src=&quot;/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png&quot;
        srcset=&quot;/static/506f6dda43f4703ffe0be70e037f1428/a3b1f/npm-module-copy.png 197w,
/static/506f6dda43f4703ffe0be70e037f1428/07137/npm-module-copy.png 393w,
/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png 460w&quot;
        sizes=&quot;(max-width: 460px) 100vw, 460px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;在早期版本，依赖的模块是直接装在模块自己的 node_modules 下的

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 550px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.54545454545455%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAACF0lEQVQoz2NgwA84gVgAiPmBmB1JnJGBSABT6AzEq9nY2K6rqKi8NjY2fiUqKnoJKLaQmZnZkBRDmcAqGRm3Aan/0tLS/319ff/b2Nj8FxYW/g8SA8pNQFaLFezfv5/x/v37TP///2f89OkTE9BlYkDhKCDuB+JlQLwUiLuAhoUAncUFVMcQ6evCHORuz5wU4s2kq64MNifcG+ixb9++MZAImLEJOpgbIjiHDx+Wmzx5svPq1atNz549q79+/XpQJDAoKSkxc3BwMAHDjYmPh5sZ6gqu2AAPR1drU38/Zxs3oAtNNJXlwd4P83KCGHj79u2t79+9+79h7dr/f3/9+n9s3744kPit16+Zk6CWxgd5gjVF+7kZFiWF/08L9fmfFxP0PzPc732arBQPSC4iwh+i+MzJk3FXHj1q3nL9ev6jHz+qjv3/LwkSP1dVBQ/4UE9HcKwGOtuIJoT65HgkRUR4pURG+eYmusHUVKgoAKNt40awwskMDKrngK5uZmDw2c7AkLSHhcUYJL4HKXn8XzMTHky3GRgiDzMwpK1jYMg4xcCQVwiMLIgiaCBvY2Vd/J2J6T8wof2/xcj4/wQDQy9I/DgDAwuIVpGXZngENbyck0P5PEgNEK9jZPh/E2hMGQODONjA+VBFOxgY1PYzMPjtZGBwB7rKbzPQxVBxuAtbofQioCXAhGoMxFabGBgsgT4yK4VaDADotqJsJhLRJAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;npm-old&quot;
        title=&quot;&quot;
        src=&quot;/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png&quot;
        srcset=&quot;/static/ce417f50b5204e831551cfd3921b4792/a3b1f/npm-module-old.png 197w,
/static/ce417f50b5204e831551cfd3921b4792/07137/npm-module-old.png 393w,
/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png 550w&quot;
        sizes=&quot;(max-width: 550px) 100vw, 550px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;p&gt;这也是为什么用户在切换到 npm3 后 node_modules 下无缘无故多出那么多包的原因&lt;/p&gt;
&lt;h2 id=&quot;安装顺序对包结构影响&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85%E9%A1%BA%E5%BA%8F%E5%AF%B9%E5%8C%85%E7%BB%93%E6%9E%84%E5%BD%B1%E5%93%8D&quot; aria-label=&quot;安装顺序对包结构影响 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装顺序对包结构影响&lt;/h2&gt;
&lt;h4 id=&quot;生成测试包&quot;&gt;&lt;a href=&quot;#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E5%8C%85&quot; aria-label=&quot;生成测试包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;生成测试包&lt;/h4&gt;
&lt;p&gt;生成包&lt;code class=&quot;language-text&quot;&gt;a@1.0.0&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;b@1.0.0&lt;/code&gt;,&lt;code class=&quot;language-text&quot;&gt;b@2.0.0&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;c@1.0.0&lt;/code&gt;，其中&lt;code class=&quot;language-text&quot;&gt;a@1.0.0&lt;/code&gt;依赖&lt;code class=&quot;language-text&quot;&gt;b@1.0.0&lt;/code&gt;, &lt;code class=&quot;language-text&quot;&gt;c@1.0.0&lt;/code&gt;依赖&lt;code class=&quot;language-text&quot;&gt;b@2.0.0&lt;/code&gt;&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;创建包目录
mkdir -p /tmp/repositories/{a-1.0.0, b-1.0.0, b-2.0.0, c-1.0.0}

b@1.0.0
vi /tmp/repositories/b-1.0.0/index.js
module.exports = &amp;#39;b-1.0.0&amp;#39;

vi /tmp/repositories/b-1.0.0/package.json
{
  &amp;quot;name&amp;quot;: &amp;quot;b&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;1.0.0&amp;quot;,
  &amp;quot;main&amp;quot;: &amp;quot;index.js&amp;quot;
}

b@2.0.0
vi /tmp/repositories/b-2.0.0/index.js
module.exports = &amp;#39;b-2.0.0&amp;#39;

vi /tmp/repositories/a-2.0.0/package.json
{
  &amp;quot;name&amp;quot;: &amp;quot;b&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;2.0.0&amp;quot;,
  &amp;quot;main&amp;quot;: &amp;quot;index.js&amp;quot;
}


a@1.0.0
vi /tmp/repositories/a-1.0.0/index.js
exports.a = &amp;#39;a-1.0.0&amp;#39;
exports.b = require(&amp;#39;b&amp;#39;)

vi /tmp/repositories/a-1.0.0/index.js
{
  &amp;quot;name&amp;quot;: &amp;quot;a&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;1.0.0&amp;quot;,
  &amp;quot;main&amp;quot;: &amp;quot;index.js&amp;quot;,
  &amp;quot;dependencies&amp;quot;: {
    &amp;quot;b&amp;quot;: &amp;quot;file:///tmp/repositories/b-1.0.0/b-1.0.0.tgz&amp;quot;
  }
}


c@1.0.0
vi /tmp/repositories/c-1.0.0/index.js
exports.c = &amp;#39;c-1.0.0&amp;#39;
exports.b = require(&amp;#39;b&amp;#39;)

vi /tmp/repositories/c-1.0.0/index.js
{
  &amp;quot;name&amp;quot;: &amp;quot;c&amp;quot;,
  &amp;quot;version&amp;quot;: &amp;quot;1.0.0&amp;quot;,
  &amp;quot;main&amp;quot;: &amp;quot;index.js&amp;quot;,
  &amp;quot;dependencies&amp;quot;: {
    &amp;quot;b&amp;quot;: &amp;quot;file:///tmp/repositories/b-2.0.0/b-2.0.0.tgz&amp;quot;
  }
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;测试包打包-tarball&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E5%8C%85%E6%89%93%E5%8C%85-tarball&quot; aria-label=&quot;测试包打包 tarball permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试包打包 tarball&lt;/h4&gt;
&lt;p&gt;为了方便安装，我们通过&lt;code class=&quot;language-text&quot;&gt;npm pack&lt;/code&gt;将包转换为 tgz 文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;cd /tmp/repositories/a-1.0.0 &amp;amp;&amp;amp; npm pack
cd /tmp/repositories/b-1.0.0 &amp;amp;&amp;amp; npm pack
cd /tmp/repositories/b-2.0.0 &amp;amp;&amp;amp; npm pack
cd /tmp/repositories/c-1.0.0 &amp;amp;&amp;amp; npm pack&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h4 id=&quot;先安装包-a-再安装包-c&quot;&gt;&lt;a href=&quot;#%E5%85%88%E5%AE%89%E8%A3%85%E5%8C%85-a-%E5%86%8D%E5%AE%89%E8%A3%85%E5%8C%85-c&quot; aria-label=&quot;先安装包 a 再安装包 c permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;先安装包 a, 再安装包 c&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mkdir /tmp/stage1
cd /tmp/stage1
npm i /tmp/repositories/a-1.0.0/a-1.0.0.tgz
npm i /tmp/repositories/c-1.0.0/c-1.0.0.tgz

查看目录结构
tree /tmp/stage1
.
├── node_modules
│   ├── a
│   │   ├── index.js
│   │   └── package.json
│   ├── b
│   │   ├── index.js
│   │   └── package.json
│   └── c
│       ├── index.js
│       ├── node_modules
│       │   └── b
│       │       ├── index.js
│       │       └── package.json
│       └── package.json
└── README.md

查看外部包 b 的版本
cat node_modules/b/package.json | grep version #1.0.0

查看包 c 依赖包 b 的版本
cat node_modules/c/node_modules/b/package.json | grep version #2.0.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到在安装包 a 时，npm 同时将其依赖包&lt;code class=&quot;language-text&quot;&gt;b@1.0.0&lt;/code&gt;安装在最外层&lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;下，而安装包 c 时，npm 检查到包 b 已存在但是不同版本，将包 b 安装到包 c 自己的 node_modules 下

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 473px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 56.02536997885835%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAACKUlEQVQoz5WTUWiSURTH/+ebNqO9zjAaZWJPiyT8kBBdORfbnKW04WaxaINysIiCyAcJoh4j9mCRQVDgXOzBlB5kc+ZaD7aZvvgig/IhyFXIogbbU7fzmbSCxdiB3/eH797z59xzzwX+DVI+uzhYBpgJ5gWTYp4zdxgbdhIaDpaiWq0WZrNZWCwWIcuysNlswmAwCF4TRDTR2C5taxgIBBQJS5L0Q6fTCb1eL4xGY121Wq1iWGWG/2sYj8cRiURICIFyuUyHjcbmxlIb082MMFeZ84ydq2tVFt0Oq5R6co9GB/qkc2dOST5XJ21VoLrRR9quM1tVN9LvAqLRaEswGDwSCoXa0+l0W35paX94akplYfPLRHvvA61OoP0uoLtN1KIkeu0Wlf9011G7bHK6ThzvGPN7jnGVB+qulUrlVjabFYlEYq1UKq2/zeXE9MqKcQGQZ4g2wsD3LLA2x5fxlHBdyRl2WA9dPNv7c6jPKS753GJsyCMGXZ2TdUM2ucaVrSaTyeVcLvdhYX6+Ol2rHZwFzCmi1QfAlxng00tg/TFwRcnxW+V9F7w9c/29jtd+b/esz931ztNz8safs/OF0N+oTCZ08P9xoElsohKbvVX6R+I3mhqPbh7YHSPag52GMjc31SoJmmY1T3zsEfD1FfD+DfCRp7+ITCaDQqGAYrFYJ7+4iMlqtf48EkR4xsqbkW08lXHFVNUEjA4iDiQfAhusn7kl32LA8i+pS8W7hfu65QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;npm-a-and-c&quot;
        title=&quot;&quot;
        src=&quot;/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png&quot;
        srcset=&quot;/static/1cb4993c3f0f13f0f8097afbd8decadd/a3b1f/npm-a-and-c.png 197w,
/static/1cb4993c3f0f13f0f8097afbd8decadd/07137/npm-a-and-c.png 393w,
/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png 473w&quot;
        sizes=&quot;(max-width: 473px) 100vw, 473px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h4 id=&quot;先安装包-c-再安装包-a&quot;&gt;&lt;a href=&quot;#%E5%85%88%E5%AE%89%E8%A3%85%E5%8C%85-c-%E5%86%8D%E5%AE%89%E8%A3%85%E5%8C%85-a&quot; aria-label=&quot;先安装包 c 再安装包 a permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;先安装包 c, 再安装包 a&lt;/h4&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mkdir /tmp/stage2
cd /tmp/stage2
npm i /tmp/repositories/c-1.0.0/c-1.0.0.tgz
npm i /tmp/repositories/a-1.0.0/a-1.0.0.tgz

查看目录结构
tree /tmp/stage2
.
├── node_modules
│   ├── a
│   │   ├── index.js
│   │   ├── node_modules
│   │   │   └── b
│   │   │       ├── index.js
│   │   │       └── package.json
│   │   └── package.json
│   ├── b
│   │   ├── index.js
│   │   └── package.json
│   └── c
│       ├── index.js
│       └── package.json
└── README.md

查看外部包 b 的版本
cat node_modules/b/package.json | grep version #2.0.0

查看包 c 依赖包 b 的版本
cat node_modules/a/node_modules/b/package.json | grep version #1.0.0&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;可以看到在安装包 c 时，npm 同时将其依赖包&lt;code class=&quot;language-text&quot;&gt;b@2.0.0&lt;/code&gt;安装在最外层&lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;下，而安装包 a 时，npm 检查到包 b 已存在但是不同版本，将包 b 安装到包 a 自己的 node_modules 下

  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 463px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 58.09935205183585%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA3XAAAN1wFCKJt4AAACNUlEQVQoz5WTTWgTURDH/28T16QxmtiL9YuivenNoFBKRUo2iY2bbpqKNoVqxQoKHkTRg1e9tIUgYsH2YlE8qPhZE5pYhJhImoYcQi4JeAm0B6FioeAH9Pnf0ICIWjrw29k382Z23sxb4O+ymRwkAWKsaXOtYiNioVBdE0JUrVbrD5vNJmmqo6rqd0VRKvRfoV1ZL5cwHwzYQbVKLT0ej/R6vTIYDEpN0+q43W5J/zcm3PV73HrSTu6zogKrXLTb7Z8dDsei0+mc53qSvkP/TSalFCa6rtva2tpcDfsNBjQDTYzayaWjYVc3qUqza+uWft1rYRyGT+mWM73HLWHfUYGNSruqKi2tu//Zv6iuAbFY7HIikRgslUonP2YyfaPZbNME4H4qRM9DIHgPGJoBInHgcCNwMBw4EQkcu6l3ddw61xe8ejbSfd3QOlvrzmq1Kmu1mqxUKrJYKMjJlZU9H4DOshByjB3JkyJ5DKQbCS+cDr0fCGlyKNItL/Yb8lLUkOGuDqPuTKVS0/l8/nk2m32VSaefjC8vu18CB5JCpO/SnQBmXgPZR8DtRsIBXRuOhnwTvT3+kYjhH+0z/HeOhHz7NtzD838OFNhOXD8JT9EyK8RexONxUS6XBSsUPLKY5uS4AUXe7v2cNKsVU2TEvCbbnGaS+jSnFKWXVa8+AJYywNdZ4AtZQjKZxNzcHHK5HHhkjC0sgJvwlrwg78y2rL2b8ok/lKmT/CWfschxwj2SH5ZvyC9oD8UYvEHYiAAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;npm-c-and-a&quot;
        title=&quot;&quot;
        src=&quot;/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png&quot;
        srcset=&quot;/static/6cd211db829797e4beb9ee88458f093c/a3b1f/npm-c-and-a.png 197w,
/static/6cd211db829797e4beb9ee88458f093c/07137/npm-c-and-a.png 393w,
/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png 463w&quot;
        sizes=&quot;(max-width: 463px) 100vw, 463px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;从上面的测试中可以看到，安装同样的包，因为安装顺序的不一致，会产生不一致的目录结构。如果安装顺序一致，&lt;code class=&quot;language-text&quot;&gt;node_modules&lt;/code&gt;目录结构也会是一致的。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[从零开始创建 Vagrant 镜像]]></title><description><![CDATA[通过 vagrant 镜像我们可以再发行版的基础上自定义 Linux 镜像并发布。本文将介绍如何从无到有打造一款 vagrant 镜像。]]></description><link>https://blog.sigoden.com/cong-ling-kai-shi-da-jian-vagrantrong-qi-2/</link><guid isPermaLink="false">https://blog.sigoden.com/cong-ling-kai-shi-da-jian-vagrantrong-qi-2/</guid><content:encoded>&lt;p&gt;Vagrant 是一个用于创建和部署虚拟化开发环境的工具。vagrant 镜像是一个 vagrant 用来启动虚拟机的文件，通常是纯净的操作系统镜像，如 Ubuntu, Debian，CentOS 打包生成。但我们也可以选择一款操作系统，在其上安装配置我们需要的工具和软件，然后打包成一个自定义 vagrant 镜像。&lt;/p&gt;
&lt;p&gt;我们将通过 virtualbox, 安装运行 ubuntu-server-16.04.2 操作系统，再在其上安装 docker-17.03.0, 然后将这一切打包成为一个名为 ubuntu-16.04-docker-17.03.0 的 vagrant 镜像&lt;/p&gt;
&lt;h2 id=&quot;准备&quot;&gt;&lt;a href=&quot;#%E5%87%86%E5%A4%87&quot; aria-label=&quot;准备 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;准备&lt;/h2&gt;
&lt;ul&gt;
&lt;li&gt;&lt;a href=&quot;https://www.virtualbox.org/&quot;&gt;virtualbox&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.vagrantup.com/downloads.html&quot;&gt;vagrant&lt;/a&gt;&lt;/li&gt;
&lt;li&gt;&lt;a href=&quot;https://www.ubuntu.com/download/server&quot;&gt;ubuntu-server-16.04.2.iso&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;下载并安装 vagrant 和 virtualbox, 下载 ubuntu-server-16.04.2.iso 文件&lt;/p&gt;
&lt;h2 id=&quot;虚拟机安装运行-ubuntu&quot;&gt;&lt;a href=&quot;#%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AE%89%E8%A3%85%E8%BF%90%E8%A1%8C-ubuntu&quot; aria-label=&quot;虚拟机安装运行 ubuntu permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;虚拟机安装运行 ubuntu&lt;/h2&gt;
&lt;p&gt;配置虚拟机有几点要注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;硬盘空间动态且足够，这里选择 8G 默认值&lt;/li&gt;
&lt;li&gt;网路适配器 1(Network &gt; Adapter1) 必须是 NAT, 选择默认值&lt;/li&gt;
&lt;li&gt;内存可以适当小一点，这里选择 512M&lt;/li&gt;
&lt;li&gt;禁掉非必须的硬件比如声卡，USB 控制器&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;安装 ubuntu server 时也有几点需要注意：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装区域最好选择您所在区域&lt;/li&gt;
&lt;li&gt;用户名设置：vagrant, 密码也是：vagrant&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;设置-root-密码为-vagrant&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE-root-%E5%AF%86%E7%A0%81%E4%B8%BA-vagrant&quot; aria-label=&quot;设置 root 密码为 vagrant permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置 root 密码为 vagrant&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo passwd root #连续两次输入 vagrant&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;检查是否设置成功&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;su - #输入 vagrant 可以切换到 root&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;设置-vagrant-用户无密码运行-sudo&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE-vagrant-%E7%94%A8%E6%88%B7%E6%97%A0%E5%AF%86%E7%A0%81%E8%BF%90%E8%A1%8C-sudo&quot; aria-label=&quot;设置 vagrant 用户无密码运行 sudo permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置 vagrant 用户无密码运行 sudo&lt;/h2&gt;
&lt;p&gt;需 vagrant 用户需自由运行 sudo 命令而不用输入密码&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo visudo -f /etc/sudoers.d/vagrant&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;添加下面内容到文件&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vagrant ALL=(ALL) NOPASSWD:ALL&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;这样在使用 sudo 时就不必在输入密码了
可以通过下面命令确认配置是否生效&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo pwd&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;vagrant-用户安装-ssh-公钥&quot;&gt;&lt;a href=&quot;#vagrant-%E7%94%A8%E6%88%B7%E5%AE%89%E8%A3%85-ssh-%E5%85%AC%E9%92%A5&quot; aria-label=&quot;vagrant 用户安装 ssh 公钥 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;vagrant 用户安装 ssh 公钥&lt;/h2&gt;
&lt;p&gt;vagrant 通过 ssh 与虚拟机交互，我们需要从 github 下载公钥安装到 vagrant 用户&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mkdir -p /home/vagrant/.ssh
chmod 0700 /home/vagrant/.ssh
wget --no-check-certificate \
    https://raw.github.com/mitchellh/vagrant/master/keys/vagrant.pub \
    -O /home/vagrant/.ssh/authorized_keys
chmod 0600 /home/vagrant/.ssh/authorized_keys
chown -R vagrant /home/vagrant/.ssh&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;配置-ssh-服务&quot;&gt;&lt;a href=&quot;#%E9%85%8D%E7%BD%AE-ssh-%E6%9C%8D%E5%8A%A1&quot; aria-label=&quot;配置 ssh 服务 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;配置 SSH 服务&lt;/h2&gt;
&lt;p&gt;安装 ssh 服务器&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo apt-get update -y
sudo apt-get install -y openssh-server&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;默认情况下 ssh 会查找 DNS, 离线情况下这种行为会浪费很多时间，所以我们需要配置&lt;code class=&quot;language-text&quot;&gt;UseDNS no&lt;/code&gt;来阻止这种行为&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo vi /etc/ssh/ssh_config&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;添加&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;UseDNS no&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;安装-virtualbox-guest-additions&quot;&gt;&lt;a href=&quot;#%E5%AE%89%E8%A3%85-virtualbox-guest-additions&quot; aria-label=&quot;安装 virtualbox guest additions permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;安装 VirtualBox Guest Additions&lt;/h2&gt;
&lt;p&gt;VirtualBox Guest Additions 提供了共享文件夹功能，此为对性能还有一些优化，所以有必要安装&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;更新应用包&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo apt-get update -y
sudo apt-get upgrade -y&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装依赖&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo apt-get install -y linux-headers-$(uname -r) build-essential dkms&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;安装 VBoxLinuxAdditions&lt;/p&gt;
&lt;blockquote&gt;
&lt;/blockquote&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;点击 Virtualbox 菜单：devices &gt; Insert Guset Additions CD Image.. 挂载镜像&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;挂载镜像到文件系统&lt;code class=&quot;language-text&quot;&gt;sudo mount /dev/cdrom /media/cdrom&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;运行安装脚本&lt;code class=&quot;language-text&quot;&gt;sudo sh /media/cdrom/VBoxLinuxAdditions.run&lt;/code&gt;&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;自定义&quot;&gt;&lt;a href=&quot;#%E8%87%AA%E5%AE%9A%E4%B9%89&quot; aria-label=&quot;自定义 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;自定义&lt;/h2&gt;
&lt;p&gt;这步是可选步骤&lt;/p&gt;
&lt;p&gt;我们也可以安装一些我们喜欢的工具，进行一些常用配置
此处我们安装 docker&lt;/p&gt;
&lt;p&gt;通过阿里云镜像网站安装 docker 最新版&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sudo sh -&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;将 vagrant 用户加入到 docker 组&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo usermod -aG docker vagrant&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;清理&quot;&gt;&lt;a href=&quot;#%E6%B8%85%E7%90%86&quot; aria-label=&quot;清理 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;清理&lt;/h2&gt;
&lt;p&gt;为了尽可能减小镜像的体积，我们进行一些清理&lt;/p&gt;
&lt;p&gt;首先清理安装包&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo apt-get clean&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;磁盘碎片整理&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;sudo dd if=/dev/zero of=/EMPTY bs=1M
sudo rm -f /EMPTY&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;清除 Bash 历史&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;echo &amp;gt; ~/.bash_history &amp;amp;&amp;amp; history -c&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;打包&quot;&gt;&lt;a href=&quot;#%E6%89%93%E5%8C%85&quot; aria-label=&quot;打包 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;打包&lt;/h2&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;vagrant package --output ubuntu-16.04-docker-17.03.0.box --base ubuntu&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;output&lt;/code&gt;: 输出镜像文件位置&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;base&lt;/code&gt;: 从运行中虚拟机 ubuntu 导出镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;结论&quot;&gt;&lt;a href=&quot;#%E7%BB%93%E8%AE%BA&quot; aria-label=&quot;结论 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;结论&lt;/h2&gt;
&lt;p&gt;到此，我们的自定义 vagrant 镜像就算制作完成了，你可以导入后运行，也可以分享给好友和同事。&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Docker 搭建 mongodb 复制集]]></title><description><![CDATA[Mongo 是一款常用的文档型数据库，它提供了复制集用来确保当数据库崩溃或关闭时数据的完整性。在生产环境中 Mongo 多是以复制集的形式存在，如何搭建却是一个问题，本文介绍如何使用 Docker 搭建 Mongo 复制集。]]></description><link>https://blog.sigoden.com/dockerda-jian-mongodbfu-zhi-ji-2/</link><guid isPermaLink="false">https://blog.sigoden.com/dockerda-jian-mongodbfu-zhi-ji-2/</guid><content:encoded>&lt;h2 id=&quot;准备&quot;&gt;&lt;a href=&quot;#%E5%87%86%E5%A4%87&quot; aria-label=&quot;准备 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;准备&lt;/h2&gt;
&lt;p&gt;这里唯一需要的安装的软件就是 docker, 当然文末也提供了&lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt;文件可以通过 docker-compose up 方便的一键运行复制集集群。基于 docker, 我们甚至不需要本地安装 mongodb, 所有的 mongodb 实例均运行在 docker 容器里面。&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;安装 docker, 参考&lt;a href=&quot;https://docs.docker.com/engine/getstarted/step_one/&quot;&gt;官方文档&lt;/a&gt;, 也可以通过阿里云镜像快速安装&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -＃ 阿里云镜像快速安装

docker -v # 打印 docker 版本以确保安装正确&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;拉取官方 mongo 镜像&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker pull mongo　＃拉取最新版本
docker pull mongo:3.2 ＃拉取 mongo 版本为 3.2&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;总览&quot;&gt;&lt;a href=&quot;#%E6%80%BB%E8%A7%88&quot; aria-label=&quot;总览 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;总览&lt;/h2&gt;
&lt;p&gt;我们将从 mongo 镜像运行 3 个容器 mongo1,mongo2,mongo3。这三个容器需要网络互通，它们将作为实例组合成一个 mongo 集群。其中 mongo1 作为 primary 实例，暴露端口 3001。mongo2 和 mongo3 均作为 sencodary 实例，分别对外暴露端口 3002,3003。&lt;/p&gt;
&lt;p&gt;
  &lt;a
    class=&quot;gatsby-resp-image-link&quot;
    href=&quot;/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png&quot;
    style=&quot;display: block&quot;
    target=&quot;_blank&quot;
    rel=&quot;noopener&quot;
  &gt;
  
  &lt;span
    class=&quot;gatsby-resp-image-wrapper&quot;
    style=&quot;position: relative; display: block;  max-width: 528px; margin-left: auto; margin-right: auto;&quot;
  &gt;
    &lt;span
      class=&quot;gatsby-resp-image-background-image&quot;
      style=&quot;padding-bottom: 60.03787878787878%; position: relative; bottom: 0; left: 0; background-image: url(&apos;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA3XAAAN1wFCKJt4AAAClUlEQVQoz2MoXrCfoWjhfgYQKF4IYQPFGKF8JSD2LZi/16N62WGP8sUHQGx5kFwRUE3xwn1gPRD+PgY4uPniI8PVB88Y/316BTaobPEBZhAN1NzavefO//4dl//P3H/9/4T99/7nzt1TDZIDGs4Eov9/ecN4+d4TxltAM8Cge8NxBmTgXDWfKX/+Phaorfqliw6kAC2IBbLjShbtTylcsE8bJFe48ACLakI7I7LehqV7gTb8/w/mfPj7n/vCnSdqeUtOcJYu3MtRsugA5/KNO8ByQDX8X75+EwWxVxw4D/TqAc6COTs52nfd5rp0/7n64w/fOaHqICY/evM5/Py12zcOnzhz48GLN/vuvvqkALP17rM3U46cPn/35Pkr9x69+TQLJv7i8y+5mw+fHth/9MTNq3ceXHv09ksk3KkP33yWvfHohfeZ63cDH7356HD69jMemNyzj9/1L9x64H/x9qPAJ+++GsHE77/7wfXg9UfHk5dvBd97/sbj7ssPcgwozmRg4MrKzFCDcaIS0+AWWpmZiAX4+cjC1CPpYSgrLVEFUhwg9p1HzxBh6ukfLJieV6xgbWnBihzQnBwc7LHJ6eIp2QXSQC5cQ05RKaOSiipPYVWDrIubuyBcg62tHUgRt79/gPikyZNBXuJVUlIGJwl5eQVQbHNXVVcrt7S26gDZbDDXsbOzgyKCp3/CBGMPDw8JIBvqEHZusEOYuQV4GZj4+EAivKJSUJcwMgFNBoYnKy8DhzAvC0jTLrh32VlYWLgZeCRBruPg4eFhQUl/fMJiAnJqOmIIm+CASUhCWkRWTUeYARNwSympSzIzM4McwgC0ACLKys4J9jYIMzGzoNjEyMQMsoAX5AugOiY0A9mgEQJ3BABYqgR8vAAn8QAAAABJRU5ErkJggg==&apos;); background-size: cover; display: block;&quot;
    &gt;
      &lt;img
        class=&quot;gatsby-resp-image-image&quot;
        style=&quot;width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;&quot;
        alt=&quot;mongo-replset-structure&quot;
        title=&quot;&quot;
        src=&quot;/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png&quot;
        srcset=&quot;/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/a3b1f/mongo-replset-structure.png 197w,
/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/07137/mongo-replset-structure.png 393w,
/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png 528w&quot;
        sizes=&quot;(max-width: 528px) 100vw, 528px&quot;
      /&gt;
    &lt;/span&gt;
  &lt;/span&gt;
  
  &lt;/a&gt;
    &lt;/p&gt;
&lt;h2 id=&quot;设置网络&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C&quot; aria-label=&quot;设置网络 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置网络&lt;/h2&gt;
&lt;p&gt;创建名为 mongo_repset 的网络&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker network create mongo_replset&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;查看网络是否创建成功&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker network ls | grep mongo_replset&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;设置数据卷&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%8D%B7&quot; aria-label=&quot;设置数据卷 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置数据卷&lt;/h2&gt;
&lt;p&gt;如果没有数据卷，数据会随着容器的销毁而丢失，所以我们需要设置一个空间用来存储 mongo 产生的数据，所以创建如下数据卷&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker volume create mongo1
docker volume create mongo2
docker volume create mongo3&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;运行镜像&quot;&gt;&lt;a href=&quot;#%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F&quot; aria-label=&quot;运行镜像 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;运行镜像&lt;/h2&gt;
&lt;p&gt;首先启动作为 primary 实例的容器&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker run -p 3001:27017 --name mongo1 -v mongo1:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;命令解释如下：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;docker run&lt;/code&gt;: 运行容器&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-p 3001:27017&lt;/code&gt;: 暴露端口 27017 到内部网络，暴露 3001 到外部网络&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--name mongo1&lt;/code&gt;: 设置容器名为 mongo1, 容器名同时作为域名暴露给内部网络，所以内部网络中可以通过 mongo1:27017 访问服务&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;-v mongo1&lt;/code&gt;: 挂载数据卷 mongo1 到容器的 /data/db 路径，mongo 默认将所有数据存储到 /data/db&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;--net mongo_replset&lt;/code&gt;: 容器运行在 mongo_replset 网络里&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;mongo&lt;/code&gt;: 镜像&lt;/li&gt;
&lt;li&gt;&lt;code class=&quot;language-text&quot;&gt;mongod --replSet mongo-repl-set&lt;/code&gt;: 运行 mongod 实例并将实例添加到 mongo-repl-set 复制集&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;再启动作为 secondary 复制集的容器&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker run -p 3002:27017 --name mongo2 -v mongo2:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set

docker run -p 3003:27017 --name mongo3 -v mongo3:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;因为所有实例都加入了 mongo_replset 网路，所以各实例可以互相 ping 通&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker exec -it mongo1 ping -c 3 mongo2

PING mongo2 (10.0.0.8): 56 data bytes
64 bytes from 10.0.0.8: icmp_seq=0 ttl=64 time=0.028 ms
64 bytes from 10.0.0.8: icmp_seq=1 ttl=64 time=0.138 ms
--- m2 ping statistics ---
2 packets transmitted, 2 packets received, 0% packet loss
round-trip min/avg/max/stddev = 0.028/0.083/0.138/0.055 ms

docker exec -it mongo1 ping -c 3 mongo3
docker exec -it mongo2 ping -c 3 mongo1&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;设置复制集&quot;&gt;&lt;a href=&quot;#%E8%AE%BE%E7%BD%AE%E5%A4%8D%E5%88%B6%E9%9B%86&quot; aria-label=&quot;设置复制集 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;设置复制集&lt;/h2&gt;
&lt;p&gt;上面我们设置并运行了 mongo 实例，现在我们将它们组合成复制集集群&lt;/p&gt;
&lt;p&gt;选择一个容器并运行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker exec -it mongo1 mongo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;上述命令会带我们进入 mongo shell，在 mongo shell 中运行&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;&amp;gt; db = (new Mongo(&amp;#39;localhost:27017&amp;#39;)).getDB(&amp;#39;test&amp;#39;)
test
&amp;gt; rs.initiate({
    &amp;quot;_id&amp;quot;: &amp;quot;mongo-repl-set&amp;quot;,
    &amp;quot;members&amp;quot;: [
        {
            &amp;quot;_id&amp;quot;: 0,
            &amp;quot;host&amp;quot;: &amp;quot;mongo1:27017&amp;quot;
        },
        {
            &amp;quot;_id&amp;quot;: 1,
            &amp;quot;host&amp;quot;: &amp;quot;mongo2:27017&amp;quot;
        },
        {
            &amp;quot;_id&amp;quot;: 2,
            &amp;quot;host&amp;quot;: &amp;quot;mongo3:27017&amp;quot;
        }
    ]
  })

{ &amp;quot;ok&amp;quot;: 1 }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;rs.initiate&lt;/code&gt;调用的是一个配置对象，其_id 字段传入复制集名，也就是前面运行容器是选项&lt;code class=&quot;language-text&quot;&gt;replSet&lt;/code&gt;的值。members 传入加入到复制集实例。&lt;/p&gt;
&lt;p&gt;我们退出 mongo shell 后再次进入，可以看到 mongo shell 的提示符已经变为&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mongo-repl-set:PRIMARY&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;如果是从 mongo2 或者 mongo3 进入，可以看到提示符为&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mongo-repl-set:SECONDARY&amp;gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;测试验证&quot;&gt;&lt;a href=&quot;#%E6%B5%8B%E8%AF%95%E9%AA%8C%E8%AF%81&quot; aria-label=&quot;测试验证 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;测试验证&lt;/h2&gt;
&lt;p&gt;进入 primary 的 mongo shell&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker exec -it mongo1 mongo&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;插入一条数据&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mongo-repl-set:PRIMARY&amp;gt; db.mycoll.insert({name: &amp;#39;sample&amp;#39;})
WriteResult({ &amp;quot;nInserted&amp;quot; : 1 })
mongo-repl-set:PRIMARY&amp;gt; db.mycoll.find()
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;58c77fff35df208f17c3ad89&amp;quot;), &amp;quot;name&amp;quot; : &amp;quot;sample&amp;quot; }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;退出后进入 secondary 的 mongo shell&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mongo-repl-set:SECONDARY&amp;gt; use test
switched to db test
mongo-repl-set:SECONDARY&amp;gt; db.setSlaveOk()
mongo-repl-set:SECONDARY&amp;gt; db.mycoll.find()
{ &amp;quot;_id&amp;quot; : ObjectId(&amp;quot;58c77fff35df208f17c3ad89&amp;quot;), &amp;quot;name&amp;quot; : &amp;quot;sample&amp;quot; }&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;p&gt;&lt;code class=&quot;language-text&quot;&gt;db.setSlaveOk&lt;/code&gt;很关键，代表允许连接读取非 primary 实例数据，没有设置进行查询时报错&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;mongo-repl-set:SECONDARY&amp;gt; db.mycoll.find()
Error: error: {
        &amp;quot;ok&amp;quot; : 0,
        &amp;quot;errmsg&amp;quot; : &amp;quot;not master and slaveOk=false&amp;quot;,
        &amp;quot;code&amp;quot; : 13435,
        &amp;quot;codeName&amp;quot; : &amp;quot;NotMasterNoSlaveOk&amp;quot;
}&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;h2 id=&quot;docker-compose-复制集&quot;&gt;&lt;a href=&quot;#docker-compose-%E5%A4%8D%E5%88%B6%E9%9B%86&quot; aria-label=&quot;docker compose 复制集 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;docker-compose 复制集&lt;/h2&gt;
&lt;p&gt;尽管通过 docker 我们已经很方便的运行了一个复制集集群，但是我们还可以通过 docker-compose 启动整个集群&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;编写&lt;code class=&quot;language-text&quot;&gt;docker-compose.yml&lt;/code&gt;&lt;/li&gt;
&lt;/ul&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;version: &amp;quot;2&amp;quot;
services:

   mongo1:
    image: &amp;#39;mongo&amp;#39;
    ports:
      - 3001:27017
    volumes:
      - mongo1:/data/db
    command: bash -c &amp;quot;mongod --replSet mongo-repl-set &amp;amp;&amp;amp; mongo --eval &amp;#39;rs.initiate({\&amp;quot;_id\&amp;quot;:\&amp;quot;mongo-repl-set\&amp;quot;,\&amp;quot;members\&amp;quot;:[{\&amp;quot;_id\&amp;quot;:0,\&amp;quot;host\&amp;quot;:\&amp;quot;mongo1:27017\&amp;quot;},{\&amp;quot;_id\&amp;quot;:1,\&amp;quot;host\&amp;quot;:\&amp;quot;mongo2:27017\&amp;quot;},{\&amp;quot;_id\&amp;quot;:2,\&amp;quot;host\&amp;quot;:\&amp;quot;mongo3:27017\&amp;quot;}]})&amp;#39;&amp;quot;
    depends_on:
      - mongo2
      - mongo3

  mongo2:
    image: &amp;#39;mongo&amp;#39;
    ports:
      - 3002:27017
    volumes:
      - mongo2:/data/db
    command: mongod --replSet mongo-repl-set

  mongo3:
    image: &amp;#39;mongo&amp;#39;
    ports:
      - 3003:27017
    volumes:
      - mongo3:/data/db
    command: mongod --replSet mongo-repl-set

volumes:
  mongo1:
  mongo2:
  mongo3:&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;启动集群&lt;/p&gt;
&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;text&quot;&gt;&lt;pre class=&quot;language-text&quot;&gt;&lt;code class=&quot;language-text&quot;&gt;docker-compose up -d&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;
&lt;/li&gt;
&lt;/ul&gt;
&lt;h2 id=&quot;总结&quot;&gt;&lt;a href=&quot;#%E6%80%BB%E7%BB%93&quot; aria-label=&quot;总结 permalink&quot; class=&quot;anchor&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;总结&lt;/h2&gt;
&lt;p&gt;通过 docker, 我们很简单就搭建了一个 mongo 复制集集群。用来作为本地测试是完全没问题的，但是如果要运用到生产环境，还需注意如下几点&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;
&lt;p&gt;mongo 不添加任何参数，默认是没有权限验证的，运行到生产环境是需添加用户角色权限&lt;/p&gt;
&lt;/li&gt;
&lt;li&gt;
&lt;p&gt;实例均运行在一个机器上并不是一个好主意，可以通过 &lt;a href=&quot;https://docs.docker.com/engine/swarm/&quot;&gt;docker swarm&lt;/a&gt; 搭建集群&lt;/p&gt;
&lt;/li&gt;
&lt;/ul&gt;</content:encoded></item></channel></rss>