{"data":{"site":{"siteMetadata":{"title":"Sigoden | Blog","siteUrl":"https://blog.sigoden.com","siteAuthor":"sigoden","githubUrl":"https://github.com/sigoden"}},"markdownRemark":{"html":"<h2 id=\"npm-是什么\"><a href=\"#npm-%E6%98%AF%E4%BB%80%E4%B9%88\" aria-label=\"npm 是什么 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NPM 是什么</h2>\n<p>NPM（node package manager），通常称为 node 包管理器。顾名思义，它的主要功能就是管理 node 包，包括：安装、卸载、更新、查看、搜索、发布等，npm 将开发者从繁琐的包管理工作（版本、依赖等）中解放出来，更加专注于功能的开发。</p>\n<h2 id=\"npm-模块复制\"><a href=\"#npm-%E6%A8%A1%E5%9D%97%E5%A4%8D%E5%88%B6\" aria-label=\"npm 模块复制 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>NPM 模块复制</h2>\n<p>从 npm3 开始，npm 对包安装进行了优化，如果模块 A 和模块 C 都依赖了模块 B, 模块 B 将只安装一次。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 460px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 55.869565217391305%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAB5UlEQVQoz2NgIB8wkqrBAYibgHgBCwvLKk5OzqVAugfID2ViYmIn1lCYghVA/B+EnZ2d/3t7e/+Pior6r6qqChZjZGS8CaRFiTEUJtkOxL9BmvX19cEGiYmJ/WdnZ/8PtWgTEPNhNaGjo4PB19eXce3atWC+oKAgi7qGBoipAjQ9FEiXg5QBcTUQxwNdZw6kmUEKGvOTGbwcLBmD3O0ZA93sGN3tzNGcx8jIycfHx8nOwcGMzxsszMxsQIoLn3f52djYxIA0O8x2BmlpRigbpFkSymYRYGdjAkk7WhjxGmqpyqsqyGo7WRqLOFkaiVoa6TAznDt3LvPevXvvt23bdv3gwYOXnz19+vzQ6dPOIINOMTMfOc/AcKuZgeHaEQaGuycYGFYypMeALUwJ9ZmdExv8A+jV1wnBXi8zIgPeR/q6qDGcPn266T8QbN++/f/+/fv///3z5//hs2eDgHo4zjAzf70PjIQZQHwNiE8yMFxmSIoAG5gc4r0gOybof7i385vEEO8PaRH+3yJ9XNQZNmzYILBlyxblBw8eKFy9elVh+7Ztyis3beLiBIbPQiYmxWUMDKpbgBG0moFBbQ4DgyyDmx04RPycrPmArhMDukwkwsdF1M/ZRtTd1pyZrCySFhWAUw4AFJORLIecktAAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"npm-copy\"\n        title=\"\"\n        src=\"/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png\"\n        srcset=\"/static/506f6dda43f4703ffe0be70e037f1428/a3b1f/npm-module-copy.png 197w,\n/static/506f6dda43f4703ffe0be70e037f1428/07137/npm-module-copy.png 393w,\n/static/506f6dda43f4703ffe0be70e037f1428/a9ee3/npm-module-copy.png 460w\"\n        sizes=\"(max-width: 460px) 100vw, 460px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>在早期版本，依赖的模块是直接装在模块自己的 node_modules 下的\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 550px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.54545454545455%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAACF0lEQVQoz2NgwA84gVgAiPmBmB1JnJGBSABT6AzEq9nY2K6rqKi8NjY2fiUqKnoJKLaQmZnZkBRDmcAqGRm3Aan/0tLS/319ff/b2Nj8FxYW/g8SA8pNQFaLFezfv5/x/v37TP///2f89OkTE9BlYkDhKCDuB+JlQLwUiLuAhoUAncUFVMcQ6evCHORuz5wU4s2kq64MNifcG+ixb9++MZAImLEJOpgbIjiHDx+Wmzx5svPq1atNz549q79+/XpQJDAoKSkxc3BwMAHDjYmPh5sZ6gqu2AAPR1drU38/Zxs3oAtNNJXlwd4P83KCGHj79u2t79+9+79h7dr/f3/9+n9s3744kPit16+Zk6CWxgd5gjVF+7kZFiWF/08L9fmfFxP0PzPc732arBQPSC4iwh+i+MzJk3FXHj1q3nL9ev6jHz+qjv3/LwkSP1dVBQ/4UE9HcKwGOtuIJoT65HgkRUR4pURG+eYmusHUVKgoAKNt40awwskMDKrngK5uZmDw2c7AkLSHhcUYJL4HKXn8XzMTHky3GRgiDzMwpK1jYMg4xcCQVwiMLIgiaCBvY2Vd/J2J6T8wof2/xcj4/wQDQy9I/DgDAwuIVpGXZngENbyck0P5PEgNEK9jZPh/E2hMGQODONjA+VBFOxgY1PYzMPjtZGBwB7rKbzPQxVBxuAtbofQioCXAhGoMxFabGBgsgT4yK4VaDADotqJsJhLRJAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"npm-old\"\n        title=\"\"\n        src=\"/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png\"\n        srcset=\"/static/ce417f50b5204e831551cfd3921b4792/a3b1f/npm-module-old.png 197w,\n/static/ce417f50b5204e831551cfd3921b4792/07137/npm-module-old.png 393w,\n/static/ce417f50b5204e831551cfd3921b4792/2cf63/npm-module-old.png 550w\"\n        sizes=\"(max-width: 550px) 100vw, 550px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>这也是为什么用户在切换到 npm3 后 node_modules 下无缘无故多出那么多包的原因</p>\n<h2 id=\"安装顺序对包结构影响\"><a href=\"#%E5%AE%89%E8%A3%85%E9%A1%BA%E5%BA%8F%E5%AF%B9%E5%8C%85%E7%BB%93%E6%9E%84%E5%BD%B1%E5%93%8D\" aria-label=\"安装顺序对包结构影响 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>安装顺序对包结构影响</h2>\n<h4 id=\"生成测试包\"><a href=\"#%E7%94%9F%E6%88%90%E6%B5%8B%E8%AF%95%E5%8C%85\" aria-label=\"生成测试包 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>生成测试包</h4>\n<p>生成包<code class=\"language-text\">a@1.0.0</code>, <code class=\"language-text\">b@1.0.0</code>,<code class=\"language-text\">b@2.0.0</code>, <code class=\"language-text\">c@1.0.0</code>，其中<code class=\"language-text\">a@1.0.0</code>依赖<code class=\"language-text\">b@1.0.0</code>, <code class=\"language-text\">c@1.0.0</code>依赖<code class=\"language-text\">b@2.0.0</code></p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">创建包目录\nmkdir -p /tmp/repositories/{a-1.0.0, b-1.0.0, b-2.0.0, c-1.0.0}\n\nb@1.0.0\nvi /tmp/repositories/b-1.0.0/index.js\nmodule.exports = &#39;b-1.0.0&#39;\n\nvi /tmp/repositories/b-1.0.0/package.json\n{\n  &quot;name&quot;: &quot;b&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;\n}\n\nb@2.0.0\nvi /tmp/repositories/b-2.0.0/index.js\nmodule.exports = &#39;b-2.0.0&#39;\n\nvi /tmp/repositories/a-2.0.0/package.json\n{\n  &quot;name&quot;: &quot;b&quot;,\n  &quot;version&quot;: &quot;2.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;\n}\n\n\na@1.0.0\nvi /tmp/repositories/a-1.0.0/index.js\nexports.a = &#39;a-1.0.0&#39;\nexports.b = require(&#39;b&#39;)\n\nvi /tmp/repositories/a-1.0.0/index.js\n{\n  &quot;name&quot;: &quot;a&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;dependencies&quot;: {\n    &quot;b&quot;: &quot;file:///tmp/repositories/b-1.0.0/b-1.0.0.tgz&quot;\n  }\n}\n\n\nc@1.0.0\nvi /tmp/repositories/c-1.0.0/index.js\nexports.c = &#39;c-1.0.0&#39;\nexports.b = require(&#39;b&#39;)\n\nvi /tmp/repositories/c-1.0.0/index.js\n{\n  &quot;name&quot;: &quot;c&quot;,\n  &quot;version&quot;: &quot;1.0.0&quot;,\n  &quot;main&quot;: &quot;index.js&quot;,\n  &quot;dependencies&quot;: {\n    &quot;b&quot;: &quot;file:///tmp/repositories/b-2.0.0/b-2.0.0.tgz&quot;\n  }\n}</code></pre></div>\n<h4 id=\"测试包打包-tarball\"><a href=\"#%E6%B5%8B%E8%AF%95%E5%8C%85%E6%89%93%E5%8C%85-tarball\" aria-label=\"测试包打包 tarball permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>测试包打包 tarball</h4>\n<p>为了方便安装，我们通过<code class=\"language-text\">npm pack</code>将包转换为 tgz 文件</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">cd /tmp/repositories/a-1.0.0 &amp;&amp; npm pack\ncd /tmp/repositories/b-1.0.0 &amp;&amp; npm pack\ncd /tmp/repositories/b-2.0.0 &amp;&amp; npm pack\ncd /tmp/repositories/c-1.0.0 &amp;&amp; npm pack</code></pre></div>\n<h4 id=\"先安装包-a-再安装包-c\"><a href=\"#%E5%85%88%E5%AE%89%E8%A3%85%E5%8C%85-a-%E5%86%8D%E5%AE%89%E8%A3%85%E5%8C%85-c\" aria-label=\"先安装包 a 再安装包 c permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>先安装包 a, 再安装包 c</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir /tmp/stage1\ncd /tmp/stage1\nnpm i /tmp/repositories/a-1.0.0/a-1.0.0.tgz\nnpm i /tmp/repositories/c-1.0.0/c-1.0.0.tgz\n\n查看目录结构\ntree /tmp/stage1\n.\n├── node_modules\n│   ├── a\n│   │   ├── index.js\n│   │   └── package.json\n│   ├── b\n│   │   ├── index.js\n│   │   └── package.json\n│   └── c\n│       ├── index.js\n│       ├── node_modules\n│       │   └── b\n│       │       ├── index.js\n│       │       └── package.json\n│       └── package.json\n└── README.md\n\n查看外部包 b 的版本\ncat node_modules/b/package.json | grep version #1.0.0\n\n查看包 c 依赖包 b 的版本\ncat node_modules/c/node_modules/b/package.json | grep version #2.0.0</code></pre></div>\n<p>可以看到在安装包 a 时，npm 同时将其依赖包<code class=\"language-text\">b@1.0.0</code>安装在最外层<code class=\"language-text\">node_modules</code>下，而安装包 c 时，npm 检查到包 b 已存在但是不同版本，将包 b 安装到包 c 自己的 node_modules 下\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 473px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 56.02536997885835%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAYAAAB/Ca1DAAAACXBIWXMAAA3XAAAN1wFCKJt4AAACKUlEQVQoz5WTUWiSURTH/+ebNqO9zjAaZWJPiyT8kBBdORfbnKW04WaxaINysIiCyAcJoh4j9mCRQVDgXOzBlB5kc+ZaD7aZvvgig/IhyFXIogbbU7fzmbSCxdiB3/eH797z59xzzwX+DVI+uzhYBpgJ5gWTYp4zdxgbdhIaDpaiWq0WZrNZWCwWIcuysNlswmAwCF4TRDTR2C5taxgIBBQJS5L0Q6fTCb1eL4xGY121Wq1iWGWG/2sYj8cRiURICIFyuUyHjcbmxlIb082MMFeZ84ydq2tVFt0Oq5R6co9GB/qkc2dOST5XJ21VoLrRR9quM1tVN9LvAqLRaEswGDwSCoXa0+l0W35paX94akplYfPLRHvvA61OoP0uoLtN1KIkeu0Wlf9011G7bHK6ThzvGPN7jnGVB+qulUrlVjabFYlEYq1UKq2/zeXE9MqKcQGQZ4g2wsD3LLA2x5fxlHBdyRl2WA9dPNv7c6jPKS753GJsyCMGXZ2TdUM2ucaVrSaTyeVcLvdhYX6+Ol2rHZwFzCmi1QfAlxng00tg/TFwRcnxW+V9F7w9c/29jtd+b/esz931ztNz8safs/OF0N+oTCZ08P9xoElsohKbvVX6R+I3mhqPbh7YHSPag52GMjc31SoJmmY1T3zsEfD1FfD+DfCRp7+ITCaDQqGAYrFYJ7+4iMlqtf48EkR4xsqbkW08lXHFVNUEjA4iDiQfAhusn7kl32LA8i+pS8W7hfu65QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"npm-a-and-c\"\n        title=\"\"\n        src=\"/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png\"\n        srcset=\"/static/1cb4993c3f0f13f0f8097afbd8decadd/a3b1f/npm-a-and-c.png 197w,\n/static/1cb4993c3f0f13f0f8097afbd8decadd/07137/npm-a-and-c.png 393w,\n/static/1cb4993c3f0f13f0f8097afbd8decadd/f87d7/npm-a-and-c.png 473w\"\n        sizes=\"(max-width: 473px) 100vw, 473px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h4 id=\"先安装包-c-再安装包-a\"><a href=\"#%E5%85%88%E5%AE%89%E8%A3%85%E5%8C%85-c-%E5%86%8D%E5%AE%89%E8%A3%85%E5%8C%85-a\" aria-label=\"先安装包 c 再安装包 a permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>先安装包 c, 再安装包 a</h4>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mkdir /tmp/stage2\ncd /tmp/stage2\nnpm i /tmp/repositories/c-1.0.0/c-1.0.0.tgz\nnpm i /tmp/repositories/a-1.0.0/a-1.0.0.tgz\n\n查看目录结构\ntree /tmp/stage2\n.\n├── node_modules\n│   ├── a\n│   │   ├── index.js\n│   │   ├── node_modules\n│   │   │   └── b\n│   │   │       ├── index.js\n│   │   │       └── package.json\n│   │   └── package.json\n│   ├── b\n│   │   ├── index.js\n│   │   └── package.json\n│   └── c\n│       ├── index.js\n│       └── package.json\n└── README.md\n\n查看外部包 b 的版本\ncat node_modules/b/package.json | grep version #2.0.0\n\n查看包 c 依赖包 b 的版本\ncat node_modules/a/node_modules/b/package.json | grep version #1.0.0</code></pre></div>\n<p>可以看到在安装包 c 时，npm 同时将其依赖包<code class=\"language-text\">b@2.0.0</code>安装在最外层<code class=\"language-text\">node_modules</code>下，而安装包 a 时，npm 检查到包 b 已存在但是不同版本，将包 b 安装到包 a 自己的 node_modules 下\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 463px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 58.09935205183585%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA3XAAAN1wFCKJt4AAACNUlEQVQoz5WTTWgTURDH/28T16QxmtiL9YuivenNoFBKRUo2iY2bbpqKNoVqxQoKHkTRg1e9tIUgYsH2YlE8qPhZE5pYhJhImoYcQi4JeAm0B6FioeAH9Pnf0ICIWjrw29k382Z23sxb4O+ymRwkAWKsaXOtYiNioVBdE0JUrVbrD5vNJmmqo6rqd0VRKvRfoV1ZL5cwHwzYQbVKLT0ej/R6vTIYDEpN0+q43W5J/zcm3PV73HrSTu6zogKrXLTb7Z8dDsei0+mc53qSvkP/TSalFCa6rtva2tpcDfsNBjQDTYzayaWjYVc3qUqza+uWft1rYRyGT+mWM73HLWHfUYGNSruqKi2tu//Zv6iuAbFY7HIikRgslUonP2YyfaPZbNME4H4qRM9DIHgPGJoBInHgcCNwMBw4EQkcu6l3ddw61xe8ejbSfd3QOlvrzmq1Kmu1mqxUKrJYKMjJlZU9H4DOshByjB3JkyJ5DKQbCS+cDr0fCGlyKNItL/Yb8lLUkOGuDqPuTKVS0/l8/nk2m32VSaefjC8vu18CB5JCpO/SnQBmXgPZR8DtRsIBXRuOhnwTvT3+kYjhH+0z/HeOhHz7NtzD838OFNhOXD8JT9EyK8RexONxUS6XBSsUPLKY5uS4AUXe7v2cNKsVU2TEvCbbnGaS+jSnFKWXVa8+AJYywNdZ4AtZQjKZxNzcHHK5HHhkjC0sgJvwlrwg78y2rL2b8ok/lKmT/CWfschxwj2SH5ZvyC9oD8UYvEHYiAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"npm-c-and-a\"\n        title=\"\"\n        src=\"/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png\"\n        srcset=\"/static/6cd211db829797e4beb9ee88458f093c/a3b1f/npm-c-and-a.png 197w,\n/static/6cd211db829797e4beb9ee88458f093c/07137/npm-c-and-a.png 393w,\n/static/6cd211db829797e4beb9ee88458f093c/2af9b/npm-c-and-a.png 463w\"\n        sizes=\"(max-width: 463px) 100vw, 463px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id=\"结论\"><a href=\"#%E7%BB%93%E8%AE%BA\" aria-label=\"结论 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>结论</h2>\n<p>从上面的测试中可以看到，安装同样的包，因为安装顺序的不一致，会产生不一致的目录结构。如果安装顺序一致，<code class=\"language-text\">node_modules</code>目录结构也会是一致的。</p>","excerpt":"NPM 是什么 NPM（node package manager），通常称为 node 包管理器。顾名思义，它的主要功能就是管理 node 包，包括：安装、卸载、更新、查看、搜索、发布等，npm 将开发者从繁琐的包管理工作（版本、依赖等）中解放出来，更加专注于功能的开发。 NPM…","timeToRead":4,"headings":[{"value":"NPM 是什么","depth":2},{"value":"NPM 模块复制","depth":2},{"value":"安装顺序对包结构影响","depth":2},{"value":"生成测试包","depth":4},{"value":"测试包打包 tarball","depth":4},{"value":"先安装包 a, 再安装包 c","depth":4},{"value":"先安装包 c, 再安装包 a","depth":4},{"value":"结论","depth":2}],"frontmatter":{"title":"npm 安装的包为什么不一致","notoc":null,"excerpt":"npm 包在安装是可能会产生不一致的目录，这是如何产生的？本文将对不一致原因进行分析。","date":"March 25th 2017","rawDate":"2017-03-25"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/npman-zhuang-de-bao-wei-shi-yao-bu-yi-zhi/","prev":{"fields":{"slug":"/nodejszhi-chuang-jian-zui-xiao-dockerjing-xiang/"},"frontmatter":{"title":"创建极简 nodejs docker 镜像","draft":null,"tags":["howto","nodejs","docker"]}},"next":{"fields":{"slug":"/cong-ling-kai-shi-da-jian-vagrantrong-qi-2/"},"frontmatter":{"title":"从零开始创建 Vagrant 镜像","draft":null,"tags":["howto","vagrant"]}}}}