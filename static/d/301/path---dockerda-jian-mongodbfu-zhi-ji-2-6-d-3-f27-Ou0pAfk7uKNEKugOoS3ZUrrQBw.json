{"data":{"site":{"siteMetadata":{"title":"Sigoden | Blog","siteUrl":"https://blog.sigoden.com","siteAuthor":"sigoden","githubUrl":"https://github.com/sigoden"}},"markdownRemark":{"html":"<h2 id=\"准备\"><a href=\"#%E5%87%86%E5%A4%87\" aria-label=\"准备 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>准备</h2>\n<p>这里唯一需要的安装的软件就是 docker, 当然文末也提供了<code class=\"language-text\">docker-compose.yml</code>文件可以通过 docker-compose up 方便的一键运行复制集集群。基于 docker, 我们甚至不需要本地安装 mongodb, 所有的 mongodb 实例均运行在 docker 容器里面。</p>\n<ul>\n<li>安装 docker, 参考<a href=\"https://docs.docker.com/engine/getstarted/step_one/\">官方文档</a>, 也可以通过阿里云镜像快速安装</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">curl -sSL http://acs-public-mirror.oss-cn-hangzhou.aliyuncs.com/docker-engine/internet | sh -＃ 阿里云镜像快速安装\n\ndocker -v # 打印 docker 版本以确保安装正确</code></pre></div>\n<ul>\n<li>拉取官方 mongo 镜像</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker pull mongo　＃拉取最新版本\ndocker pull mongo:3.2 ＃拉取 mongo 版本为 3.2</code></pre></div>\n<h2 id=\"总览\"><a href=\"#%E6%80%BB%E8%A7%88\" aria-label=\"总览 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总览</h2>\n<p>我们将从 mongo 镜像运行 3 个容器 mongo1,mongo2,mongo3。这三个容器需要网络互通，它们将作为实例组合成一个 mongo 集群。其中 mongo1 作为 primary 实例，暴露端口 3001。mongo2 和 mongo3 均作为 sencodary 实例，分别对外暴露端口 3002,3003。</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 528px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.03787878787878%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAAA3XAAAN1wFCKJt4AAAClUlEQVQoz2MoXrCfoWjhfgYQKF4IYQPFGKF8JSD2LZi/16N62WGP8sUHQGx5kFwRUE3xwn1gPRD+PgY4uPniI8PVB88Y/316BTaobPEBZhAN1NzavefO//4dl//P3H/9/4T99/7nzt1TDZIDGs4Eov9/ecN4+d4TxltAM8Cge8NxBmTgXDWfKX/+Phaorfqliw6kAC2IBbLjShbtTylcsE8bJFe48ACLakI7I7LehqV7gTb8/w/mfPj7n/vCnSdqeUtOcJYu3MtRsugA5/KNO8ByQDX8X75+EwWxVxw4D/TqAc6COTs52nfd5rp0/7n64w/fOaHqICY/evM5/Py12zcOnzhz48GLN/vuvvqkALP17rM3U46cPn/35Pkr9x69+TQLJv7i8y+5mw+fHth/9MTNq3ceXHv09ksk3KkP33yWvfHohfeZ63cDH7356HD69jMemNyzj9/1L9x64H/x9qPAJ+++GsHE77/7wfXg9UfHk5dvBd97/sbj7ssPcgwozmRg4MrKzFCDcaIS0+AWWpmZiAX4+cjC1CPpYSgrLVEFUhwg9p1HzxBh6ukfLJieV6xgbWnBihzQnBwc7LHJ6eIp2QXSQC5cQ05RKaOSiipPYVWDrIubuyBcg62tHUgRt79/gPikyZNBXuJVUlIGJwl5eQVQbHNXVVcrt7S26gDZbDDXsbOzgyKCp3/CBGMPDw8JIBvqEHZusEOYuQV4GZj4+EAivKJSUJcwMgFNBoYnKy8DhzAvC0jTLrh32VlYWLgZeCRBruPg4eFhQUl/fMJiAnJqOmIIm+CASUhCWkRWTUeYARNwSympSzIzM4McwgC0ACLKys4J9jYIMzGzoNjEyMQMsoAX5AugOiY0A9mgEQJ3BABYqgR8vAAn8QAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"mongo-replset-structure\"\n        title=\"\"\n        src=\"/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png\"\n        srcset=\"/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/a3b1f/mongo-replset-structure.png 197w,\n/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/07137/mongo-replset-structure.png 393w,\n/static/0eb8bb814f0afcc1cc7c9d7ab263ed99/b25e2/mongo-replset-structure.png 528w\"\n        sizes=\"(max-width: 528px) 100vw, 528px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<h2 id=\"设置网络\"><a href=\"#%E8%AE%BE%E7%BD%AE%E7%BD%91%E7%BB%9C\" aria-label=\"设置网络 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设置网络</h2>\n<p>创建名为 mongo_repset 的网络</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker network create mongo_replset</code></pre></div>\n<p>查看网络是否创建成功</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker network ls | grep mongo_replset</code></pre></div>\n<h2 id=\"设置数据卷\"><a href=\"#%E8%AE%BE%E7%BD%AE%E6%95%B0%E6%8D%AE%E5%8D%B7\" aria-label=\"设置数据卷 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设置数据卷</h2>\n<p>如果没有数据卷，数据会随着容器的销毁而丢失，所以我们需要设置一个空间用来存储 mongo 产生的数据，所以创建如下数据卷</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker volume create mongo1\ndocker volume create mongo2\ndocker volume create mongo3</code></pre></div>\n<h2 id=\"运行镜像\"><a href=\"#%E8%BF%90%E8%A1%8C%E9%95%9C%E5%83%8F\" aria-label=\"运行镜像 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>运行镜像</h2>\n<p>首先启动作为 primary 实例的容器</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run -p 3001:27017 --name mongo1 -v mongo1:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set</code></pre></div>\n<p>命令解释如下：</p>\n<ul>\n<li><code class=\"language-text\">docker run</code>: 运行容器</li>\n<li><code class=\"language-text\">-p 3001:27017</code>: 暴露端口 27017 到内部网络，暴露 3001 到外部网络</li>\n<li><code class=\"language-text\">--name mongo1</code>: 设置容器名为 mongo1, 容器名同时作为域名暴露给内部网络，所以内部网络中可以通过 mongo1:27017 访问服务</li>\n<li><code class=\"language-text\">-v mongo1</code>: 挂载数据卷 mongo1 到容器的 /data/db 路径，mongo 默认将所有数据存储到 /data/db</li>\n<li><code class=\"language-text\">--net mongo_replset</code>: 容器运行在 mongo_replset 网络里</li>\n<li><code class=\"language-text\">mongo</code>: 镜像</li>\n<li><code class=\"language-text\">mongod --replSet mongo-repl-set</code>: 运行 mongod 实例并将实例添加到 mongo-repl-set 复制集</li>\n</ul>\n<p>再启动作为 secondary 复制集的容器</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker run -p 3002:27017 --name mongo2 -v mongo2:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set\n\ndocker run -p 3003:27017 --name mongo3 -v mongo3:/data/db --net mongo_replset mongo mongod --replSet mongo-repl-set</code></pre></div>\n<p>因为所有实例都加入了 mongo_replset 网路，所以各实例可以互相 ping 通</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker exec -it mongo1 ping -c 3 mongo2\n\nPING mongo2 (10.0.0.8): 56 data bytes\n64 bytes from 10.0.0.8: icmp_seq=0 ttl=64 time=0.028 ms\n64 bytes from 10.0.0.8: icmp_seq=1 ttl=64 time=0.138 ms\n--- m2 ping statistics ---\n2 packets transmitted, 2 packets received, 0% packet loss\nround-trip min/avg/max/stddev = 0.028/0.083/0.138/0.055 ms\n\ndocker exec -it mongo1 ping -c 3 mongo3\ndocker exec -it mongo2 ping -c 3 mongo1</code></pre></div>\n<h2 id=\"设置复制集\"><a href=\"#%E8%AE%BE%E7%BD%AE%E5%A4%8D%E5%88%B6%E9%9B%86\" aria-label=\"设置复制集 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>设置复制集</h2>\n<p>上面我们设置并运行了 mongo 实例，现在我们将它们组合成复制集集群</p>\n<p>选择一个容器并运行</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker exec -it mongo1 mongo</code></pre></div>\n<p>上述命令会带我们进入 mongo shell，在 mongo shell 中运行</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&gt; db = (new Mongo(&#39;localhost:27017&#39;)).getDB(&#39;test&#39;)\ntest\n&gt; rs.initiate({\n    &quot;_id&quot;: &quot;mongo-repl-set&quot;,\n    &quot;members&quot;: [\n        {\n            &quot;_id&quot;: 0,\n            &quot;host&quot;: &quot;mongo1:27017&quot;\n        },\n        {\n            &quot;_id&quot;: 1,\n            &quot;host&quot;: &quot;mongo2:27017&quot;\n        },\n        {\n            &quot;_id&quot;: 2,\n            &quot;host&quot;: &quot;mongo3:27017&quot;\n        }\n    ]\n  })\n\n{ &quot;ok&quot;: 1 }</code></pre></div>\n<p><code class=\"language-text\">rs.initiate</code>调用的是一个配置对象，其_id 字段传入复制集名，也就是前面运行容器是选项<code class=\"language-text\">replSet</code>的值。members 传入加入到复制集实例。</p>\n<p>我们退出 mongo shell 后再次进入，可以看到 mongo shell 的提示符已经变为</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mongo-repl-set:PRIMARY&gt;</code></pre></div>\n<p>如果是从 mongo2 或者 mongo3 进入，可以看到提示符为</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mongo-repl-set:SECONDARY&gt;</code></pre></div>\n<h2 id=\"测试验证\"><a href=\"#%E6%B5%8B%E8%AF%95%E9%AA%8C%E8%AF%81\" aria-label=\"测试验证 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>测试验证</h2>\n<p>进入 primary 的 mongo shell</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker exec -it mongo1 mongo</code></pre></div>\n<p>插入一条数据</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mongo-repl-set:PRIMARY&gt; db.mycoll.insert({name: &#39;sample&#39;})\nWriteResult({ &quot;nInserted&quot; : 1 })\nmongo-repl-set:PRIMARY&gt; db.mycoll.find()\n{ &quot;_id&quot; : ObjectId(&quot;58c77fff35df208f17c3ad89&quot;), &quot;name&quot; : &quot;sample&quot; }</code></pre></div>\n<p>退出后进入 secondary 的 mongo shell</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mongo-repl-set:SECONDARY&gt; use test\nswitched to db test\nmongo-repl-set:SECONDARY&gt; db.setSlaveOk()\nmongo-repl-set:SECONDARY&gt; db.mycoll.find()\n{ &quot;_id&quot; : ObjectId(&quot;58c77fff35df208f17c3ad89&quot;), &quot;name&quot; : &quot;sample&quot; }</code></pre></div>\n<p><code class=\"language-text\">db.setSlaveOk</code>很关键，代表允许连接读取非 primary 实例数据，没有设置进行查询时报错</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">mongo-repl-set:SECONDARY&gt; db.mycoll.find()\nError: error: {\n        &quot;ok&quot; : 0,\n        &quot;errmsg&quot; : &quot;not master and slaveOk=false&quot;,\n        &quot;code&quot; : 13435,\n        &quot;codeName&quot; : &quot;NotMasterNoSlaveOk&quot;\n}</code></pre></div>\n<h2 id=\"docker-compose-复制集\"><a href=\"#docker-compose-%E5%A4%8D%E5%88%B6%E9%9B%86\" aria-label=\"docker compose 复制集 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>docker-compose 复制集</h2>\n<p>尽管通过 docker 我们已经很方便的运行了一个复制集集群，但是我们还可以通过 docker-compose 启动整个集群</p>\n<ul>\n<li>编写<code class=\"language-text\">docker-compose.yml</code></li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">version: &quot;2&quot;\nservices:\n\n   mongo1:\n    image: &#39;mongo&#39;\n    ports:\n      - 3001:27017\n    volumes:\n      - mongo1:/data/db\n    command: bash -c &quot;mongod --replSet mongo-repl-set &amp;&amp; mongo --eval &#39;rs.initiate({\\&quot;_id\\&quot;:\\&quot;mongo-repl-set\\&quot;,\\&quot;members\\&quot;:[{\\&quot;_id\\&quot;:0,\\&quot;host\\&quot;:\\&quot;mongo1:27017\\&quot;},{\\&quot;_id\\&quot;:1,\\&quot;host\\&quot;:\\&quot;mongo2:27017\\&quot;},{\\&quot;_id\\&quot;:2,\\&quot;host\\&quot;:\\&quot;mongo3:27017\\&quot;}]})&#39;&quot;\n    depends_on:\n      - mongo2\n      - mongo3\n\n  mongo2:\n    image: &#39;mongo&#39;\n    ports:\n      - 3002:27017\n    volumes:\n      - mongo2:/data/db\n    command: mongod --replSet mongo-repl-set\n\n  mongo3:\n    image: &#39;mongo&#39;\n    ports:\n      - 3003:27017\n    volumes:\n      - mongo3:/data/db\n    command: mongod --replSet mongo-repl-set\n\nvolumes:\n  mongo1:\n  mongo2:\n  mongo3:</code></pre></div>\n<ul>\n<li>\n<p>启动集群</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">docker-compose up -d</code></pre></div>\n</li>\n</ul>\n<h2 id=\"总结\"><a href=\"#%E6%80%BB%E7%BB%93\" aria-label=\"总结 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>总结</h2>\n<p>通过 docker, 我们很简单就搭建了一个 mongo 复制集集群。用来作为本地测试是完全没问题的，但是如果要运用到生产环境，还需注意如下几点</p>\n<ul>\n<li>\n<p>mongo 不添加任何参数，默认是没有权限验证的，运行到生产环境是需添加用户角色权限</p>\n</li>\n<li>\n<p>实例均运行在一个机器上并不是一个好主意，可以通过 <a href=\"https://docs.docker.com/engine/swarm/\">docker swarm</a> 搭建集群</p>\n</li>\n</ul>","excerpt":"准备 这里唯一需要的安装的软件就是 docker, 当然文末也提供了 文件可以通过 docker-compose up 方便的一键运行复制集集群。基于 docker, 我们甚至不需要本地安装 mongodb, 所有的 mongodb 实例均运行在 docker…","timeToRead":4,"headings":[{"value":"准备","depth":2},{"value":"总览","depth":2},{"value":"设置网络","depth":2},{"value":"设置数据卷","depth":2},{"value":"运行镜像","depth":2},{"value":"设置复制集","depth":2},{"value":"测试验证","depth":2},{"value":"docker-compose 复制集","depth":2},{"value":"总结","depth":2}],"frontmatter":{"title":"Docker 搭建 mongodb 复制集","notoc":null,"excerpt":"Mongo 是一款常用的文档型数据库，它提供了复制集用来确保当数据库崩溃或关闭时数据的完整性。在生产环境中 Mongo 多是以复制集的形式存在，如何搭建却是一个问题，本文介绍如何使用 Docker 搭建 Mongo 复制集。","date":"March 13th 2017","rawDate":"2017-03-13"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/dockerda-jian-mongodbfu-zhi-ji-2/","prev":{"fields":{"slug":"/cong-ling-kai-shi-da-jian-vagrantrong-qi-2/"},"frontmatter":{"title":"从零开始创建 Vagrant 镜像","draft":null,"tags":["howto","vagrant"]}},"next":{"fields":{"slug":"/how-to-automate-testing-api-with-htte/"},"frontmatter":{"title":"基于 Htte 的 API 自动化测试","draft":null,"tags":["howto","htte","api-testing","automation-testing"]}}}}