{"data":{"site":{"siteMetadata":{"title":"Sigoden | Blog","siteUrl":"https://blog.sigoden.com","siteAuthor":"sigoden","githubUrl":"https://github.com/sigoden"}},"markdownRemark":{"html":"<h2 id=\"身份认证\"><a href=\"#%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81\" aria-label=\"身份认证 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>身份认证</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要使用 <code class=\"language-text\">Basic Auth</code> 使用标准的认证协议 (如 JWT, OAuth).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要再造 <code class=\"language-text\">Authentication</code>, <code class=\"language-text\">token generating</code>, <code class=\"language-text\">password storing</code> 这些轮子, 使用标准的.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在登录中使用 <code class=\"language-text\">Max Retry</code> 和自动封禁功能.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 加密所有的敏感数据.</li>\n</ul>\n<h3 id=\"jwt-json-web-token\"><a href=\"#jwt-json-web-token\" aria-label=\"jwt json web token permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>JWT (JSON Web Token)</h3>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用随机复杂的密钥 (<code class=\"language-text\">JWT Secret</code>) 以增加暴力破解的难度.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要在请求体中直接提取数据, 要对数据进行加密 (<code class=\"language-text\">HS256</code> 或 <code class=\"language-text\">RS256</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使 token 的过期时间尽量的短 (<code class=\"language-text\">TTL</code>, <code class=\"language-text\">RTTL</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要在 JWT 的请求体中存放敏感数据, 它是<a href=\"https://jwt.io/#debugger-io\">可破解的</a>.</li>\n</ul>\n<h3 id=\"oauth-授权或认证协议\"><a href=\"#oauth-%E6%8E%88%E6%9D%83%E6%88%96%E8%AE%A4%E8%AF%81%E5%8D%8F%E8%AE%AE\" aria-label=\"oauth 授权或认证协议 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>OAuth 授权或认证协议</h3>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 始终在后台验证 <code class=\"language-text\">redirect_uri</code>, 只允许白名单的 URL.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 每次交换令牌的时候不要加 token (不允许 <code class=\"language-text\">response_type=token</code>).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用 <code class=\"language-text\">state</code> 参数并填充随机的哈希数来防止跨站请求伪造(CSRF).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 对不同的应用分别定义默认的作用域和各自有效的作用域参数.</li>\n</ul>\n<h2 id=\"访问\"><a href=\"#%E8%AE%BF%E9%97%AE\" aria-label=\"访问 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>访问</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 限制流量来防止 DDoS 攻击和暴力攻击.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在服务端使用 HTTPS 协议来防止 MITM 攻击.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用 <code class=\"language-text\">HSTS</code> 协议防止 SSLStrip 攻击.</li>\n</ul>\n<h2 id=\"输入\"><a href=\"#%E8%BE%93%E5%85%A5\" aria-label=\"输入 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>输入</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用与操作相符的 HTTP 操作函数, <code class=\"language-text\">GET (读取)</code>, <code class=\"language-text\">POST (创建)</code>, <code class=\"language-text\">PUT (替换/更新)</code> 以及 <code class=\"language-text\">DELETE (删除记录)</code>, 如果请求的方法不适用于请求的资源则返回 <code class=\"language-text\">405 Method Not Allowed</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在请求头中的 <code class=\"language-text\">content-type</code> 字段使用内容验证来只允许支持的格式 (如 <code class=\"language-text\">application/xml</code>, <code class=\"language-text\">application/json</code> 等等) 并在不满足条件的时候返回 <code class=\"language-text\">406 Not Acceptable</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 验证 <code class=\"language-text\">content-type</code> 的发布数据和你收到的一样 (如 <code class=\"language-text\">application/x-www-form-urlencoded</code>, <code class=\"language-text\">multipart/form-data</code>, <code class=\"language-text\">application/json</code> 等等).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 验证用户输入来避免一些普通的易受攻击缺陷 (如 <code class=\"language-text\">XSS</code>, <code class=\"language-text\">SQL-注入</code>, <code class=\"language-text\">远程代码执行</code> 等等).</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要在 URL 中使用任何敏感的数据 (<code class=\"language-text\">credentials</code>, <code class=\"language-text\">Passwords</code>, <code class=\"language-text\">security tokens</code>, or <code class=\"language-text\">API keys</code>), 而是使用标准的认证请求头.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用一个 API Gateway 服务来启用缓存、访问速率限制 (如 <code class=\"language-text\">Quota</code>, <code class=\"language-text\">Spike Arrest</code>, <code class=\"language-text\">Concurrent Rate Limit</code>) 以及动态地部署 APIs resources.</li>\n</ul>\n<h2 id=\"处理\"><a href=\"#%E5%A4%84%E7%90%86\" aria-label=\"处理 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>处理</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 检查是否所有的终端都在身份认证之后, 以避免被破坏了的认证体系.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 避免使用特有的资源 id. 使用 <code class=\"language-text\">/me/orders</code> 替代 <code class=\"language-text\">/user/654321/orders</code></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用 <code class=\"language-text\">UUID</code> 代替自增长的 id.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 如果需要解析 XML 文件, 确保实体解析(entity parsing)是关闭的以避免 <code class=\"language-text\">XXE</code> 攻击.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 如果需要解析 XML 文件, 确保实体扩展(entity expansion)是关闭的以避免通过指数实体扩展攻击实现的 <code class=\"language-text\">Billion Laughs/XML bomb</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在文件上传中使用 CDN.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 如果需要处理大量的数据, 使用 Workers 和 Queues 来快速响应, 从而避免 HTTP 阻塞.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要忘了把 DEBUG 模式关掉.</li>\n</ul>\n<h2 id=\"输出\"><a href=\"#%E8%BE%93%E5%87%BA\" aria-label=\"输出 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>输出</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 发送 <code class=\"language-text\">X-Content-Type-Options: nosniff</code> 头.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 发送 <code class=\"language-text\">X-Frame-Options: deny</code> 头.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 发送 <code class=\"language-text\">Content-Security-Policy: default-src &#39;none&#39;</code> 头.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 删除指纹头 - <code class=\"language-text\">X-Powered-By</code>, <code class=\"language-text\">Server</code>, <code class=\"language-text\">X-AspNet-Version</code> 等等.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在响应中强制使用 <code class=\"language-text\">content-type</code>, 如果你的类型是 <code class=\"language-text\">application/json</code> 那么你的 <code class=\"language-text\">content-type</code> 就是 <code class=\"language-text\">application/json</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 不要返回敏感的数据, 如 <code class=\"language-text\">credentials</code>, <code class=\"language-text\">Passwords</code>, <code class=\"language-text\">security tokens</code>.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在操作结束时返回恰当的状态码. (如 <code class=\"language-text\">200 OK</code>, <code class=\"language-text\">400 Bad Request</code>, <code class=\"language-text\">401 Unauthorized</code>, <code class=\"language-text\">405 Method Not Allowed</code> 等等).</li>\n</ul>\n<h2 id=\"持续集成和持续部署\"><a href=\"#%E6%8C%81%E7%BB%AD%E9%9B%86%E6%88%90%E5%92%8C%E6%8C%81%E7%BB%AD%E9%83%A8%E7%BD%B2\" aria-label=\"持续集成和持续部署 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>持续集成和持续部署</h2>\n<ul>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 使用单元测试和集成测试来审计你的设计和实现.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 引入代码审查流程, 不要自行批准更改.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 在推送到生产环境之前确保服务的所有组件都用杀毒软件静态地扫描过, 包括第三方库和其它依赖.</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" disabled> 为部署设计一个回滚方案.</li>\n</ul>","excerpt":"身份认证 不要使用   使用标准的认证协议 (如 JWT, OAuth). 不要再造  ,  ,   这些轮子, 使用标准的. 在登录中使用   和自动封禁功能. 加密所有的敏感数据. JWT (JSON Web Token…","timeToRead":3,"headings":[{"value":"身份认证","depth":2},{"value":"JWT (JSON Web Token)","depth":3},{"value":"OAuth 授权或认证协议","depth":3},{"value":"访问","depth":2},{"value":"输入","depth":2},{"value":"处理","depth":2},{"value":"输出","depth":2},{"value":"持续集成和持续部署","depth":2}],"frontmatter":{"title":"开发安全的 API 所需要核对的清单","notoc":null,"excerpt":"当你在设计，测试以及发布你的 API 的时候所需要核对那些重要安全措施呢？","date":"July 27th 2017","rawDate":"2017-07-27"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/api-security-checklist/","prev":{"fields":{"slug":"/nginx-how-to-write-conf/"},"frontmatter":{"title":"nginx 配置从入门到精通","draft":null,"tags":["howto","nginx"]}},"next":{"fields":{"slug":"/webhook-deploy/"},"frontmatter":{"title":"使用 webhook 自动部署","draft":null,"tags":["howto","ci","nodejs"]}}}}