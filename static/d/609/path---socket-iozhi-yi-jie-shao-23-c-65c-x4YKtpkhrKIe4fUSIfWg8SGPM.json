{"data":{"site":{"siteMetadata":{"title":"Sigoden | Blog","siteUrl":"https://blog.sigoden.com","siteAuthor":"sigoden","githubUrl":"https://github.com/sigoden"}},"markdownRemark":{"html":"<h2 id=\"历史\"><a href=\"#%E5%8E%86%E5%8F%B2\" aria-label=\"历史 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>历史</h2>\n<p>Web 端与服务器间的实时数据传输的是一个很重要的需求，但最早只能通过 AJAX 轮询询实现。在 WebSocket 标准没有推出之前，AJAX 轮询是唯一可行的方式（通过 Flash 浏览器也可以，但这里不做讨论）。AJAX 轮询原理是设置定时器，定时通过 AJAX 同步服务器数据。这种方式存在延时且对服务端造成很大负载。直到 2011 年，IETF 才标准化 WebSocket——一种基于 TCP 套接字进行收发数据的协议。现如今主流浏览器均已支持 WebSocket。\n\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/5aed05526ef6481cefe065e7afb1028b/70e11/browser-websocket-support.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 786px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 34.384858044164034%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAHCAIAAACHqfpvAAAACXBIWXMAAAsSAAALEgHS3X78AAABpUlEQVQY002MzUvbYACH83/tsKswBhsehOEu7SalpDtO0IsMpzsMdnAHDxbFQV2Voq2YprWCZfYj2jTNxxu7pm/6Nm/SNPGNSVQcKLKFeREeHn6Hhx+Fexzu80avYSIuHCm+JQYjKRjJV2PwlNBWHMRHDmzZxi2CeUvjKEctuSrjDPgx4l3UJlgmhuSb4o17fu2oj4QOuHKAHz3+354thrbkWxJ1oe4TZdcdCmNdIMN2YAJiyRZqeaboGR0fix5q32BwbSiXSHDgaWhIIZJcJAy1U8pFgAx/Y52HvaYJ67ZW+1RffFWKN8+ZETwzejXcPTkQMmvN71r/l29ILNha51cg5MhApSrCzxy3Nn/4MVZ8TxdTiRI9VZieyL+OH8y8YxN0kU6WU5P5N8/3XhZ2lgfZdCIXe7b7YrX6lWn/oGpynhEyZX6r0snOVWbfFuM0m5phkwtH84vVhRT7YZqJ5bj0ibInlTf7hY06lz2Wc1F/KG5Tt+Pug6ffk/5fb7CtbiydfV7pfPvSWtLNxh3RgFFtQCZ0wQOBfwJ4G+p3HoziexIZ/gPC8UctmQOrJgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px #ffffff;\"\n        alt=\"浏览器 WebSocket 支持状况\"\n        title=\"\"\n        src=\"/static/5aed05526ef6481cefe065e7afb1028b/73d01/browser-websocket-support.png\"\n        srcset=\"/static/5aed05526ef6481cefe065e7afb1028b/a3b1f/browser-websocket-support.png 197w,\n/static/5aed05526ef6481cefe065e7afb1028b/07137/browser-websocket-support.png 393w,\n/static/5aed05526ef6481cefe065e7afb1028b/73d01/browser-websocket-support.png 786w,\n/static/5aed05526ef6481cefe065e7afb1028b/a5918/browser-websocket-support.png 1179w,\n/static/5aed05526ef6481cefe065e7afb1028b/70e11/browser-websocket-support.png 1268w\"\n        sizes=\"(max-width: 786px) 100vw, 786px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>socket.io 将数据传输部分独立出来形成了 <a href=\"https://github.com/socketio/engine.io.git\">engine.io</a>, engine.io 对 WebSocket 和 AJAX 轮询进行封装，形成一套 API, 屏蔽了细节差异和兼容性问题，实现了跨浏览器 / 跨设备进行双向数据。</p>\n<blockquote>\n<p>socket.io 对 engine.io 不是必须的，你也可以实现自己的 engine.io，通过<code class=\"language-text\">server.bind</code>绑定</p>\n</blockquote>\n<h2 id=\"应用\"><a href=\"#%E5%BA%94%E7%94%A8\" aria-label=\"应用 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>应用</h2>\n<ul>\n<li>实时数据分析展示（报表，日志）</li>\n<li>即时通讯、聊天，</li>\n<li>二进制流（图片，音乐，视频）传输</li>\n<li>多人协同编辑</li>\n<li>即时消息推送</li>\n</ul>\n<h2 id=\"类似技术\"><a href=\"#%E7%B1%BB%E4%BC%BC%E6%8A%80%E6%9C%AF\" aria-label=\"类似技术 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>类似技术</h2>\n<ul>\n<li>AJAX 轮询：基于 XMLHttpRequest 的 AJAX 轮询</li>\n<li>AJAX 长轮询：类似轮询，服务器在客户端请求后不返回响应，直到有数据需要传到客户端，传完数据后客户端再发起新的请求。缺点是要额外传输的 HTTP 头，保持住请求不响应也需要一些额外工作。</li>\n<li>HTTP 流：与 AJAX 长轮询类似，服务端响应会带上 HTTP 头：Transfer-Encoding: chunked，返回完数据到客户端后客户端也不需要发起新的请求，缺点是各个 chunk 之间的数据难以识别和处理。</li>\n<li>插件：类似 Flash,Silverlight, 作为插件越来越被主流浏览器和用户排斥</li>\n</ul>\n<p>下面就不同角度对各技术进行分析</p>\n<ol>\n<li>\n<p>单向 / 双向</p>\n</li>\n<li>\n<p>单向：AJAX 轮询，AJAX 长轮询，HTTP 流</p>\n</li>\n<li>\n<p>双向：WebSocket, 插件</p>\n</li>\n<li>\n<p>延时</p>\n</li>\n</ol>\n<p><code class=\"language-text\">WebSocket &lt; 插件 &lt; HTTP 流 &lt; AJAX 长轮询 &lt; AJAX 轮询</code></p>\n<ol start=\"3\">\n<li>效率</li>\n</ol>\n<p><code class=\"language-text\">插件 &gt; WebSocket &gt; HTTP 流 &gt; AJAX 长轮询 &gt; AJAX 轮询</code></p>\n<ol start=\"4\">\n<li>移动端支持</li>\n</ol>\n<p>WebSocket: 基本均支持\nHTTP 流，AJAX 长轮询，AJAX 轮询：基本均支持\n插件：基本不支持</p>\n<ol start=\"5\">\n<li>开发或设置难易程度</li>\n</ol>\n<p><code class=\"language-text\">WebSocket &lt; AJAX 轮询 &lt; 插件 &lt; AJAX 长轮询，HTTP 流</code></p>\n<h2 id=\"结论\"><a href=\"#%E7%BB%93%E8%AE%BA\" aria-label=\"结论 permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>结论</h2>\n<p>socket.io 封装了 WebSocket, 不支持 WebSocket 的情况还提供了降级 AJAX 轮询，功能完备，设计优雅，是开发实时双向通讯的不二手段。</p>","excerpt":"历史 Web 端与服务器间的实时数据传输的是一个很重要的需求，但最早只能通过 AJAX 轮询询实现。在 WebSocket 标准没有推出之前，AJAX 轮询是唯一可行的方式（通过 Flash 浏览器也可以，但这里不做讨论）。AJAX 轮询原理是设置定时器，定时通过 AJAX…","timeToRead":1,"headings":[{"value":"历史","depth":2},{"value":"应用","depth":2},{"value":"类似技术","depth":2},{"value":"结论","depth":2}],"frontmatter":{"title":"socket.io 系列一：介绍","notoc":null,"excerpt":"socket.io 提供了基于事件的实时双向通讯，本文将对其进行详细介绍","date":"April 18th 2017","rawDate":"2017-04-18"}}},"pageContext":{"isCreatedByStatefulCreatePages":false,"slug":"/socket-iozhi-yi-jie-shao/","prev":{"fields":{"slug":"/npm-can-kao-shou-ce/"},"frontmatter":{"title":"一份详见的 npm 参考手册","draft":null,"tags":["guide","nodejs","npm"]}},"next":{"fields":{"slug":"/socket-iozhi-er-ji-ben-ying-yong/"},"frontmatter":{"title":"socket.io 系列二：基本应用","draft":null,"tags":["howto","socket.io","javascript"]}}}}